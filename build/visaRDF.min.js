/*! visaRDF 2013-12-10 */
this.visaRDF=this.visaRDF||{},this.visaRDF.templates=this.visaRDF.templates||{},Handlebars.registerPartial("isotopeItemContent",Handlebars.template(function(e,t,i,n,o){function a(e){var t,i="";return i+='\r\n			<h3 class="itemContent labelEn">'+y((t=e.label,t=null==t||t===!1?t:t.value,typeof t===f?t.apply(e):t))+"</h3>\r\n		"}function r(e){var t,i="";return i+='\r\n			<div class="itemContent descriptionEn">'+y((t=e.description,t=null==t||t===!1?t:t.value,typeof t===f?t.apply(e):t))+"</div>\r\n		"}function s(e,t){var n,o="";return o+="\r\n		",n=i.each.call(e,e.predicates,{hash:{},inverse:v.noop,fn:v.program(6,l,t),data:t}),(n||0===n)&&(o+=n),o+="\r\n                "}function l(e,t){var n,o,a,r="";return r+='\r\n			<img class="typeImage" src="img/',(n=i.type)?n=n.call(e,{hash:{},data:t}):(n=e.type,n=typeof n===f?n.apply(e):n),r+=y(n)+'.png"><div class="itemContent predicate" style="display:none">',(n=i.value)?n=n.call(e,{hash:{},data:t}):(n=e.value,n=typeof n===f?n.apply(e):n),r+=y(n)+"</div>\r\n                        ",a={hash:{},inverse:v.noop,fn:v.program(7,p,t),data:t},n=i.predicateLabelRetriver||e.predicateLabelRetriver,o=n?n.call(e,e,a):g.call(e,"predicateLabelRetriver",e,a),(o||0===o)&&(r+=o),r+="\r\n		"}function p(e,t){var n,o="";return o+='\r\n                            <div class="itemContent predicateLabel">',(n=i.label)?n=n.call(e,{hash:{},data:t}):(n=e.label,n=typeof n===f?n.apply(e):n),o+=y(n)+"</div>\r\n                        "}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,e.helpers),o=o||{};var c,d,u,h="",f="function",y=this.escapeExpression,v=this,g=i.helperMissing;return h+="		",c=i["if"].call(t,t.label,{hash:{},inverse:v.noop,fn:v.program(1,a,o),data:o}),(c||0===c)&&(h+=c),h+="\r\n		",u={hash:{},inverse:v.noop,fn:v.program(3,r,o),data:o},c=i.ifLang||t.ifLang,d=c?c.call(t,t.description,u):g.call(t,"ifLang",t.description,u),(d||0===d)&&(h+=d),h+="\r\n                ",d=i["if"].call(t,t.predicates,{hash:{},inverse:v.noop,fn:v.program(5,s,o),data:o}),(d||0===d)&&(h+=d),h})),this.visaRDF.templates.filterOptions=Handlebars.template(function(e,t,i,n,o){function a(e,t){var n,o="";return o+='\r\n				<li><a data-filter-value="',(n=i.value)?n=n.call(e,{hash:{},data:t}):(n=e.value,n=typeof n===l?n.apply(e):n),o+=p(n)+'" class="',(n=i.value)?n=n.call(e,{hash:{},data:t}):(n=e.value,n=typeof n===l?n.apply(e):n),o+=p(n)+'">',(n=i.label)?n=n.call(e,{hash:{},data:t}):(n=e.label,n=typeof n===l?n.apply(e):n),o+=p(n)+"</a></li>\r\n			"}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,e.helpers),o=o||{};var r,s="",l="function",p=this.escapeExpression,c=this;return s+='	<div class="option-combo filter">\r\n		<h2>Filter:</h2>\r\n		<ul class="option-set clearfix" data-option-key="filter">\r\n			',r=i.each.call(t,t,{hash:{},inverse:c.noop,fn:c.program(1,a,o),data:o}),(r||0===r)&&(s+=r),s+="\r\n		</ul>\r\n	</div>"}),this.visaRDF.templates.groupDropDown=Handlebars.template(function(e,t,i,n,o){function a(e,t){var n,o="";return o+="\r\n      		<option value=",(n=i.val)?n=n.call(e,{hash:{},data:t}):(n=e.val,n=typeof n===l?n.apply(e):n),o+=p(n)+">",(n=i.label)?n=n.call(e,{hash:{},data:t}):(n=e.label,n=typeof n===l?n.apply(e):n),o+=p(n)+"</option>\r\n		"}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,e.helpers),o=o||{};var r,s="",l="function",p=this.escapeExpression,c=this;return s+='	<select id="GroupDropDown">\r\n		',r=i.each.call(t,t,{hash:{},inverse:c.noop,fn:c.program(1,a,o),data:o}),(r||0===r)&&(s+=r),s+="\r\n    </select>"}),this.visaRDF.templates.overlayContent=Handlebars.template(function(e,t,i,n,o){function a(e,t){var n,o,a="";return a+="\r\n		<h2>"+p((n=e.label,n=null==n||n===!1?n:n.value,typeof n===l?n.apply(e):n))+" </h2>",(o=i.uri)?o=o.call(e,{hash:{},data:t}):(o=e.uri,o=typeof o===l?o.apply(e):o),a+=p(o)+'\r\n		<div class="innerScroll">\r\n			<div></div>\r\n		</div>\r\n	'}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,e.helpers),o=o||{};var r,s="",l="function",p=this.escapeExpression,c=this;return s+="	",r=i["if"].call(t,t.label,{hash:{},inverse:c.noop,fn:c.program(1,a,o),data:o}),(r||0===r)&&(s+=r),s}),this.visaRDF.templates.overlayItem=Handlebars.template(function(e,t,i,n,o){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,e.helpers),o=o||{};var a,r,s="",l="function",p=this.escapeExpression;return s+='		<div class="'+p((a=t.cssClass,a=null==a||a===!1?a:a.overlay,typeof a===l?a.apply(t):a))+" "+p((a=t.cssClass,a=null==a||a===!1?a:a.overlay,typeof a===l?a.apply(t):a))+"_",(r=i.index)?r=r.call(t,{hash:{},data:o}):(r=t.index,r=typeof r===l?r.apply(t):r),s+=p(r)+'">\r\n			<span class="close">close</span>\r\n			<div class="'+p((a=t.cssClass,a=null==a||a===!1?a:a.overlayContent,typeof a===l?a.apply(t):a))+'">\r\n			</div>\r\n		</div>'}),this.visaRDF.templates.plugin=Handlebars.template(function(e,t,i,n,o){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,e.helpers),o=o||{};var a,r,s="",l="function",p=this.escapeExpression;return s+='		<div class="'+p((a=t.cssClass,a=null==a||a===!1?a:a.overlay,typeof a===l?a.apply(t):a))+" "+p((a=t.cssClass,a=null==a||a===!1?a:a.overlay,typeof a===l?a.apply(t):a))+"_",(r=i.index)?r=r.call(t,{hash:{},data:o}):(r=t.index,r=typeof r===l?r.apply(t):r),s+=p(r)+'">\r\n			<span class="close">close</span>\r\n			<div class="'+p((a=t.cssClass,a=null==a||a===!1?a:a.overlayContent,typeof a===l?a.apply(t):a))+'">\r\n			</div>\r\n		</div>'}),this.visaRDF.templates.previewItem=Handlebars.template(function(e,t,i,n,o){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,e.helpers),o=o||{};var a,r,s="",l="function",p=this.escapeExpression;return s+='		<div class="'+p((a=t.cssClass,a=null==a||a===!1?a:a.preview,typeof a===l?a.apply(t):a))+" "+p((a=t.cssClass,a=null==a||a===!1?a:a.preview,typeof a===l?a.apply(t):a))+"_",(r=i.index)?r=r.call(t,{hash:{},data:o}):(r=t.index,r=typeof r===l?r.apply(t):r),s+=p(r)+'">\r\n			<div class="'+p((a=t.cssClass,a=null==a||a===!1?a:a.previewContent,typeof a===l?a.apply(t):a))+'">\r\n                            TODO\r\n			</div>\r\n		</div>'}),this.visaRDF.templates.sortOptions=Handlebars.template(function(e,t,i,n,o){function a(e){var t="";return t+='\r\n				<li><a data-sort-value="'+d(typeof e===c?e.apply(e):e)+'" class="'+d(typeof e===c?e.apply(e):e)+'">'+d(typeof e===c?e.apply(e):e)+"</a></li>\r\n			"}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,e.helpers),o=o||{};var r,s,l,p="",c="function",d=this.escapeExpression,u=this,h=i.helperMissing;return p+='	<div class="option-combo sorter">\r\n		<h2>Sort:</h2>\r\n		<ul class="option-set clearfix" data-option-key="sortBy">\r\n			',l={hash:{},inverse:u.noop,fn:u.program(1,a,o),data:o},r=i.keysEach||t.keysEach,s=r?r.call(t,t,l):h.call(t,"keysEach",t,l),(s||0===s)&&(p+=s),p+="\r\n		</ul>\r\n	</div>"}),this.visaRDF.templates.stdNode=Handlebars.template(function(e,t,i,n,o){function a(e){var t="";return t+=d(typeof e===c?e.apply(e):e)+" "}function r(e,t){var n;return(n=i.token)?n=n.call(e,{hash:{},data:t}):(n=e.token,n=typeof n===c?n.apply(e):n),d(n)}function s(e){var t,i="";return i+='\r\n			<h2 class="showUri" style="display:none">'+d((t=e.subject,t=null==t||t===!1?t:t.value,typeof t===c?t.apply(e):t))+"</h2>\r\n		"}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,e.helpers),n=this.merge(n,e.partials),o=o||{};var l,p="",c="function",d=this.escapeExpression,u=this;return p+='	<div class="item ',l=i.each.call(t,t.filterables,{hash:{},inverse:u.noop,fn:u.program(1,a,o),data:o}),(l||0===l)&&(p+=l),l=i["if"].call(t,t.token,{hash:{},inverse:u.noop,fn:u.program(3,r,o),data:o}),(l||0===l)&&(p+=l),p+=" ",(l=i.index)?l=l.call(t,{hash:{},data:o}):(l=t.index,l=typeof l===c?l.apply(t):l),p+=d(l)+'">\r\n		',l=i["if"].call(t,t.subject,{hash:{},inverse:u.noop,fn:u.program(5,s,o),data:o}),(l||0===l)&&(p+=l),p+='\r\n		<p class="number" style="display:none">',(l=i.index)?l=l.call(t,{hash:{},data:o}):(l=t.index,l=typeof l===c?l.apply(t):l),p+=d(l)+"</p>\r\n		",l=u.invokePartial(n.isotopeItemContent,"isotopeItemContent",t,i,n,o),(l||0===l)&&(p+=l),p+="\r\n	</div>"}),this.visaRDF.templates.timelineItem=Handlebars.template(function(e,t,i,n,o){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,e.helpers),o=o||{};var a,r="",s="function",l=this.escapeExpression;return r+="<li>\r\n    "+l((a=t.node,a=null==a||a===!1?a:a.label,a=null==a||a===!1?a:a.value,typeof a===s?a.apply(t):a))+"\r\n</li>"}),function(e,t,i,n){function o(e){return e===n||null===e}function a(e,t){return e.replace(RegExp(h.DUMMY,"g"),t)}function r(t){var i=null,n=null;return t?e("BODY").hasClass("noscroll")?(i=u.width(),n=u.height()):(e("BODY").addClass("noscroll"),i=u.width(),n=u.height(),e("BODY").removeClass("noscroll")):(i=u.width(),n=u.height()),{width:i,height:n}}function s(e){var t;switch(e){case h.CSS_CLASSES.overlay:return t=r(!0),"rect(0px "+t.width+"px "+t.height+"px 0px)";case h.CSS_CLASSES.preview:return t=r(!1),"rect("+.25*t.height+"px "+.75*t.width+"px "+.75*t.height+"px "+.25*t.width+"px)";default:return console.log("No clip data found."),""}}function l(e){var t=u.scrollTop(),i=u.scrollLeft(),n=e.offset();return{left:n.left-i,top:n.top-t,width:e.outerWidth(),height:e.outerHeight()}}function p(){var e={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"};return e[Modernizr.prefixed("transition")]}function c(){return D++}function d(t,i){this._selfProxy=function(t){return e.proxy(t,this)},this.pluginID=c(),this._$parent=e(t),this.$body=e("BODY"),S[this.pluginID]=new d.EventManager(this._$parent),this._$parent.addClass(m+"_"+this.pluginID),this.options=e.extend(!0,{},T,i),this._defaults=T,this.nodeFilters=this.options.nodeFilters,this.tileFilters=this.options.tileFilters,this._name=m,this._expandedOverlaysCount=0,this._queries={},this.init()}var u=e(t),h={FA_TAG:"-filter-_",TOKEN_TAG:"token_",NODE_TYPES:{literal:"literal",blankNode:"blankNode",resNode:"resNode"},toFilterable:function(e){return h.FA_TAG+e},CSS_CLASSES:{outerContainer:"outerContainer",viewContainer:"container",options:"options",clearfix:"clearfix",loader:"loading",preview:"preview",previewItem:"preview-item",previewContent:"previewContent",overlay:"overlay",overlayContent:"overlayContent",typeClasses:{incoming:"incoming",outgoing:"outgoing"},patternClasses:{uri:"uri",literal:"literal",blanknode:"blank"},toToken:function(e){for(var t=e.split("."),i=this,n=0;t.length>n;n++)i=i[t[n]];return h.TOKEN_TAG+i},toFilterable:function(e){for(var t=e.split("."),i=this,n=0;t.length>n;n++)i=i[t[n]];return h.FA_TAG+i},toSelector:function(e){for(var t=e.split("."),i=this,n=0;t.length>n;n++)i=i[t[n]];return"."+i}},DUMMY:"#replaceMe#",EVENT_TYPES:{storeModified:{insert:"dataInsert"},loading:{loadingDone:"loadingDone",loadingStart:"loadingStarted"}},MESSAGES:{error:{ajax:"Error on loading data.",remote:"Error on loading remote data.",template:"Error on loading template data.",tokenType:"Unkown token type of item."}}};e.extend(e.Isotope.prototype,{_groupRowsReset:function(){this.groupRows={x:0,y:0,gutter:0,height:0,currentGroup:null}},_groupRowsLayout:function(t){var i=this,n=this.element.width(),o=this.options.sortBy,a=this.groupRows;t.each(function(){var t=e(this),r=t.outerWidth(!0),s=t.outerHeight(!0),l=e.data(this,"isotope-sort-data")[o];if(l!==a.currentGroup?(a.x=0,a.height+=a.currentGroup?i.groupRows.gutter:0,a.y=a.height,a.currentGroup=l,s>i.groupRows.gutter&&(i.groupRows.gutter=s)):0!==a.x&&r+a.x>n&&(a.x=0,a.y=a.height),t.find(".groupLabel").remove(),""!==l){for(var p=l.split("_")[0]+"_",c=l.split(p),d="<div class='groupLabel'>",u=1;c.length>u;u++)d+=c[u];d+="</div>",t.append(d)}i._pushPosition(t,a.x,a.y),a.height=Math.max(a.y+s,a.height),a.x+=r})},_groupRowsGetContainerSize:function(){return{height:this.groupRows.height}},_groupRowsResizeChanged:function(){return!0}}),e.expr[":"]["class-prefix"]=function(t,i,n){var o=n[3];if(o){var a='[class^="'+o+'"], [class*=" '+o+'"]';return e(t).is(a)}return!0},e.expr[":"].regex=function(e,t,i){var n,o=i[3].split(","),a=/^(data|css):/,r={method:o[0].match(a)?o[0].split(":")[0]:"attr",property:o.shift().replace(a,"")},s="ig";try{n=RegExp(o.join("").replace(/^\s+|\s+$/g,""),s)}catch(l){return!1}return n.test(jQuery(e)[r.method](r.property))};var f=function(){var i=0;this._requestSPARQLCrossDomain=function(o,a,r){var s=!1,l=i++;t["cbFunc"+l]=function(e){e&&e.query&&e.query.results?(s=!0,r(e.query.results.sparql.result,s)):console.log("Nothing returned from getJSON."),r(null,s),t["cbFunc"+l]=n},o||alert("No query was passed.");var p="http://query.yahooapis.com/v1/public/yql?q="+encodeURIComponent('use "http://triplr.org/sparyql/sparql.xml" as sparql; select * from sparql where query="'+o+'" and service="'+a)+'"&format=json&callback=cbFunc'+l;e.ajax({dataType:"jsonp",url:p,success:t.cbFunc,error:function(e,t,i){console.log("Error on yql query."),console.log(i),r(null,s)}})}};f.prototype.executeQuery=function(e,t,i){this._requestSPARQLCrossDomain(e,t,i)};var y=function(){this.values={}};y.prototype.add=function(e,t){this.values[e]=t},y.prototype.retrieve=function(e){return this.values[e]},y.prototype.contains=function(e){return e in this.values};var v,g=e.Deferred(),m="visaRDF",b=new f,S=[],_=new y,E=p(),w=Modernizr.csstransitions,C={rdf:"http://www.w3.org/1999/02/22-rdf-syntax-ns#",rdfs:"http://www.w3.org/2000/01/rdf-schema#",owl:"http://www.w3.org/2002/07/owl#",rif:"http://www.w3.org/2007/rif#",foaf:"http://xmlns.com/foaf/0.1/",dbpedia:"http://dbpedia.org/resource/","dbpedia-owl":"http://dbpedia.org/ontology/",dbpprop:"http://dbpedia.org/property/",geo:"http://www.w3.org/2003/01/geo/wgs84_pos#",dc:"http://purl.org/dc/terms/"},L={},D=0;d.Event=function(e){this._sender=e,this._listeners=[]},d.Event.prototype={attach:function(e){this._listeners.push(e)},notify:function(e){var t;for(t=0;this._listeners.length>t;t+=1)this._listeners[t](this._sender,e)}},d.EventManager=function(e){return e?(this.stdObject=e,this._evHandlerHistory={},n):(console.log("EventManager not created"),!1)},d.EventManager.prototype.addEventHandler=function(e,t,i,o){var a=this;i===n&&(i=a.stdObject),a._evHandlerHistory[e]===n&&(a._evHandlerHistory[e]=[]),a._evHandlerHistory[e].push({id:o,object:i,handler:t}),i.on(e,t)},d.EventManager.prototype.removeEventHandler=function(t,i,o){var a=this;e.each(a._evHandlerHistory[t],function(a,r){if(i===r.id)if(o!==n){if(e.data(r.object)===e.data(o))return r.object.off(t,r.handler),!1}else r.object.off(t,r.handler)})},d.EventManager.prototype.trigger=function(e,t,i){i?i.trigger(e,t):this.stdObject.trigger(e,t)},d.EventManager.prototype.destroy=function(){e.each(this._evHandlerHistory,function(t,i){e.each(i,function(e,i){i.object.off(t,i.handler)})})},d.RdfStore=function(t,i){var n=this;this._store=null,this._queryPrefixes="",this._generateQueryPrefix=function(e,t){n._queryPrefixes+="PREFIX "+e+": <"+t+"> "},e.each(C,function(e,t){n._generateQueryPrefix(e,t)}),new rdfstore.Store(t,function(e){n._store=e,i()})},d.RdfStore.prototype.insertData=function(t,i,n){var a=this;if("text/turtle"===i||"text/plain"===i||"text/n3"===i){var r=t.match(/.*@prefix.*>(\s)*./g);e.each(r,function(e,t){var i=t.split(/>(\s)*./)[0].split(/:(\s)*</),n=i[0].replace(/@prefix(\s)*/,""),r=i[2];o(C[n])&&(C[n]=r,a._generateQueryPrefix(n,r))})}else if("application/ld+json"===i||"application/json"===i){var s=t["@context"];e.each(s,function(e,t){o(C[prefix])&&(C[e]=t,a._generateQueryPrefix(e,t))})}this._store.load(i,t,function(){n()})},d.RdfStore.prototype.executeQuery=function(e,t,i){this._store.execute(this._queryPrefixes+e,function(n,o){n?t(o):(console.log("Error on executing: "+e),i())})},d.LayoutEngine=function(e,t){this._container=e,e.isotope(t)},d.LayoutEngine.prototype.add=function(e,t){this._container.isotope("insert",e,t)},d.LayoutEngine.prototype.reLayout=function(){this._container.isotope("reLayout")},d.LayoutEngine.prototype.remove=function(e,t){this._container.isotope("remove",e,t)},d.LayoutEngine.prototype.updateSortData=function(e){this._container.isotope("updateSortData",e)},d.LayoutEngine.prototype.updateOptions=function(e){this._container.isotope(e)},d.Layer=function(t,i,n,o){var a=this;if(this.plugin=n,this.options=i,this.model=new d.Layer.Model(o,i.modelOptions,n._queries.label),this.view=new d.Layer.View(this.model,t,i.viewOptions),this.model.itemsAdded.attach(function(t,i){var n=e("<div>");e.each(a.plugin.nodeFilters,function(e,t){i=t.fn(a.plugin,i)}),console.log(i),console.log(n),e.each(i,function(t,i){n.append(e(a.plugin.nodeTemplates[i.getTemplateIdentifier()](i)))}),console.log(n),n=n.children(),console.log(n),e.each(a.plugin.tileFilters,function(e,t){n=t.fn(a.plugin,n),console.log(t)}),console.log(n),a.view.addTiles(n)}),this.view.browseableNodeClicked.attach(function(t,i){var n=e(i);a.options.usePreviews?a.openPreview(n):(n.data("isExpanded",!0),a.addNewLayer(n))}),i.generateSortOptions||i.generateFilterOptions||n.options.generateTimeline){if(this.view.addOptionsBox(),n.options.generateTimeline){this.view.addTimelineButton();var r=L.timelineItem(this);n._$timeline.append(r)}i.generateSortOptions&&this.view.addSorter(),i.generateFilterOptions&&this.view.addFilter()}},d.Layer.prototype.openPreview=function(e){e.data("node")},d.Layer.prototype.update=function(){this.model.update()},d.Layer.prototype.addNewLayer=function(t){var i=this.view.$container.find(h.CSS_CLASSES.toSelector("overlay")+"_"+t.index());if(1>i.length){var n=L.overlayItem({index:t.index(),cssClass:{overlay:h.CSS_CLASSES.overlay,overlayContent:h.CSS_CLASSES.overlayContent}});this.view.$container.append(n),i=this.view.$container.find("> "+h.CSS_CLASSES.toSelector("overlay")+"_"+t.index())}var o=e.extend(!0,{},this.options,{layoutEngine:{itemSelector:".item",getSortData:{type:function(e){var t=e.attr("class");return t},group:function(e){for(var t=e.attr("class"),i=RegExp("(s)*[a-zA-Z0-9]*"+h.TOKEN_TAG+"[a-zA-Z0-9]*(s)*","g"),n=t.match(i),o="",a=0;n.length>a;a++)o+=n[a]+" ";return o}}},filterBy:[{value:"*",label:"showAll"},{value:h.CSS_CLASSES.typeClasses.incoming,label:"in"},{value:h.CSS_CLASSES.typeClasses.outgoing,label:"out"}]});this.plugin.addLayer(new d.DetailLayer(i,o,this.plugin,t))},d.Layer.prototype.removeAllItems=function(){this.model.clearModel()},d.Node=function(e){this.index=e.index,this.label=e.label,this.token=e.subject.token,this.useTemplateIdentifier="stdNode",this.description=e.description,this.filterables=[],e.predicate&&(this.predicates=[],this.filterables.push(h.toFilterable(e.predicate.type)),this.predicates.push(e.predicate))},d.Node.prototype.getType=function(){return this.type},d.Node.prototype.getTemplateIdentifier=function(){return this.useTemplateIdentifier},d.Node.prototype.setPredicateLabel=function(e,t){this.predicates[e].label=t},d.Node.prototype.merge=function(t){var i=this,n=!1;return e.each(t,function(t,o){switch(t){case"label":o.lang&&"en"===o.lang&&!o.lang&&"en"!==o.lang&&(n=!0,this.label=o);break;case"predicates":var a=!0;e.each(i.predicates,function(e,t){t.value===o[0].value&&t.type===o[0].type?a=!1:-1===i.filterables.indexOf(h.toFilterable(o[0].type))&&i.filterables.push(h.toFilterable(o[0].type))}),a&&(n=!0,i.predicates.push(o[0]))}}),n},d.ResNode=function(e,t){d.Node.call(this,e),this.itemStyle=t,this.type=h.NODE_TYPES.resNode,this.uri=e.subject.value,o(this.label)?this.label={value:this.uri}:this.label.value=unescape(this.label.value),this._generateID=function(){return this.uri},this.id=this._generateID()},d.ResNode.prototype=Object.create(d.Node.prototype),d.ResNode.prototype.constructor=d.ResNode,d.LiteralNode=function(e,t){d.Node.call(this,e),this.label=e.subject,this.label.value=unescape(this.label.value),this.literalStyle=t,this.type=h.NODE_TYPES.literal,this.value=e.subject.value,this._generateID=function(){return this.predicates?this.predicates[0].value+this.value:n},this.id=this._generateID()},d.LiteralNode.prototype=Object.create(d.Node.prototype),d.LiteralNode.prototype.constructor=d.LiteralNode,d.BlankNode=function(e){d.Node.call(this,e),this.type=h.NODE_TYPES.blankNode,this.label={value:"BlankNode - TODO"},this._generateID=function(){return"_"+Math.random().toString(36).substr(2,9)},this.id=this._generateID()},d.BlankNode.prototype=Object.create(d.Node.prototype),d.BlankNode.prototype.constructor=d.BlankNode,d.NodeFactory={makeNode:function(e,t){var i;switch(e.subject.token){case h.CSS_CLASSES.toToken("patternClasses.blanknode"):i=new d.BlankNode(e);break;case h.CSS_CLASSES.toToken("patternClasses.literal"):i=new d.LiteralNode(e,t.literalStyle);break;case h.CSS_CLASSES.toToken("patternClasses.uri"):!e.label||e.label.lang!==n&&"en"!==e.label.lang||(i=new d.ResNode(e,t.itemStyle));break;default:console.log(h.MESSAGES.error.tokenType)}return i}},d.Layer.Model=function(t,i,n){var o=this;this.viewQueries=t,this.labelQuery=n,this.options=i,this.nodes={resNodes:{length:0},blankNodes:{length:0},literalNodes:{length:0},length:0},this.itemsAdded=new d.Event(this),this.modelCleared=new d.Event(this),this.itemUpdated=new d.Event(this),this._checkItemsHelp=function(e,t){var i=e.slice(t);i.length>0&&o.checkItems(i)},this._fetchPredicateLabel=function(t){return t.predicates&&e.each(t.predicates,function(i,n){if(_.contains(n.value))t.setPredicateLabel(i,_.retrieve(n.value));else{var r=a(o.labelQuery,n.value);v.executeQuery(r,function(i){i&&i[0]&&e.each(i,function(e,i){t.setPredicateLabel(e,i.label.value),_.add(n.value,i.label.value)})})}}),t}},d.Layer.Model.prototype.checkItems=function(t){var i=t.length,o=this,a=o.options.batchSize>i?i:o.options.batchSize,r=t.slice(0,a),s={};e.each(r,function(e,t){t.subject.token=h.TOKEN_TAG+t.subject.token,t.index=o.nodes.length+1;var i=d.NodeFactory.makeNode(t,o.options);if(i){switch(i.getType()){case h.NODE_TYPES.resNode:i.id in o.nodes.resNodes?o.nodes.resNodes[i.id].merge(i)?(i=o.nodes.resNodes[i.id],o.itemUpdated.notify(i)):i=n:(o.nodes.resNodes[i.id]=i,o.nodes.length++);break;case h.NODE_TYPES.literal:i.id in o.nodes.literalNodes?(i=n,console.log("literalupdate")):(o.nodes.literalNodes[i.id]=i,o.nodes.length++);break;case h.NODE_TYPES.blankNode:i.id in o.nodes.blankNodes?(console.log(i),console.log("blankNodeupdate"),i=n):(o.nodes.blankNodes[i.id]=i,o.nodes.length++)}i&&(s[i.id]=i)}}),this.itemsAdded.notify(s),o._checkItemsHelp(t,a)},d.Layer.Model.prototype.update=function(){for(var e=this,t=!0,i=0;this.viewQueries.length>i;i++)v.executeQuery(this.viewQueries[i].query,function(n){if(n&&0!==n.length){if(t=!1,e.viewQueries[i].type)for(var o=0;n.length>o;o++)n[o].predicate.type=e.viewQueries[i].type;e.checkItems(n)}else i===e.viewQueries.length-1&&t&&console.log("nothing found")})},d.Layer.Model.prototype.clearModel=function(){this.nodes={resNodes:{length:0},blankNodes:{length:0},literalNodes:{length:0},length:0},this.modelCleared.notify()},d.Layer.View=function(t,i,n){var o=this;this.options=n,this._model=t,this.$container=i,this.$outerContainer=e('<div class="'+h.CSS_CLASSES.outerContainer+'"></div>'),this.$viewContainer=e('<div class="'+h.CSS_CLASSES.viewContainer+'"></div>'),this.$container.append(this.$outerContainer),this.$outerContainer.append(this.$viewContainer),this.layoutEngine=new d.LayoutEngine(this.$viewContainer,n.layoutEngine),this.browseableNodeClicked=new d.Event(this),this._initBrowsability=function(t){e(t).click(function(){o.browseableNodeClicked.notify(t)})},this._getCorrespondingTile=function(e){var t=this.$viewContainer.find("."+e.index);return t},this._addPredURIShow=function(e){var t=e.find("> .predicate"),i=e.find("> .typeImage"),n=e.find("> .predicateLabel");n.on("mouseenter",function(){t.css("display","inline-block"),i.css("display","none"),n.css("display","none")}),t.on("mouseleave",function(){t.css("display","none"),i.css("display","inline-block"),n.css("display","inline-block")})},this._addToAnchor=function(e,t,i,n){e.height(i),e.css("top",t),t+=i+5,n&&n(t)},this._setLiteralScale=function(e,t){var i=this,n=e.height()+this.options.literalStyle.topPadding,o=i.options.literalStyle.dimension.width;e.width(o),i._setLabelScale(e,n,i.options.literalStyle.value.height,o,function(n){i._setPredicateScale(e,n,i.options.literalStyle.predicate.height,o,function(n){e.height(n+i.options.literalStyle.bottomPadding),t&&t()})})},this._setResNodeScale=function(e,t){var i=this,n=e.height()+this.options.itemStyle.topPadding,o=i.options.itemStyle.dimension.width;e.width(o),i._setLabelScale(e,n,i.options.itemStyle.label.height,o,function(n){i._setDescriptionScale(e,n,i.options.itemStyle.description.height,o,function(n){i._setPredicateScale(e,n,i.options.itemStyle.predicate.height,o,function(n){e.height(n+i.options.itemStyle.bottomPadding),t&&t()})})})},this._setLabelScale=function(e,t,i,n,o){var a=e.find("> .labelEn");a.width(.9*n),this._addToAnchor(a,t,i,o)},this._setPredicateScale=function(t,i,n,o,a){var r=this,s=t.find("> .typeImage"),l=t.find("> .predicate"),p=t.find("> .predicateLabel"),c=.1*o;s.css("padding-left",.025*o),s.width(c),p.css("padding-left",c),p.width(.9*o-c),l.width(.9*o),e.each(l,function(t,o){e(s[t]).height(n),e(s[t]).css("top",i),r._addToAnchor(e(o),i,n),r._addToAnchor(e(p[t]),i,n,function(e){i=e})}),a&&a(i)},this._setDescriptionScale=function(e,t,i,n,a){var r=e.data("node");if(r.description){var s=e.find("> .descriptionEn");s.width(.9*n),o._addToAnchor(s,t,i,a)}else a&&a(t)},this._setImgBackground=function(t){var i=t.data("node"),n="";switch(i.getType()){case h.NODE_TYPES.resNode:n=i.uri;break;case h.NODE_TYPES.literal:n=i.value}var o=n.replace(">","").split(".");switch(n.replace("<",""),o[o.length-1]){case"png":case"jpeg":case"svg":case"jpg":if(n){var a=e('<img src="'+n+'">');a.load(function(){var e=a.width(),i=a.height(),n=e/i,o=t.width(),r=t.height(),s=o/r,l=0;s>n?(l=o/n,a.width(o/n),a.height(r)):(a.width(l),a.height(o*n)),a.css({left:(o-l)/2,opacity:.5})}),t.prepend(a)}}},this._scaleText=function(e){e.children().quickfit({min:10}),e.css({"line-height":1})},this._generateTile=function(t,i,n,a){var r,s=e(L.stdNode(t));switch(o._addPredURIShow(s),s.data("node",t),t.getType()){case h.NODE_TYPES.resNode:r=new RGBColor(o.options.itemStyle.colors[t.index%o.options.itemStyle.colors.length]),s.css("background-color","rgba("+r.r+", "+r.g+", "+r.b+" ,1)"),this._setResNodeScale(s,function(){o._setImgBackground(s),o._scaleText(s)}),i.append(s);break;case h.NODE_TYPES.literal:r=new RGBColor(o.options.literalStyle.colors[0]),s.css("background-color","rgba("+r.r+", "+r.g+", "+r.b+" ,1)"),this._setLiteralScale(s,function(){o._setImgBackground(s),o._scaleText(s)}),n.append(s);break;case h.NODE_TYPES.blankNode:r=new RGBColor(o.options.literalStyle.colors[0]),s.css("background-color","rgba("+r.r+", "+r.g+", "+r.b+" ,1)"),this._setResNodeScale(s,function(){o._setImgBackground(s),o._scaleText(s)}),a.append(s)}},this._model.itemsAdded.attach(function(){})},d.Layer.View.prototype.addTiles=function(t){var i=this;this.layoutEngine.add(t,function(){e.each(t,function(t,n){var o=e(n);console.log(n),console.log(o),o.data("Browsable")&&i._initBrowsability(o)})})},d.Layer.View.prototype.addOptionsBox=function(){this.$optionsContainer=e('<section class="'+h.CSS_CLASSES.options+'" class="'+h.CSS_CLASSES.clearfix+'"></section>'),this.$container.prepend(this.$optionsContainer)},d.Layer.View.prototype.addTimelineButton=function(){},d.Layer.View.prototype.addSorter=function(){var t=this,i=e.extend({},this.options.layoutEngine.getSortData);delete i.group;var n=L.sortOptions(i);this.$optionsContainer.prepend(n);var o=this.$optionsContainer.find(" > .sorter");o.find("."+this.options.layoutEngine.sortBy).addClass("selected");var a=this.$optionsContainer.find("a");o.append(L.groupDropDown({type:{label:"type",val:h.FA_TAG},token:{label:"node-type",val:h.TOKEN_TAG}}));var r=o.find("#GroupDropDown");r.change(function(){var i=e(this).val();return t.$container.find(".sorter > > > .selected").removeClass("selected"),t.layoutEngine.updateOptions({getSortData:{group:function(e){var t=e.attr("class"),n=RegExp("(s)*[a-zA-Z0-9]*"+i+"[a-zA-Z0-9]*(s)*","g"),o=t.match(n),a="";if(null!==o)for(var r=0;o.length>r;r++)a+=o[r]+" ";return a}}}),t.layoutEngine.updateSortData(t.$viewContainer.find(".item")),t.$container.find("> > .groupLabel").remove(),t.layoutEngine.updateOptions({layoutMode:"groupRows",sortBy:"group"}),!1}),a.click(function(){var i=e(this).attr("data-sort-value");return r.val("Group by..."),t.$optionsContainer.find(".sorter > > > .selected").removeClass("selected"),t.$container.find("> > .groupLabel").remove(),e(this).addClass("selected"),t.layoutEngine.updateOptions({layoutMode:"masonry",sortBy:i}),!1})},d.Layer.View.prototype.addFilter=function(){var t=this,i=L.filterOptions(t.options.filterBy);this.$optionsContainer.append(i);var n=this.$optionsContainer.find(" > .filter"),o=n.find("a");o.click(function(){var i=e(this).attr("data-filter-value");return"*"!==i&&(i="."+h.FA_TAG+i),t.$container.find(".filter > > > .selected").removeClass("selected"),e(this).addClass("selected"),t.layoutEngine.updateOptions({filter:i}),!1}),n.append('<input id="filterField" type="text" size="25" value="Enter search here.">');var a=n.find("#filterField");a.keyup(function(){var i=e(this).val();if(""!==i){if("*"!==i)if(t.options.supportRegExpFilter)try{i="div:regex(class, "+i+"), div > div:contains("+i+")"}catch(n){i="div > div:contains("+i+")"}else i="div > div:contains("+i+")"}else i="*";return t.$container.find(".filter > > > .selected").removeClass("selected"),t.layoutEngine.updateOptions({filter:i}),!1})},d.InitLayer=function(t,i,n){n.options.generateTimeline&&(n._$timelineContainer=e('<div class="timelineContainer">'),n._$parent.prepend(n._$timelineContainer),n._$timeline=e('<ul class="timeline"></ul>'),n._$timelineContainer.append(n._$timeline)),d.Layer.call(this,t,i,n,n.options.initQueries)},d.InitLayer.prototype=Object.create(d.Layer.prototype),d.InitLayer.prototype.constructor=d.InitLayer,d.DetailLayer=function(t,i,n,o){var r=this;this.$item=o,this.node=o.data("node");var l=a(n._queries.selectSubjectOf,this.node.uri),p=a(n._queries.selectObjectOf,this.node.uri),c=[];c.push({query:l,type:h.CSS_CLASSES.typeClasses.outgoing}),c.push({query:p,type:h.CSS_CLASSES.typeClasses.incoming});var f=t.find("> "+h.CSS_CLASSES.toSelector("overlayContent")),y=t.find("> span.close");S[n.pluginID].addEventHandler("click",function(){r.close()},y);var v={};v.label=o.find(".labelEn").text(),f.append(e(L.overlayContent(this.node))),d.Layer.call(this,f.find(".innerScroll"),i,n,c),this.$overlay=t,this.$overlayContent=f,this._initOverlayContent=function(t,i){r.update(),r.options.remoteOptions.remoteDynamically&&r.loadByRemote();var n=new RGBColor(r.$item.css("background-color"));t.css("background-color",n.toRGB()),e.each(f.children("div"),function(t,i){n.r-=10,n.b-=10,n.g-=10,e(i).css("background",n.toRGB())}),f.find("> .overlayColumn").css("width","100%"),f.find(".innerScroll").css("width",u.width()-parseInt(t.css("padding-left"))-parseInt(t.css("padding-right"))+"px"),f.find(".innerScroll").css("height",.95*u.height()+"px"),i()},r._initOverlayContent(t,function(){var e=s(h.CSS_CLASSES.preview),i=s(h.CSS_CLASSES.overlay);t.css({clip:w?e:i,opacity:1,zIndex:9999,pointerEvents:"auto"}),w?t.on(E,function(){t.off(E),setTimeout(function(){t.css("clip",i).on(E,function(){t.off(E),n.$body.addClass("noscroll")})},25)}):n.$body.addClass("noscroll")})},d.DetailLayer.prototype=Object.create(d.Layer.prototype),d.DetailLayer.prototype.constructor=d.DetailLayer,d.DetailLayer.prototype.loadByRemote=function(){var e=this;e.remoteDataLoader||(e.remoteDataLoader=new d.RemoteDataLoader(e.options.remoteOptions.remoteBackend,e.plugin.pluginID));var t=a(e.plugin._queries.remoteSubjectOf,e.node.uri),i=a(e.plugin._queries.remoteObjectOf,e.node.uri);e.remoteDataLoader.insertByQuery(t+" LIMIT "+e.options.remoteOptions.remoteLimit),e.remoteDataLoader.insertByQuery(i+" LIMIT "+e.options.remoteOptions.remoteLimit)},d.DetailLayer.prototype.close=function(){var e=this;e.plugin.removeLayer(e),e.$overlayContent.children().remove("");var t=l(e.$item),i="rect("+t.top+"px "+(t.left+t.width)+"px "+(t.top+t.height)+"px "+t.left+"px)";
e.$overlay.css({clip:i,opacity:1,pointerEvents:"none"}),w?e.$overlay.on(E,function(){e.$overlay.off(E),setTimeout(function(){e.$overlay.css("opacity",0).on(E,function(){e.$overlay.off(E).css({clip:"auto",zIndex:-1}),e.$item.data("isExpanded",!1)})},25)}):e.$overlay.css({opacity:0,zIndex:-1})},d.TemplatesLoader=function(e){this._templateInitDfd=e,this._neededTemps=["filterOptions","sortOptions","stdNode","groupDropDown","overlayContent","overlayItem","previewItem"],this._methodsAreLoaded=function(){for(var e=0;arguments[0[e++]]!==n;)if("function"!=typeof L[arguments[e]])return!1;return!0}},d.TemplatesLoader.prototype._isLoaded=function(){return this._methodsAreLoaded(this._neededTemps)?(this._templateInitDfd.resolve(),!0):(console.log(h.MESSAGES.error.template),this._templateInitDfd.reject(),!1)},d.TemplatesLoader.prototype.extractByFile=function(t){var i=this;e.get(t,function(t){var n=e("<div>");n.append(t),n.children().each(function(t,i){var n=-1!==i.id.indexOf("par_");n&&(i.id=i.id.slice(4)),L[i.id]=Handlebars.compile(e(i).html()),n&&Handlebars.registerPartial(i.id,e(i).html())}),i._isLoaded()},"html")},d.TemplatesLoader.prototype.getPrecompiledTemplates=function(){return L=t.visaRDF.templates,this._isLoaded()},d.RemoteDataLoader=function(t,i){this.sites=t,this.pluginID=i,this._insertDataByQuery=function(t,i,o){b.executeQuery(t,i,function(t){if(t){t.subject!==n&&(t=[t]);var i="INSERT DATA {";e.each(t,function(e,t){t.subject===n?console.log("Resultset disfigured."):i+="uri"===t.subject.type?"<"+t.subject.value+"> ":"<"+t.subject.value+"> ",i+="<"+t.predicate.value+"> ","uri"===t.object.type?i+="<"+t.object.value+">. ":"literal"===t.object.type&&(i+='"'+escape(t.object.value)+'". '),t.labelSub&&(i+="<"+t.subject.value+'> rdfs:label "'+t.labelSub.value+'". '),t.labelObj&&(i+="<"+t.object.value+'> rdfs:label "'+t.labelObj.value+'". '),t.labelPred&&_.add(t.predicate.value,t.labelPred.value)}),i+="}",v.executeQuery(i,function(){o&&o(!0)})}else o&&o(!1)})}},d.RemoteDataLoader.prototype.insertByQuery=function(t){var i=this;S[i.pluginID].trigger(h.EVENT_TYPES.loading.loadingStart,i),e.each(i.sites,function(e,n){i._insertDataByQuery(t,n,function(e){S[i.pluginID].trigger(h.EVENT_TYPES.loading.loadingDone,i),e&&S[i.pluginID].trigger(h.EVENT_TYPES.storeModified.insert,i)})})};var T={nodeFilters:{blacklist:{fn:function(e,t){return console.log(t),t},config:{}},predicateConcat:{fn:function(e,t){return console.log(t),t},config:{}}},tileFilters:{scale:{fn:function(e,t){return t}}},nodeTemplates:{},data:n,dataLoc:n,dataFormat:n,templatesPrecompiled:!0,templatesPath:"templates_wrapped/templates.html",sparqlData:n,generateTimeline:!1,initQueries:[{query:"SELECT ?subject ?label ?description ?type WHERE { ?subject rdfs:label ?label . OPTIONAL { ?subject rdfs:description ?description } . OPTIONAL { ?subject rdfs:comment ?description }. OPTIONAL {?subject rdfs:type ?type}}"}],rdfstoreOptions:{persistence:!0,name:"",overwrite:!0,engine:"",engineData:{mongoDomain:"",mongoPort:"",mongoOptions:{}}},layerOptions:{generateSortOptions:!0,usePreviews:!1,previewAsOverlay:!0,generateFilterOptions:!0,filterBy:[{value:"*",label:"showAll"}],modelOptions:{batchSize:25},remoteOptions:{defaultRemoteQuery:"SELECT ?subject ?predicate ?object { BIND( rdfs:label as ?predicate) ?subject ?predicate ?object. ?subject a <http://dbpedia.org/ontology/Place> . ?subject <http://dbpedia.org/property/rulingParty> ?x } LIMIT 500",remoteBackend:["http://zaire.dimis.fim.uni-passau.de:8080/bigdata/sparql"],remoteLimit:100,remoteDynamically:!0,remoteLabelBackend:["http://zaire.dimis.fim.uni-passau.de:8080/bigdata/sparql","http://dbpedia.org/sparql"],remoteLabels:!0},viewOptions:{supportRegExpFilter:!0,literalStyle:{dimension:{width:200,height:0},topPadding:10,bottomPadding:10,value:{height:30},predicate:{height:15},colors:["#777777"]},itemStyle:{dimension:{width:200,height:0},topPadding:10,bottomPadding:10,label:{height:40},description:{height:80},predicate:{height:15},colors:["#e2674a","#99CC99","#3399CC","#33CCCC","#996699","#C24747","#FFCC66","#669999","#CC6699","#339966","#666699"]},layoutEngine:{sortBy:"number",getSortData:{number:function(e){var t=e.hasClass("item")?e.find(".number").text():e.attr("data-number");return parseInt(t,10)},alphabetical:function(e){var t=e.find(".labelEn"),i=t.length?t:e;return i.text()}}}}}};d.prototype={_initRdfStore:function(){var t=this,i=e.Deferred();return o(v)&&(v=new d.RdfStore(t.options.rdfstoreOptions,function(){i.resolve()})),i.promise()},_initTemplating:function(){var t=this,i=e.Deferred();Handlebars.registerHelper("keysEach",function(e,t){var i="";for(var n in e)i+=t.fn(n);return i}),Handlebars.registerHelper("ifLang",function(e,t){return!e||e.lang!==n&&"en"!==e.lang?n:t.fn(this)}),Handlebars.registerHelper("predicateLabelRetriver",function(e,t){if(e&&!e.label){var i=e.value.split("#");1===i.length&&(i=i[0].split("/")),e.label=i[i.length-1]}return t.fn(this)});var o=new d.TemplatesLoader(i);return t.options.templatesPrecompiled?o.getPrecompiledTemplates():o.extractByFile(t.options.templatesPath),i.promise()},_generateQueries:function(){var e=this;e._queries={initQueries:this.options.initQueries,defaultRemoteQuery:this.options.layerOptions.remoteOptions.defaultRemoteQuery,remoteSubjectOf:" SELECT ?subject ?predicate ?object ?labelObj ?labelPred WHERE { BIND (<"+h.DUMMY+"> as ?subject) ?subject ?predicate ?object. OPTIONAL { ?object rdfs:label ?labelObj }. OPTIONAL { ?predicate rdfs:label ?labelPred }}",remoteObjectOf:" SELECT ?subject ?predicate ?object ?labelSub ?labelPred WHERE {BIND (<"+h.DUMMY+"> as ?object) ?subject ?predicate ?object. OPTIONAL { ?subject rdfs:label ?labelSub }. OPTIONAL { ?predicate rdfs:label ?labelPred }}",selectSubjectOf:" SELECT ?subject ?predicate ?label ?description WHERE {<"+h.DUMMY+"> ?predicate ?subject. OPTIONAL { ?subject rdfs:label ?label}. OPTIONAL { ?subject rdfs:description ?description } . OPTIONAL { ?subject rdfs:comment ?description }}",selectObjectOf:" SELECT ?subject ?predicate ?type ?label ?description WHERE {?subject ?predicate <"+h.DUMMY+">. OPTIONAL { ?subject rdfs:label ?label}. OPTIONAL { ?subject rdfs:description ?description } . OPTIONAL { ?subject rdfs:comment ?description }}",previewQuery:" SELECT ?label ?description ?type WHERE { <"+h.DUMMY+"> rdfs:label ?label . OPTIONAL { <"+h.DUMMY+"> rdfs:description ?description } . OPTIONAL { <"+h.DUMMY+"> rdfs:comment ?description } . OPTIONAL { <"+h.DUMMY+"> rdfs:type ?type}}",label:"SELECT ?label WHERE { <"+h.DUMMY+"> rdfs:label ?label . FILTER(LANG(?label) = '' || LANGMATCHES(LANG(?label), 'en'))}",blankNodeQuery:"SELECT ?object WHERE {<"+h.DUMMY+"> ?predicate ?object}"}},_checkInsertion:function(){var e=this,t=!1;return o(e.options.dataFormat)||(o(e.options.dataLoc)?o(e.options.data)||(t=!0,v.insertData(e.options.data,e.options.dataFormat,function(){S[e.pluginID].trigger(h.EVENT_TYPES.storeModified.insert,e)})):(t=!0,e._ajaxLoadData(e.options.dataLoc,e.options.dataFormat,function(t,i){v.insertData(t,i,function(){S[e.pluginID].trigger(h.EVENT_TYPES.storeModified.insert,e)})}))),t},_ajaxLoadData:function(t,i,n){var o=this;S[o.pluginID].trigger(h.EVENT_TYPES.loading.loadingStart,o),e.ajax({url:t,dataType:"text",success:function(e){n(e,i)}}).fail(function(){S[o.pluginID].trigger(h.EVENT_TYPES.loading.loadingDone,o),alert(h.MESSAGES.error.ajax)})},init:function(){var t=this;t._generateQueries(),S[this.pluginID].addEventHandler(h.EVENT_TYPES.storeModified.insert,function(){e.each(t._views,function(e,t){t.update(),console.log("view "+e+" is updating")})}),S[this.pluginID].addEventHandler("smartresize",function(){var e=t._$parent.children(h.CSS_CLASSES.toSelector("overlay"));e.css("clip",s(h.CSS_CLASSES.overlay));var i=e.find(".innerScroll");i.css("width",u.width()-parseInt(e.css("padding-left"))-parseInt(e.css("padding-right"))+"px"),i.css("height",.95*u.height()+"px")},u),"pending"===g.state()&&(g=e.Deferred(),e.when(t._initRdfStore(),t._initTemplating()).done(function(){var i={};e.each(t.options.nodeFilters,function(e,t){t.template&&(L[e]?console.log("Template with identifier "+e+" already defined"):i[e]=Handlebars.compile(t.template))}),t.nodeTemplates=e.extend(!0,{},L,i),console.log(t.nodeTemplates),g.resolve()})),e.when(g.promise()).done(function(){t._views=[],t._views.push(new d.InitLayer(t._$parent,t.options.layerOptions,t)),t._checkInsertion()||(t.options.sparqlData===n?t._views[0].update():t._views[0].addItems(t.options.sparqlData))})},addLayer:function(e){this._views.push(e)},removeLayer:function(e){for(var t=0;this._views.length>t;t++)if(this._views[t]===e){this._views.splice(t,1),1===this._views.length&&this.$body.removeClass("noscroll");break}},insertData:function(t,i){var n=this;e.when(g.promise()).done(function(){v.insertData(t,i,function(){S[n.pluginID].trigger(h.EVENT_TYPES.storeModified.insert,n)})})},insertDataPath:function(t,i){var n=this;e.when(g.promise()).done(function(){n._ajaxLoadData(t,i,n._selfProxy(n.insertData))})},insertDataFile:function(t,i){var n=this,o=new FileReader;o.onload=function(){var t=this.result;e.when(g.promise()).done(function(){n.insertData(t,i)})},o.readAsText(t)},insertRemoteDataQuery:function(t,i){var o=this;e.when(g.promise()).done(function(){(i===n||""===i)&&(i=o._queries.defaultRemoteQuery),new d.RemoteDataLoader([t],o.pluginID).insertByQuery(i)})},clearStore:function(){var t=this;v.executeQuery("CLEAR ALL",function(){console.log("store cleared"),e.each(t._views,function(e,t){t.removeAllItems()})})},destroy:function(){var e=this;S[e.pluginID].destory(),S[e.pluginID]=n,e._$parent[m]=null}},e.fn[m]=function(t){return this.each(function(){e.data(this,"plugin_"+m)||e.data(this,"plugin_"+m,new d(this,t))})}}(jQuery,window,document);