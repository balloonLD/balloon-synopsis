/*! bSynopsis 2014-04-28 */
(function(e,t,n,i){function o(t,n){e.each(n,function(e,i){"string"==typeof i?n[e]=t+i:o(t,i)})}function a(e){return e===i||null===e}function r(e){return e&&(e.CSS_CLASSES?console.log(y.MESSAGES.warn.cssAppend):e.CSS_CLASSES=y.CSS_CLASSES),e}function s(e,t){return e.replace(RegExp(y.DUMMY,"g"),t)}function l(e){return owl.deepCopy(e)}function p(t){var n=null,i=null;return t?e("BODY").hasClass("noscroll")?(n=S.width(),i=S.height()):(e("BODY").addClass("noscroll"),n=S.width(),i=S.height(),e("BODY").removeClass("noscroll")):(n=S.width(),i=S.height()),{width:n,height:i}}function c(e){var t;switch(e){case y.CSS_CLASSES.overlay:return t=p(!0),"rect(0px "+t.width+"px "+t.height+"px 0px)";case y.CSS_CLASSES.preview:return t=p(!1),"rect("+.25*t.height+"px "+.75*t.width+"px "+.75*t.height+"px "+.25*t.width+"px)";default:return console.log("No clip data found."),""}}function d(e){var t=S.scrollTop(),n=S.scrollLeft(),i=e.offset();return{left:i.left-n,top:i.top-t,width:e.outerWidth(),height:e.outerHeight()}}function u(){var e={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"};return e[Modernizr.prefixed("transition")]}function h(){return I++}function f(t,n){this._selfProxy=function(t){return e.proxy(t,this)},this.pluginID=h(),this._$parent=e(t),this.$body=e("BODY"),T[this.pluginID]=new f.EventManager(this._$parent),this._$parent.addClass(L+"_"+this.pluginID),this._$parent.addClass(L),this.options=e.extend(!0,{},x,n),this._defaults=x,this._name=L,this._expandedOverlaysCount=0,this._queries={},this.init()}var S=e(t),y={FA_TAG:"synopsis_filter_",TOKEN_TAG:"synopsis_token_",NODE_TYPES:{stdNode:"stdNode",literal:"literal",blankNode:"blankNode",resNode:"resNode"},CSS_PREFIX:"synopsis_",CSS_CLASSES:{outerContainer:"outerContainer",viewContainer:"container",options:"options",optionCombo:"option-combo",optionSet:"option-set",groupLabel:"groupLabel",filter:"filter",clearfix:"clearfix",loader:"loading",preview:"preview",previewItem:"preview-item",previewContent:"previewContent",overlay:"overlay",overlayContent:"overlayContent",innerScroll:"innerScroll",innerNoScroll:"innerNoScroll",buttonClose:"close",timelineContainer:"timelineContainer",timeline:"timeline",buttonTimeline:"btnTimeline",sorter:"sorter",textScale:"textScale",tileClasses:{tile:"tile",content:"tileContent",label:"label",showURI:"showURI",predicate:"predicate",predicateLabel:"predicateLabel",typeImage:"typeImage",number:"number"},typeClasses:{incoming:"incoming",outgoing:"outgoing"},patternClasses:{uri:"uri",literal:"literal",blanknode:"blank"}},DUMMY:"#replaceMe#",EVENT_TYPES:{store:{insert:"dataInsert"},loading:{done:"loadingDone",start:"loadingStarted"},layout:{done:"layoutingDone"}},MESSAGES:{out:{selectAllFilters:"Select All"},error:{ajax:"Error on loading data.",remote:"Error on loading remote data.",template:"Error on loading template data.",tokenType:"Unknown token type of item."},warn:{cssAppend:"CSS classes already defined",fileTypeNotKnown:"Couldn't get filetype. Using: ",filterInput:"Filterinput is empty",filterName:"Filtername duplicate found"}}},g={toClass:function(e){return y.CSS_PREFIX+e},toToken:function(e){return y.TOKEN_TAG+e},toFilterable:function(e){return y.FA_TAG+e},toClassSelector:function(e){return"."+y.CSS_PREFIX+e},toSelector:function(e){return"."+e}};o(y.CSS_PREFIX,y.CSS_CLASSES),e.extend(e.Isotope.prototype,{_groupRowsReset:function(){this.groupRows={x:0,y:0,gutter:0,height:0,currentGroup:null}},_groupRowsLayout:function(t){var n=this,i=this.element.width(),o=this.options.sortBy,a=this.groupRows;t.each(function(){var t=e(this),r=t.outerWidth(!0),s=t.outerHeight(!0),l=e.data(this,"isotope-sort-data")[o];if(l!==a.currentGroup?(a.x=0,a.height+=a.currentGroup?n.groupRows.gutter:0,a.y=a.height,a.currentGroup=l,s>n.groupRows.gutter&&(n.groupRows.gutter=s)):0!==a.x&&r+a.x>i&&(a.x=0,a.y=a.height),t.find(g.toSelector(y.CSS_CLASSES.groupLabel)).remove(),""!==l){for(var p=l.split("_")[0]+"_",c=l.split(p),d="<div class='"+y.CSS_CLASSES.groupLabel+"' >",u=1;c.length>u;u++)d+=c[u];d+="</div>",t.append(d)}n._pushPosition(t,a.x,a.y),a.height=Math.max(a.y+s,a.height),a.x+=r})},_groupRowsGetContainerSize:function(){return{height:this.groupRows.height}},_groupRowsResizeChanged:function(){return!0}}),e.expr[":"]["class-prefix"]=function(t,n,i){var o=i[3];if(o){var a='[class^="'+o+'"], [class*=" '+o+'"]';return e(t).is(a)}return!0},e.expr[":"].regex=function(e,t,n){var i,o=n[3].split(","),a=/^(data|css):/,r={method:o[0].match(a)?o[0].split(":")[0]:"attr",property:o.shift().replace(a,"")},s="ig";try{i=RegExp(o.join("").replace(/^\s+|\s+$/g,""),s)}catch(l){return!1}return i.test(jQuery(e)[r.method](r.property))};var v=console.log.bind(console),m=function(){var n=0;this._requestSPARQLCrossDomain=function(o,a,r){var s=!1,l=n++;t["cbFunc"+l]=function(e){e&&e.query&&e.query.results?(s=!0,r(e.query.results.sparql.result,s)):console.log("Nothing returned from getJSON."),r(null,s),t["cbFunc"+l]=i},o||alert("No query was passed.");var p="http://query.yahooapis.com/v1/public/yql?q="+encodeURIComponent('use "http://triplr.org/sparyql/sparql.xml" as sparql; select * from sparql where query="'+o+'" and service="'+a)+'"&format=json&callback=cbFunc'+l;e.ajax({dataType:"jsonp",url:p,success:t.cbFunc,error:function(e,t,n){console.log("Error on yql query."),console.log(n),r(null,s)}})}};m.prototype.executeQuery=function(e,t,n){this._requestSPARQLCrossDomain(e,t,n)};var C=function(){this.values={}};C.prototype.add=function(e,t){this.values[e]=t},C.prototype.retrieve=function(e){return this.values[e]},C.prototype.contains=function(e){return e in this.values};var b,E=e.Deferred(),L="bSynopsis",_=new m,T=[],w=new C,N=u(),O=Modernizr.csstransitions,A={rdf:"http://www.w3.org/1999/02/22-rdf-syntax-ns#",rdfs:"http://www.w3.org/2000/01/rdf-schema#",owl:"http://www.w3.org/2002/07/owl#",rif:"http://www.w3.org/2007/rif#",foaf:"http://xmlns.com/foaf/0.1/",dbpedia:"http://dbpedia.org/resource/","dbpedia-owl":"http://dbpedia.org/ontology/",dbpprop:"http://dbpedia.org/property/",geo:"http://www.w3.org/2003/01/geo/wgs84_pos#",dc:"http://purl.org/dc/terms/"},D={},I=0;f.Event=function(e){this._sender=e,this._listeners=[]},f.Event.prototype={attach:function(e){this._listeners.push(e)},notify:function(e){var t;for(t=0;this._listeners.length>t;t+=1)this._listeners[t](this._sender,e)}},f.EventManager=function(e){return e?(this.stdObject=e,this._evHandlerHistory={},i):(v("EventManager not created"),!1)},f.EventManager.prototype.addEventHandler=function(e,t,n,o){var a=this;n===i&&(n=a.stdObject),a._evHandlerHistory[e]===i&&(a._evHandlerHistory[e]=[]),a._evHandlerHistory[e].push({id:o,object:n,handler:t}),n.on(e,t)},f.EventManager.prototype.removeEventHandler=function(t,n,o){var a=this;e.each(a._evHandlerHistory[t],function(a,r){if(n===r.id)if(o!==i){if(e.data(r.object)===e.data(o))return r.object.off(t,r.handler),!1}else r.object.off(t,r.handler)})},f.EventManager.prototype.trigger=function(e,t,n){n?n.trigger(e,t):this.stdObject.trigger(e,t)},f.EventManager.prototype.destroy=function(){e.each(this._evHandlerHistory,function(t,n){e.each(n,function(e,n){n.object.off(t,n.handler)})})},f.RdfStore=function(t,n){var i=this;this._store=null,this._queryPrefixes="",this._generateQueryPrefix=function(e,t){i._queryPrefixes+="PREFIX "+e+": <"+t+"> "},e.each(A,function(e,t){i._generateQueryPrefix(e,t)}),new rdfstore.Store(t,function(e){i._store=e,n()})},f.RdfStore.prototype.insertData=function(t,n,i){var o=this;if("text/turtle"===n||"text/plain"===n||"text/n3"===n){var r=t.match(/.*@prefix.*>(\s)*./g);r&&e.each(r,function(e,t){var n=t.split(/>(\s)*./)[0].split(/:(\s)*</),i=n[0].replace(/@prefix(\s)*/,""),r=n[2];a(A[i])&&(A[i]=r,o._generateQueryPrefix(i,r))})}else if("application/ld+json"===n||"application/json"===n){var s=t["@context"];s&&e.each(s,function(e,t){a(A[t])&&(A[e]=t,o._generateQueryPrefix(e,t))})}this._store.load(n,t,function(){i()})},f.RdfStore.prototype.executeQuery=function(e,t,n){this._store.execute(this._queryPrefixes+e,function(i,o){i?t(o):(v("Error on executing: "+e),n())})},f.LayoutEngine=function(t,n){this._container=t,t.isotope(e.extend(n,{onLayout:function(){t.trigger(y.EVENT_TYPES.layout.done)}}))},f.LayoutEngine.prototype.add=function(e,t){this._container.isotope("insert",e,t)},f.LayoutEngine.prototype.reLayout=function(){this._container.isotope("reLayout")},f.LayoutEngine.prototype.remove=function(e,t){this._container.isotope("remove",e,t)},f.LayoutEngine.prototype.updateSortData=function(e){this._container.isotope("updateSortData",e)},f.LayoutEngine.prototype.updateOptions=function(e){this._container.isotope(e)},f.Node=function(e,t){this.id=e.index,this.type=y.NODE_TYPES.stdNode,this.useTemplateID=this.type,this.filterables=[],this.componentTypes={},this.components={},this.style=t,e.predicate&&(this.filterables.push(g.toFilterable(e.predicate.type)),this.addComponent("predicate",e.predicate)),e.description&&this.addComponent("description",e.description)},f.Node.prototype.addComponent=function(e,t,n){this.componentTypes[e]?this.componentTypes[e]++:this.componentTypes[e]=1;var i,o=e+this.componentTypes[e];i=n?new f.Node.Component(o,e,t,n):new f.Node.Component(o,e,t),this.components[o]=i},f.Node.prototype.hasComponent=function(e){return this.components.hasOwnProperty(e)},f.Node.prototype.getFComponentOT=function(e){return this.componentTypes[e]?this.components[e+"1"]:!1},f.Node.prototype.hasComponentType=function(e){return this.componentTypes.hasOwnProperty(e)},f.Node.prototype.forEachComponentType=function(e,t){for(var n=1;this.componentTypes[e]>=n;n++)t(this.components[e+n])},f.Node.prototype.getType=function(){return this.type},f.Node.prototype.getTemplateIdentifier=function(){return this.useTemplateID},f.Node.prototype.setPredicateLabel=function(e,t){this.components["predicate"+e].label=t},f.Node.prototype.generateTile=function(){var t=e(D.tileWrapper(r({node:this}))).append(e(D[this.useTemplateID](r({node:this}))));return t.data("node",this),v("Tile generated"),v(t),t},f.Node.Component=function(e,t,n,i){this.id=e,this.type=t,this.data=n,this.style=i},f.ResNode=function(e){f.Node.call(this,e);var t=this,n=function(){var e=t.components.uri1.data;return t.forEachComponentType("predicate",function(t){e+=t.value}),e};this.type=y.NODE_TYPES.resNode,this.addComponent("uri",e.subject.value,{display:"none"}),a(e.label)?this.addComponent("label",{value:this.uri}):(e.label.value=unescape(e.label.value),this.addComponent("label",e.label)),this.id=n(),v(this)},f.ResNode.prototype=Object.create(f.Node.prototype),f.ResNode.prototype.constructor=f.ResNode,f.ResNode.prototype.merge=function(t){var n=this,i=!1;return e.each(t,function(t,o){switch(t){case"label":o.lang&&"en"===o.lang&&!o.lang&&"en"!==o.lang&&(i=!0,this.label=o);break;case"predicates":var a=!0;e.each(n.predicates,function(e,t){t.value===o[0].value&&t.type===o[0].type?a=!1:-1===n.filterables.indexOf(g.toFilterable(o[0].type))&&n.filterables.push(g.toFilterable(o[0].type))}),a&&(i=!0,n.predicates.push(o[0]))}}),i},f.ResNode.prototype.generateTile=function(){var e=f.Node.prototype.generateTile.call(this);return v("ResNode Tile generated"),e},f.LiteralNode=function(e){var t=this;f.Node.call(this,e);var n=function(){var e=t.getFComponentOT("label").data.value;return t.forEachComponentType("predicate",function(t){e+=t.value}),e};this.type=y.NODE_TYPES.literal,v(e.subject.value),this.addComponent("label",e.subject),this.id=n(),v(this)},f.LiteralNode.prototype=Object.create(f.Node.prototype),f.LiteralNode.prototype.constructor=f.LiteralNode,f.LiteralNode.prototype.generateTile=function(){var e=f.Node.prototype.generateTile.call(this);return v("LiteralNode Tile generated"),e},f.BlankNode=function(e){f.Node.call(this,e);var t=function(){return"_"+Math.random().toString(36).substr(2,9)};this.type=y.NODE_TYPES.blankNode,this.addComponent("label",{value:"BlankNode - TODO"}),this.id=t()},f.BlankNode.prototype=Object.create(f.Node.prototype),f.BlankNode.prototype.constructor=f.BlankNode,f.BlankNode.prototype.generateTile=function(){var e=f.Node.prototype.generateTile.call(this);return v("BlankNode Tile generated"),e},f.NodeFactory={makeNode:function(e,t){var n;switch(e.subject.token){case g.toToken(y.CSS_CLASSES.patternClasses.blanknode):n=new f.BlankNode(e);break;case g.toToken(y.CSS_CLASSES.patternClasses.literal):n=new f.LiteralNode(e,t.literalStyle);break;case g.toToken(y.CSS_CLASSES.patternClasses.uri):!e.label||e.label.lang!==i&&"en"!==e.label.lang||(n=new f.ResNode(e,t.itemStyle));break;default:console.log(y.MESSAGES.error.tokenType+e.subject.token)}return n}},f.Layer=function(t,n,i,o){var a=this;this.plugin=i,this.options=n,this.filterNames=[],e.each(i.options.nodeFilters,function(e,t){v("Filters found:"),v(t),a.filterNames.push(e)}),e.each(i.options.tileFilters,function(e,t){v(t),a.filterNames[e]?console.log(y.MESSAGES.warn.filterName):a.filterNames.push(e)}),this.model=new f.Layer.Model(o,n.modelOptions,i._queries.label),this.view=new f.Layer.View(this.model,t,n.viewOptions),this.model.itemsAdded.attach(function(e,t){a.view.paint(t.addedNodes,a.plugin)}),(n.generateSortOptions||n.generateFilterOptions||i.options.generateTimeline)&&(this.view.addOptionsBox(),n.generateSortOptions&&this.view.addSorter(),n.generateFilterOptions&&this.view.addIsotopeFilter())},f.Layer.prototype.update=function(){this.model.update()},f.Layer.prototype.switchFilterState=function(t){var n=this;"on"===t?(n.filterNames=[],e.each(n.plugin.options.nodeFilters,function(e){n.filterNames.push(e)}),e.each(n.plugin.options.tileFilters,function(e){n.filterNames[e]?console.log(y.MESSAGES.warn.filterName):n.filterNames.push(e)})):-1!==this.filterNames.indexOf(t)?this.filterNames.splice(this.filterNames.indexOf(t),1):this.filterNames.push(t);var i={},o={};e.each(this.filterNames,function(e,t){n.plugin.options.nodeFilters[t]&&(i[t]=n.plugin.options.nodeFilters[t]),n.plugin.options.tileFilters[t]&&(o[t]=n.plugin.options.tileFilters[t])}),this.view.clearView(function(){n.view.paint(n.model.getNodes(),n.plugin,i,o)})},f.Layer.prototype.removeAllItems=function(){this.model.clearModel()},f.Layer.Model=function(t,n,i){var o=this;this.viewQueries=t,this.labelQuery=i,this.options=n,this._nodes={},this.nodesLength=0,this.itemsAdded=new f.Event(this),this.modelCleared=new f.Event(this),this.itemUpdated=new f.Event(this),this._checkItemsHelp=function(e,t){var n=e.slice(t);n.length>0&&o.checkItems(n)},this._fetchPredicateLabel=function(t){if(t.hasComponentType("predicate"))for(var n=1;t.componentTypes.predicate>n;n++){var i=t.components["predicate"+n];if(w.contains(i.value))t.setPredicateLabel(n,w.retrieve(i.value));else{var a=s(o.labelQuery,i.value);b.executeQuery(a,function(n){n&&n[0]&&e.each(n,function(e,n){t.setPredicateLabel(e,n.label.value),w.add(i.value,n.label.value)})})}}return t}},f.Layer.Model.prototype.getNodes=function(){return l(this._nodes)},f.Layer.Model.prototype.checkItems=function(t){var n=t.length,o=this,a=o.options.batchSize>n?n:o.options.batchSize,r=t.slice(0,a),s={};e.each(r,function(e,t){t.subject.token=g.toToken(g.toClass(t.subject.token)),t.index=o.nodesLength+1;var n=f.NodeFactory.makeNode(t,o.options);if(n){switch(n.getType()){case y.NODE_TYPES.resNode:n.id in o._nodes?o._nodes[n.id].merge(n)?(n=o._nodes[n.id],o.itemUpdated.notify(n)):n=i:(o._nodes[n.id]=n,o.nodesLength++);break;case y.NODE_TYPES.literal:n.id in o._nodes?(n=i,v("literalupdate")):(o._nodes[n.id]=n,o.nodesLength++);break;case y.NODE_TYPES.blankNode:n.id in o._nodes?(v(n),v("blankNodeupdate"),n=i):(o._nodes[n.id]=n,o.nodesLength++)}n&&(n=o._fetchPredicateLabel(n),s[n.id]=n)}}),this.itemsAdded.notify({addedNodes:l(s),allNodes:this.getNodes()}),o._checkItemsHelp(t,a)},f.Layer.Model.prototype.update=function(){var e=this;this.allResults=[];for(var t=0;this.viewQueries.length>t;t++)b.executeQuery(this.viewQueries[t].query,function(n){if(n&&0!==n.length)for(var i=0;n.length>i;i++)e.viewQueries[t].type&&(n[i].predicate.type=e.viewQueries[t].type),e.allResults.push(n[i])});this.allResults.length>0?e.checkItems(this.allResults):v("Nothing to add to View")},f.Layer.Model.prototype.clearModel=function(){this._nodes={},this.modelCleared.notify()},f.Layer.View=function(t,n,i){var o=this;this.options=i,this._model=t,this.$container=n,this.$outerContainer=e('<div class="'+y.CSS_CLASSES.outerContainer+'"></div>'),this.$viewContainer=e('<div class="'+y.CSS_CLASSES.viewContainer+'"></div>'),this.$container.append(this.$outerContainer),this.$outerContainer.append(this.$viewContainer),this.layoutEngine=new f.LayoutEngine(this.$viewContainer,i.layoutEngine),this._getCorrespondingTile=function(e){var t=this.$viewContainer.find(g.toClassSelector(e.id));return v("CorrespondingTile"),v(t),t},this._model.modelCleared.attach(function(){o.layoutEngine.remove(e(g.toSelector(y.CSS_CLASSES.tileClasses.tile)),function(){v("view cleared")})})},f.Layer.View.prototype.paint=function(t,n,i,o){var a=this;filters=i?i:n.options.nodeFilters;var r=(new Date).getTime();e.each(filters,function(i,o){e.isEmptyObject(t)?console.log(y.MESSAGES.warn.filterInput):t=o.fn(n,t,o.config,a),v("Filter "+i+" done at: "+((new Date).getTime()-r)+" milisec")});var s=e("<div>");e.each(t,function(t,n){s.append(e(n.generateTile()))}),filters=o?o:n.options.tileFilters,s=s.children(),e.each(filters,function(e,t){s=t.fn(n,s,t.config,a),v("Filter "+e+" done at: "+((new Date).getTime()-r)+" milisec")}),this.addTiles(s)},f.Layer.View.prototype.clearView=function(e){this.removeTiles(this.$viewContainer.find(g.toSelector(y.CSS_CLASSES.tileClasses.tile))),e&&e()},f.Layer.View.prototype.removeTiles=function(t){var n=this;e.each(t,function(t,i){var o=e(i);n.layoutEngine.remove(o)})},f.Layer.View.prototype.addTiles=function(e){this.layoutEngine.add(e)},f.Layer.View.prototype.addOptionsBox=function(){this.$optionsContainer=e('<section class="'+y.CSS_CLASSES.options+'" class="'+y.CSS_CLASSES.clearfix+'"></section>'),this.$container.prepend(this.$optionsContainer)},f.Layer.View.prototype.addSorter=function(){var t=this,n=e.extend({},this.options.layoutEngine.getSortData);delete n.group;var i=D.sortOptions(r({optionSet:n}));this.$optionsContainer.prepend(i);var o=this.$optionsContainer.find(" > "+g.toSelector(y.CSS_CLASSES.sorter));o.find("."+this.options.layoutEngine.sortBy).addClass("selected");var a=this.$optionsContainer.find("a");o.append(D.groupDropDown(r({type:{label:"type",val:y.FA_TAG},token:{label:"node-type",val:y.TOKEN_TAG}})));var s=o.find("#GroupDropDown");s.change(function(){var n=e(this).val();return t.$container.find(g.toSelector(y.CSS_CLASSES.sorter)+" > > > .selected").removeClass("selected"),t.layoutEngine.updateOptions({getSortData:{group:function(e){var t=e.attr("class"),i=RegExp("(s)*[a-zA-Z0-9]*"+n+"[a-zA-Z0-9_]*(s)*","g"),o=t.match(i),a="";if(null!==o)for(var r=0;o.length>r;r++)a+=o[r]+" ";return a}}}),t.layoutEngine.updateSortData(t.$viewContainer.find(g.toSelector(y.CSS_CLASSES.tileClasses.tile))),t.$container.find("> > "+g.toSelector(y.CSS_CLASSES.groupLabel)).remove(),t.layoutEngine.updateOptions({layoutMode:"groupRows",sortBy:"group"}),!1}),a.click(function(){var n=e(this).attr("data-sort-value");return s.val("Group by..."),t.$optionsContainer.find(g.toSelector(y.CSS_CLASSES.sorter)+" > > > .selected").removeClass("selected"),t.$container.find("> > "+g.toSelector(y.CSS_CLASSES.groupLabel)).remove(),e(this).addClass("selected"),t.layoutEngine.updateOptions({layoutMode:"masonry",sortBy:n}),!1})},f.Layer.View.prototype.addIsotopeFilter=function(){var t=this,n=D.filterOptions(r({filterOptions:t.options.filterBy}));this.$optionsContainer.append(n);var i=this.$optionsContainer.find(" > "+g.toSelector(y.CSS_CLASSES.filter)),o=i.find("a");o.click(function(){var n=e(this).attr("data-filter-value");return"*"!==n&&(n="."+y.FA_TAG+n),t.$container.find(g.toSelector(y.CSS_CLASSES.filter)+" > > > .selected").removeClass("selected"),e(this).addClass("selected"),t.layoutEngine.updateOptions({filter:n}),!1}),i.append('<input id="filterField" type="text" size="25" value="Enter search here.">');var a=i.find("#filterField");a.keyup(function(){var n=e(this).val();if(""!==n){if("*"!==n)if(t.options.supportRegExpFilter)try{n="div:regex(class, "+n+"), div > div:contains("+n+")"}catch(i){n="div > div:contains("+n+")"}else n="div > div:contains("+n+")"}else n="*";return t.$container.find(g.toSelector(y.CSS_CLASSES.filter)+" > > > .selected").removeClass("selected"),t.layoutEngine.updateOptions({filter:n}),!1})},f.InitLayer=function(e,t,n){f.Layer.call(this,e,t,n,n.options.initQueries)},f.InitLayer.prototype=Object.create(f.Layer.prototype),f.InitLayer.prototype.constructor=f.InitLayer,f.DetailLayer=function(t,n,i,o){var a=this;if(this.$item=o,this.node=o.data("node"),i.options.generateTimeline){var l=e(D.timelineItem(a.node));l.css({"background-color":a.$item.css("background-color")}),i._$timeline.prepend(l),l.data("node",a.node),l.click(function(){i.addLayer(i.generateLayer(l)),i._$timelineContainer.data("isExpanded",!1),i._$timelineContainer.css({opacity:0,zIndex:-1})})}var p=[];switch(a.node.getType()){case y.NODE_TYPES.literal:var d=s(i._queries.literalIsObjectOf,this.node.getFComponentOT("value").data);p.push({query:d,type:y.CSS_CLASSES.typeClasses.incoming});break;case y.NODE_TYPES.resNode:default:var u=s(i._queries.selectSubjectOf,this.node.getFComponentOT("uri").data),h=s(i._queries.selectObjectOf,this.node.getFComponentOT("uri").data);p.push({query:u,type:y.CSS_CLASSES.typeClasses.outgoing}),p.push({query:h,type:y.CSS_CLASSES.typeClasses.incoming})}var v=t.find("> "+g.toSelector(y.CSS_CLASSES.overlayContent));if(i.options.generateTimeline){var m=t.find("> span"+g.toSelector(y.CSS_CLASSES.buttonTimeline));T[i.pluginID].addEventHandler("click",function(){if(i._$timelineContainer.data("isExpanded"))i._$timelineContainer.data("isExpanded",!1),i._$timelineContainer.css({opacity:0,zIndex:-1});else{i._$timelineContainer.data("isExpanded",!0);var e=new RGBColor(a.$item.css("background-color"));e.r-=20,e.b-=20,e.g-=20,i._$timelineContainer.css({"background-color":e.toRGB(),opacity:1,zIndex:9999})}},m)}var C=t.find("> span"+g.toSelector(y.CSS_CLASSES.buttonClose));T[i.pluginID].addEventHandler("click",function(){a.close()},C);var b={};b.label=o.find(g.toSelector(y.CSS_CLASSES.tileClasses.label)).text(),v.append(e(D.overlayContent(r({node:this.node})))),f.Layer.call(this,v.find(g.toSelector(y.CSS_CLASSES.innerScroll)),n,i,p),this.$overlay=t,this.$overlay.find("#filterSelect").multiSelect({selectAllText:y.MESSAGES.out.selectAllFilters},function(e){a.switchFilterState(e.val())}),this.$overlayContent=v,this._initOverlayContent=function(t,n){a.update(),a.options.remoteOptions.remoteDynamically&&a.loadByRemote();var i=new RGBColor(a.$item.css("background-color"));t.css("background-color",i.toRGB()),e.each(v.children("div"+g.toSelector("innerScroll")),function(t,n){i.r-=10,i.b-=10,i.g-=10,e(n).css("background",i.toRGB())}),v.find(g.toSelector(y.CSS_CLASSES.innerScroll)).css("width",S.width()-parseInt(t.css("padding-left"))-parseInt(t.css("padding-right"))+"px"),v.find(g.toSelector(y.CSS_CLASSES.innerScroll)).css("height",S.height()-v.find(g.toSelector(y.CSS_CLASSES.innerNoScroll)).height()+"px"),n()},a._initOverlayContent(t,function(){var e=c(y.CSS_CLASSES.preview),n=c(y.CSS_CLASSES.overlay);t.css({clip:O?e:n,opacity:1,zIndex:9998,pointerEvents:"auto"}),O?t.on(N,function(){t.off(N),setTimeout(function(){t.css("clip",n).on(N,function(){t.off(N),i.$body.addClass("noscroll")})},25)}):i.$body.addClass("noscroll")})},f.DetailLayer.prototype=Object.create(f.Layer.prototype),f.DetailLayer.prototype.constructor=f.DetailLayer,f.DetailLayer.prototype.loadByRemote=function(){var e=this;switch(e.remoteDataLoader||(e.remoteDataLoader=new f.RemoteDataLoader(e.options.remoteOptions.remoteBackend,e.plugin.pluginID)),e.node.getType()){case y.NODE_TYPES.resNode:var t=s(e.plugin._queries.remoteSubjectOf,e.node.getFComponentOT("uri").data),n=s(e.plugin._queries.remoteObjectOf,e.node.getFComponentOT("uri").data);e.remoteDataLoader.insertByQuery(t+" LIMIT "+e.options.remoteOptions.remoteLimit),e.remoteDataLoader.insertByQuery(n+" LIMIT "+e.options.remoteOptions.remoteLimit);break;case y.NODE_TYPES.literal:var i=s(e.plugin._queries.remoteLiteralIsObjectOf,e.node.getFComponentOT("value"));e.remoteDataLoader.insertByQuery(i+" LIMIT "+e.options.remoteOptions.remoteLimit)}},f.DetailLayer.prototype.close=function(){var e=this;e.plugin.removeLayer(e);var t=d(e.$item),n="rect("+t.top+"px "+(t.left+t.width)+"px "+(t.top+t.height)+"px "+t.left+"px)";e.$overlay.children().remove(""),e.$overlay.css({clip:n,opacity:1,pointerEvents:"none"}),O?e.$overlay.on(N,function(){e.$overlay.off(N),setTimeout(function(){e.$overlay.css("opacity",0).on(N,function(){e.$overlay.off(N).css({clip:"auto",zIndex:-1}),e.$overlay.remove(),e.$item.data("isExpanded",!1)})},25)}):(e.$overlay.css({opacity:0,zIndex:-1}),e.$overlay.remove())},f.TemplatesLoader=function(e){this._templateInitDfd=e,this._neededTemps=["filterOptions","sortOptions","tileWrapper","stdNode","groupDropDown","overlayContent","overlayWrapper","previewItem","timelineWrapper","timelineItem"],this._methodsAreLoaded=function(){for(var e=0;arguments[0[e++]]!==i;)if("function"!=typeof D[arguments[e]])return!1;return!0}},f.TemplatesLoader.prototype._isLoaded=function(){return this._methodsAreLoaded(this._neededTemps)?(this._templateInitDfd.resolve(),!0):(console.log(y.MESSAGES.error.template),this._templateInitDfd.reject(),!1)},f.TemplatesLoader.prototype.extractByFile=function(t){var n=this;e.get(t,function(t){var i=e("<div>");i.append(t),i.children().each(function(t,n){var i=-1!==n.id.indexOf("par_");i&&(n.id=n.id.slice(4)),D[n.id]=Handlebars.compile(e(n).html()),i&&Handlebars.registerPartial(n.id,e(n).html())}),n._isLoaded()},"html")},f.TemplatesLoader.prototype.getPrecompiledTemplates=function(){return D=t[L].templates,this._isLoaded()},f.RemoteDataLoader=function(t,n){this.sites=t,this.pluginID=n,this._insertDataByQuery=function(t,n,o){_.executeQuery(t,n,function(t){if(t){t.subject!==i&&(t=[t]);var n="INSERT DATA {";e.each(t,function(e,t){t.subject===i?v("Resultset disfigured."):n+="uri"===t.subject.type?"<"+t.subject.value+"> ":"<"+t.subject.value+"> ",n+="<"+t.predicate.value+"> ","uri"===t.object.type?n+="<"+t.object.value+">. ":"literal"===t.object.type&&(n+='"'+escape(t.object.value)+'". '),t.labelSub&&(n+="<"+t.subject.value+'> rdfs:label "'+t.labelSub.value+'". '),t.labelObj&&(n+="<"+t.object.value+'> rdfs:label "'+t.labelObj.value+'". '),t.labelPred&&w.add(t.predicate.value,t.labelPred.value)}),n+="}",b.executeQuery(n,function(){o&&o(!0)})}else o&&o(!1)})}},f.RemoteDataLoader.prototype.insertByQuery=function(t){var n=this;T[n.pluginID].trigger(y.EVENT_TYPES.loading.start,n),e.each(n.sites,function(e,i){n._insertDataByQuery(t,i,function(e){T[n.pluginID].trigger(y.EVENT_TYPES.loading.done,n),e&&T[n.pluginID].trigger(y.EVENT_TYPES.store.insert,n)})})};var x={nodeFilters:{blacklistPredURI:{fn:function(t,n,i){return e.each(n,function(t,o){o.hasComponentType("predicate")&&i&&e.each(i,function(e,t){for(var i=0;o.componentTypes.predicate>=i;i++){var a=RegExp(t).exec(o.components["predicate"+i].value);null!==a&&delete n[i]}})}),n},config:[]},blacklistURI:{fn:function(t,n,i){return e.each(n,function(t,o){o.hasComponentType("uri")&&i&&e.each(i,function(e,i){var a=RegExp(i).exec(o.components.uri1);null!==a&&delete n[t]})}),n},config:[]},multiResNode:{fn:function(t,n){var i=[];return e.each(n,function(e,t){"resNode"===t.type&&(t.components.uri1 in i?i[t.components.uri1].type="multiResNode":i[t.components.uri1]=t)}),n}},blankNode:{fn:function(t,n){return e.each(n,function(e,t){t.getType()==y.NODE_TYPES.stdNode&&v("TODO Blanknode")}),n},config:{}}},tileFilters:{scale:{fn:function(t,n,i){return e.each(n,function(t,n){var o,a=e(n),r=a.data("node");o=r.style?r.style:i.defaultStyles[r.getType()]?i.defaultStyles[r.getType()]:i.defaultStyles.stdNode,"number"!=typeof o.height?r.dynLayoutFn?r.dynLayoutFn(a,r,o,i):i.defaultDynLayoutFns[r.getType()]?i.defaultDynLayoutFns[r.getType()](a,r,o,i):i.defaultDynLayoutFns.stdNode(a,r,o,i):r.layoutFn?r.layoutFn(a,r,o,i):i.defaultLayoutFns[r.getType()]?i.defaultLayoutFns[r.getType()](a,r,o,i):i.defaultLayoutFns.stdNode(a,r,o,i)}),n},config:{multiplicator:1,defaultLayoutFns:{stdNode:function(t,n,i,o){var a=t.height()+i.topPadding,r=o.multiplicator;t.width(i.width*r);var s=i.height*r;t.height(s);var l=s-(i.topPadding+i.bottomPadding*r),p=0,c=[];e.each(n.components,function(e,t){c[e]=t.style?t.style:o.defaultContentStyles[t.type]?o.defaultContentStyles[t.type]:o.defaultContentStyles.stdComponent,!c[e]||c[e].display&&"none"==c[e].display||(p+=c[e].height)}),e.each(n.components,function(e,r){if(c[e]&&(!c[e].display||"none"!=c[e].display)){var s=c[e];a=r.layoutFn?r.layoutFn(t,n,i,r,s,o,a,l,p):o.defaultContentLayoutFns[r.type]?o.defaultContentLayoutFns[r.type](t,n,i,r,s,o,a,l,p):o.defaultContentLayoutFns.stdComponent(t,n,i,r,s,o,a,l,p)}})}},defaultDynLayoutFns:{stdNode:function(t,n,i,o){var a=t.height(),r=o.multiplicator,s=a+i.topPadding*r;t.width(i.width*r),e.each(n.components,function(e,a){var r;r=a.style?a.style:o.defaultContentStyles[a.type]?o.defaultContentStyles[a.type]:o.defaultContentStyles.stdComponent,!r||r.display&&"none"==r.display||(s=a.dynLayoutFn?a.dynLayoutFn(t,n,i,a,r,o,s):o.defaultContentDynLayoutFns[a.type]?o.defaultContentDynLayoutFns[a.type](t,n,i,a,r,o,s):o.defaultContentDynLayoutFns.stdComponent(t,n,i,a,r,o,s))}),t.height(s+i.bottomPadding*r-a)}},defaultContentLayoutFns:{predicate:function(e,t,n,i,o,a,r,s,l){var p=e.find(g.toClassSelector(i.id));v(g.toClassSelector(i.id)),console.log(p);var c=a.multiplicator,d=s*(o.height/l)-n.spacing*c,u=(n.width-n.leftPadding-n.rightPadding)*c;p.height(d),p.width(u),p.css("top",r),p.css("left",n.leftPadding),r+=d+n.spacing*c,p.children().height(d);var h=e.find(g.toSelector(y.CSS_CLASSES.tileClasses.typeImage)),f=e.find(g.toSelector(y.CSS_CLASSES.tileClasses.predicate)),S=e.find(g.toSelector(y.CSS_CLASSES.tileClasses.predicateLabel)),m=.2*u;return h.height("auto"),h.width(m),S.css("left",m),S.width(u-m),f.width(u),r},stdComponent:function(e,t,n,i,o,a,r,s,l){var p=e.find(g.toClassSelector(i.id)),c=a.multiplicator,d=s*(o.height/l)-n.spacing*c;return p.width((n.width-n.leftPadding-n.rightPadding)*c),p.height(d),p.css("top",r),p.css("left",n.leftPadding),r+=d+n.spacing*c}},defaultContentDynLayoutFns:{predicate:function(e,t,n,i,o,a,r){var s=e.find(g.toClassSelector(i.id)),l=a.multiplicator,p=o.height*l,c=(n.width-n.leftPadding-n.rightPadding)*l;s.height(p),s.width(c),s.css("top",r),s.css("left",n.leftPadding),r+=p+n.spacing*l,s.children().height(p);var d=e.find(g.toSelector(y.CSS_CLASSES.tileClasses.typeImage)),u=e.find(g.toSelector(y.CSS_CLASSES.tileClasses.predicate)),h=e.find(g.toSelector(y.CSS_CLASSES.tileClasses.predicateLabel)),f=.2*c;return d.height("auto"),d.width(f),h.css("left",f),h.width(c-f),u.width(c),r},stdComponent:function(e,t,n,i,o,a,r){var s=e.find(g.toClassSelector(i.id)),l=a.multiplicator;return s.width((n.width-n.leftPadding-n.rightPadding)*l),s.height(o.height*l),s.css("top",r),s.css("left",n.leftPadding),r+=(o.height+n.spacing)*l}},defaultStyles:{stdNode:{width:200,height:"dynamic",topPadding:10,leftPadding:10,rightPadding:10,bottomPadding:10,spacing:5}},defaultContentStyles:{predicate:{height:20},label:{height:40},stdComponent:{height:40}}}},textScale:{webWorker:!0,fn:function(e,t,n,i){return i.$viewContainer.on(y.EVENT_TYPES.layout.done,function(){var e=t.find(g.toSelector(y.CSS_CLASSES.textScale));e.parent().textfill({maxFontPixels:80,minFontPixels:8})}),t},config:{}},backgroundColor:{fn:function(t,n,i){var o=0;return e.each(n,function(t,n){o++;var a,r=e(n),s=r.data("node");a=s.style&&s.style.bgColors?s.style.bgColors:i.defaultStyles[s.getType()]?i.defaultStyles[s.getType()].bgColors:i.defaultStyles.stdNode.bgColors;var l=new RGBColor(a[o%a.length]);
l&&r.css("background-color","rgba("+l.r+", "+l.g+", "+l.b+" ,1)")}),n},config:{defaultStyles:{literal:{bgColors:["#777777"]},blankNode:{bgColors:["#777777"]},stdNode:{bgColors:["#e2674a","#99CC99","#3399CC","#33CCCC","#996699","#C24747","#FFCC66","#669999","#CC6699","#339966","#666699"]}}}},backgroundImg:{fn:function(t,n){return e.each(n,function(t,n){var i=e(n),o=i.data("node"),a="";switch(o.getType()){case y.NODE_TYPES.resNode:a=o.getFComponentOT("uri").data;break;case y.NODE_TYPES.literal:a=o.getFComponentOT("label").data.value}var r=a.replace(">","").split(".");switch(a.replace("<",""),r[r.length-1]){case"png":case"jpeg":case"svg":case"jpg":if(a){var s=e('<img src="'+a+'">');s.load(function(){var e=s.width(),t=s.height(),n=e/t,o=i.width(),a=i.height(),r=o/a,l=0;r>n?(l=o/n,s.width(o/n),s.height(a)):(s.width(l),s.height(o*n)),s.css({left:(o-l)/2,opacity:.5,position:"absolute"})}),i.prepend(s)}}}),n}},predicateLabel:{fn:function(n,i){return e.each(i,function(n,i){var o=e(i),a=o.find(g.toSelector(y.CSS_CLASSES.tileClasses.predicate)),r=o.find(g.toSelector(y.CSS_CLASSES.tileClasses.typeImage)),s=o.find(g.toSelector(y.CSS_CLASSES.tileClasses.predicateLabel));o.on("mouseenter",function(){a.css("visibility","visible"),r.css("visibility","hidden"),s.css("visibility","hidden")}),o.on("mouseleave",function(){s.stop(!0,!0),t.setTimeout(function(){a.css("visibility","hidden"),r.css("visibility","visible"),s.css("visibility","visible")},100)})}),i}},browsablity:{fn:function(t,n,i){return e.each(n,function(n,o){var a=e(o),r=a.data("node"),s=r.getType();s in i.types?e.each(i.types[s].browsingFns,function(e,n){n(t,r,a)}):e.each(i.defaultFns,function(e,n){n(t,r,a)})}),n},config:{types:{blankNode:{browsingFns:{fn:function(e,t,n){n.click(function(){})}}}},defaultFns:{fn:function(e,t,n){n.click(function(){e.addLayer(e.generateLayer(n))})}}}}},data:i,dataLoc:i,dataFormat:i,templatesPrecompiled:!0,templatesPath:"templates_wrapped/templates.html",sparqlData:i,generateTimeline:!0,initQueries:[{query:"SELECT ?subject ?label ?description ?type WHERE { ?subject rdfs:label ?label . OPTIONAL { ?subject rdfs:description ?description } . OPTIONAL { ?subject rdfs:comment ?description }. OPTIONAL {?subject rdfs:type ?type}}"}],rdfstoreOptions:{persistence:!0,name:"",overwrite:!0,engine:"",engineData:{mongoDomain:"",mongoPort:"",mongoOptions:{}}},layerOptions:{generateSortOptions:!0,usePreviews:!1,previewAsOverlay:!0,generateFilterOptions:!0,modelOptions:{batchSize:25},remoteOptions:{defaultRemoteQuery:"SELECT ?subject ?predicate ?object { BIND( rdfs:label as ?predicate) ?subject ?predicate ?object. ?subject a <http://dbpedia.org/ontology/Place> . ?subject <http://dbpedia.org/property/rulingParty> ?x } LIMIT 500",remoteBackend:["http://zaire.dimis.fim.uni-passau.de:8080/bigdata/sparql"],remoteLimit:100,remoteDynamically:!0,remoteLabelBackend:["http://zaire.dimis.fim.uni-passau.de:8080/bigdata/sparql","http://dbpedia.org/sparql"],remoteLabels:!0},viewOptions:{supportRegExpFilter:!0,filterBy:[{value:"*",label:"showAll"}],layoutEngine:{sortBy:"number",getSortData:{number:function(e){var t=e.hasClass("item")?e.find(g.toSelector(y.CSS_CLASSES.tileClasses.number)).text():e.attr("data-number");return parseInt(t,10)},alphabetical:function(e){var t=e.find(g.toSelector(y.CSS_CLASSES.tileClasses.label)),n=t.length?t:e;return n.text()}}}}}};f.prototype={_initRdfStore:function(){var t=this,n=e.Deferred();return v("Init RDFSTORE"),a(b)&&(b=new f.RdfStore(t.options.rdfstoreOptions,function(){n.resolve()})),n.promise()},_initTemplating:function(){var t=this,n=e.Deferred();Handlebars.registerHelper("toClass",function(e){return g.toClass(e)}),Handlebars.registerHelper("tScaleWrap",function(e){return e=Handlebars.Utils.escapeExpression(e),new Handlebars.SafeString("<span class='"+y.CSS_CLASSES.textScale+"' style='position:static'>"+e+"</span>")}),Handlebars.registerHelper("firstComp",function(e,t,n){var i="";return e.hasComponentType(t)&&(i+=n.fn(e.components[t+"1"])),i}),Handlebars.registerHelper("hasCompType",function(e,t,n){return e.hasComponentType(t)?n.fn(this):i}),Handlebars.registerHelper("compsEach",function(e,t,n){var i="";return e.forEachComponentType(t,function(e){i+=n.fn(e)}),i}),Handlebars.registerHelper("keysEach",function(e,t){var n="";for(var i in e)n+=t.fn(i);return n}),Handlebars.registerHelper("ifLang",function(e,t){return!e||e.lang!==i&&"en"!==e.lang?i:t.fn(this)}),Handlebars.registerHelper("predicateLabelRetriver",function(e,t){if(e&&!e.label){var n=e.value.split("#");1===n.length&&(n=n[0].split("/")),e.label=n[n.length-1]}return t.fn(this)});var o=new f.TemplatesLoader(n);return t.options.templatesPrecompiled?o.getPrecompiledTemplates():o.extractByFile(t.options.templatesPath),n.promise()},_generateQueries:function(){var e=this;e._queries={initQueries:this.options.initQueries,defaultRemoteQuery:this.options.layerOptions.remoteOptions.defaultRemoteQuery,remoteSubjectOf:" SELECT DISTINCT ?subject ?predicate ?object ?labelObj ?labelPred WHERE { BIND (<"+y.DUMMY+"> as ?subject) ?subject ?predicate ?object. OPTIONAL { ?object rdfs:label ?labelObj }. OPTIONAL { ?predicate rdfs:label ?labelPred }}",remoteObjectOf:" SELECT DISTINCT ?subject ?predicate ?object ?labelSub ?labelPred WHERE {BIND (<"+y.DUMMY+"> as ?object) ?subject ?predicate ?object. OPTIONAL { ?subject rdfs:label ?labelSub }. OPTIONAL { ?predicate rdfs:label ?labelPred }}",remoteLiteralIsObjectOf:" SELECT DISTINCT ?subject ?predicate ?object ?labelSub ?labelPred WHERE {BIND ('"+y.DUMMY+"' as ?object) ?subject ?predicate ?object. OPTIONAL { ?subject rdfs:label ?labelSub }. OPTIONAL { ?predicate rdfs:label ?labelPred }}",selectSubjectOf:" SELECT DISTINCT ?subject ?predicate ?label ?description WHERE {<"+y.DUMMY+"> ?predicate ?subject. OPTIONAL { ?subject rdfs:label ?label}. OPTIONAL { ?subject rdfs:description ?description } . OPTIONAL { ?subject rdfs:comment ?description }}",selectObjectOf:" SELECT DISTINCT ?subject ?predicate ?type ?label ?description WHERE {?subject ?predicate <"+y.DUMMY+">. OPTIONAL { ?subject rdfs:label ?label}. OPTIONAL { ?subject rdfs:description ?description } . OPTIONAL { ?subject rdfs:comment ?description }}",literalIsObjectOf:"SELECT DISTINCT ?subject ?predicate ?type ?label ?description WHERE {?subject ?predicate ?oLiteral. FILTER (STR(?oLiteral)='"+y.DUMMY+"'). OPTIONAL { ?subject rdfs:label ?label}. OPTIONAL { ?subject rdfs:description ?description } . OPTIONAL { ?subject rdfs:comment ?description }}",previewQuery:" SELECT DISTINCT ?label ?description ?type WHERE { <"+y.DUMMY+"> rdfs:label ?label . OPTIONAL { <"+y.DUMMY+"> rdfs:description ?description } . OPTIONAL { <"+y.DUMMY+"> rdfs:comment ?description } . OPTIONAL { <"+y.DUMMY+"> rdfs:type ?type}}",label:"SELECT DISTINCT ?label WHERE { <"+y.DUMMY+"> rdfs:label ?label . FILTER(LANG(?label) = '' || LANGMATCHES(LANG(?label), 'en'))}",blankNodeQuery:"SELECT DISTINCT ?object WHERE {<"+y.DUMMY+"> ?predicate ?object}"}},_checkInsertion:function(){var e=this,t=!1;return a(e.options.dataFormat)||(a(e.options.dataLoc)?a(e.options.data)||(t=!0,b.insertData(e.options.data,e.options.dataFormat,function(){T[e.pluginID].trigger(y.EVENT_TYPES.store.insert,e)})):(t=!0,e._ajaxLoadData(e.options.dataLoc,e.options.dataFormat,function(t,n){b.insertData(t,n,function(){T[e.pluginID].trigger(y.EVENT_TYPES.store.insert,e)})}))),t},_ajaxLoadData:function(t,n,i){var o=this;T[o.pluginID].trigger(y.EVENT_TYPES.loading.start,o),e.ajax({url:t,dataType:"text",success:function(e){i(e,n)}}).fail(function(){T[o.pluginID].trigger(y.EVENT_TYPES.loading.done,o),alert(y.MESSAGES.error.ajax)})},init:function(){var t=this;t._generateQueries(),T[this.pluginID].addEventHandler(y.EVENT_TYPES.store.insert,function(){e.each(t._views,function(e,t){t.update(),v("view "+e+" is updating")})}),T[this.pluginID].addEventHandler("smartresize",function(){var e=t._$parent.children(g.toSelector(y.CSS_CLASSES.overlay));e.css("clip",c(y.CSS_CLASSES.overlay));var n=e.find(g.toSelector(y.CSS_CLASSES.innerScroll));n.css("width",S.width()-parseInt(e.css("padding-left"))-parseInt(e.css("padding-right"))+"px"),n.css("height",S.height()-e.find(g.toSelector(y.CSS_CLASSES.innerNoScroll)).height()+"px")},S),t.options.generateTimeline&&(t._$timelineContainer=e('<div class="'+y.CSS_CLASSES.timelineContainer+'">'),t._$parent.prepend(t._$timelineContainer),t._$timeline=e('<ul class="'+y.CSS_CLASSES.timeline+'"></ul>'),t._$timelineContainer.append(t._$timeline)),"pending"===E.state()&&(E=e.Deferred(),e.when(t._initRdfStore(),t._initTemplating()).done(function(){var n={};e.each(t.options.nodeFilters,function(e,t){t.template&&(D[e]?console.log("Template with identifier "+e+" already defined"):n[e]=Handlebars.compile(t.template))}),e.extend(!0,D,n),E.resolve()})),e.when(E.promise()).done(function(){t._views=[],t._views.push(new f.InitLayer(t._$parent,t.options.layerOptions,t)),t._checkInsertion()||(t.options.sparqlData===i?t._views[0].update():t._views[0].addItems(t.options.sparqlData))})},addLayer:function(e){this._views.push(e)},generateLayer:function(t){t.data("isExpanded",!0);var n=t.data("node"),i=this,o=Math.random().toString(36).substr(2,9),a=D.overlayWrapper(r({id:n.id+o,nodeFilters:i.options.nodeFilters,tileFilters:i.options.tileFilters}));i._$parent.append(a);var s,l=i._$parent.find(g.toSelector(y.CSS_CLASSES.overlay)).find("div:contains('"+n.id+o+"')").parent(),p=e.extend(!0,{},i.options.layerOptions,{layoutEngine:{itemSelector:g.toSelector(y.CSS_CLASSES.tileClasses.tile),getSortData:{type:function(e){var t=e.attr("class");return t},group:function(e){for(var t=e.attr("class"),n=RegExp("(s)*[a-zA-Z0-9]*"+y.TOKEN_TAG+"[a-zA-Z0-9]*(s)*","g"),i=t.match(n),o="",a=0;i.length>a;a++)o+=i[a]+" ";return o}}},viewOptions:{filterBy:[{value:"*",label:"showAll"},{value:y.CSS_CLASSES.typeClasses.incoming,label:"in"},{value:y.CSS_CLASSES.typeClasses.outgoing,label:"out"}]}});return s=n.getType()===y.NODE_TYPES.resNode?new f.DetailLayer(l,p,i,t):n.getType()===y.NODE_TYPES.literal?new f.DetailLayer(l,p,i,t):new f.DetailLayer(l,p,i,t)},removeLayer:function(e){for(var t=0;this._views.length>t;t++)if(this._views[t]===e){this._views.splice(t,1),1===this._views.length&&this.$body.removeClass("noscroll");break}},insertData:function(t,n){var i=this;e.when(E.promise()).done(function(){b.insertData(t,n,function(){T[i.pluginID].trigger(y.EVENT_TYPES.store.insert,i)})})},insertDataPath:function(t,n){var i=this;e.when(E.promise()).done(function(){i._ajaxLoadData(t,n,i._selfProxy(i.insertData))})},insertDataFile:function(t){var n=this,i=new FileReader;i.onload=function(){var i=this.result,o="text/turtle";if(""===t.type){var a=t.name.split(".").pop();switch(a){case"ttl":o="text/turtle";break;case"turtle":o="text/turtle";break;case"n3":o="text/n3";break;case"json":o="application/json";break;case"jsld":o="application/ld+json";break;default:console.log(y.MESSAGES.warn.fileTypeNotKnown+o)}}else o=t.type;e.when(E.promise()).done(function(){n.insertData(i,o)})},i.readAsText(t)},insertRemoteDataQuery:function(t,n){var o=this;e.when(E.promise()).done(function(){(n===i||""===n)&&(n=o._queries.defaultRemoteQuery),new f.RemoteDataLoader([t],o.pluginID).insertByQuery(n)})},clearStore:function(){var t=this;b.executeQuery("CLEAR ALL",function(){v("store cleared"),e.each(t._views,function(e,t){t.removeAllItems()})})},addTileFilter:function(){},addNodeFilter:function(){},runQuery:function(e,t){b.executeQuery(e,function(e){t&&t(e)})},destroy:function(){var e=this;T[e.pluginID].destory(),T[e.pluginID]=i,e._$parent[L]=null}},e.fn[L]=function(t){return this.each(function(){e.data(this,"plugin_"+L)||e.data(this,"plugin_"+L,new f(this,t))})}})(jQuery,window,document),this.bSynopsis=this.bSynopsis||{},this.bSynopsis.templates=this.bSynopsis.templates||{},this.bSynopsis.templates.filterOptions=Handlebars.template(function(e,t,n,i,o){function a(e,t){var i,o="";return o+='\r\n                            <li><a data-filter-value="',(i=n.value)?i=i.call(e,{hash:{},data:t}):(i=e.value,i=typeof i===p?i.apply(e):i),o+=c(i)+'" class="',(i=n.value)?i=i.call(e,{hash:{},data:t}):(i=e.value,i=typeof i===p?i.apply(e):i),o+=c(i)+'">',(i=n.label)?i=i.call(e,{hash:{},data:t}):(i=e.label,i=typeof i===p?i.apply(e):i),o+=c(i)+"</a></li>\r\n                    "}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),o=o||{};var r,s,l="",p="function",c=this.escapeExpression,d=this;return l+='    <div class="'+c((r=t.CSS_CLASSES,r=null==r||r===!1?r:r.optionCombo,typeof r===p?r.apply(t):r))+" "+c((r=t.CSS_CLASSES,r=null==r||r===!1?r:r.filter,typeof r===p?r.apply(t):r))+'">\r\n            <h2>Filter:</h2>\r\n            <ul class="'+c((r=t.CSS_CLASSES,r=null==r||r===!1?r:r.optionSet,typeof r===p?r.apply(t):r))+" "+c((r=t.CSS_CLASSES,r=null==r||r===!1?r:r.clearfix,typeof r===p?r.apply(t):r))+'" data-option-key="filter">\r\n                    ',s=n.each.call(t,t.filterOptions,{hash:{},inverse:d.noop,fn:d.program(1,a,o),data:o}),(s||0===s)&&(l+=s),l+="\r\n            </ul>\r\n    </div>"}),this.bSynopsis.templates.groupDropDown=Handlebars.template(function(e,t,n,i,o){function a(e,t){var i,o="";return o+="\r\n            <option value=",(i=n.val)?i=i.call(e,{hash:{},data:t}):(i=e.val,i=typeof i===l?i.apply(e):i),o+=p(i)+">",(i=n.label)?i=i.call(e,{hash:{},data:t}):(i=e.label,i=typeof i===l?i.apply(e):i),o+=p(i)+"</option>\r\n            "}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),o=o||{};var r,s="",l="function",p=this.escapeExpression,c=this;return s+='    <select id="GroupDropDown">\r\n            ',r=n.each.call(t,t,{hash:{},inverse:c.noop,fn:c.program(1,a,o),data:o}),(r||0===r)&&(s+=r),s+="\r\n    </select>"}),this.bSynopsis.templates.overlayContent=Handlebars.template(function(e,t,n,i,o){function a(e,t){var i,o,a,l="";return l+='\r\n            <div class="'+h((i=e.CSS_CLASSES,i=null==i||i===!1?i:i.innerNoScroll,typeof i===u?i.apply(e):i))+'">\r\n                <h2>\r\n                    ',a={hash:{},inverse:f.noop,fn:f.program(2,r,t),data:t},i=n.firstComp||e.firstComp,o=i?i.call(e,e.node,"label",a):S.call(e,"firstComp",e.node,"label",a),(o||0===o)&&(l+=o),l+="\r\n                    \r\n                </h2>\r\n                 ",a={hash:{},inverse:f.noop,fn:f.program(4,s,t),data:t},i=n.firstComp||e.firstComp,o=i?i.call(e,e.node,"uri",a):S.call(e,"firstComp",e.node,"uri",a),(o||0===o)&&(l+=o),l+='\r\n            </div>\r\n            <div class="'+h((i=e.CSS_CLASSES,i=null==i||i===!1?i:i.innerScroll,typeof i===u?i.apply(e):i))+'">\r\n                    <div></div>\r\n            </div>\r\n    '}function r(e){var t;return h((t=e.data,t=null==t||t===!1?t:t.value,typeof t===u?t.apply(e):t))}function s(e,t){var i;return(i=n.data)?i=i.call(e,{hash:{},data:t}):(i=e.data,i=typeof i===u?i.apply(e):i),h(i)}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),o=o||{};var l,p,c,d="",u="function",h=this.escapeExpression,f=this,S=n.helperMissing;return d+="    ",c={hash:{},inverse:f.noop,fn:f.program(1,a,o),data:o},l=n.hasCompType||t.hasCompType,p=l?l.call(t,t.node,"label",c):S.call(t,"hasCompType",t.node,"label",c),(p||0===p)&&(d+=p),d}),this.bSynopsis.templates.overlayWrapper=Handlebars.template(function(e,t,n,i,o){function a(e,t){var n,i="";return i+=" <option value="+c((n=t,n=null==n||n===!1?n:n.key,typeof n===p?n.apply(e):n))+' selected="selected"> '+c((n=t,n=null==n||n===!1?n:n.key,typeof n===p?n.apply(e):n))+" </option> "}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),o=o||{};var r,s,l="",p="function",c=this.escapeExpression,d=this;return l+='		      \r\n		<div class="'+c((r=t.CSS_CLASSES,r=null==r||r===!1?r:r.overlay,typeof r===p?r.apply(t):r))+'">\r\n            <div style="visibility:hidden">',(s=n.id)?s=s.call(t,{hash:{},data:o}):(s=t.id,s=typeof s===p?s.apply(t):s),l+=c(s)+'</div>\r\n            <select multiple="multiple" id="filterSelect">\r\n            ',s=n.each.call(t,t.nodeFilters,{hash:{},inverse:d.noop,fn:d.program(1,a,o),data:o}),(s||0===s)&&(l+=s),l+="\r\n            ",s=n.each.call(t,t.tileFilters,{hash:{},inverse:d.noop,fn:d.program(1,a,o),data:o}),(s||0===s)&&(l+=s),l+='\r\n            </select>\r\n            <span class="'+c((r=t.CSS_CLASSES,r=null==r||r===!1?r:r.buttonTimeline,typeof r===p?r.apply(t):r))+'">history</span>\r\n			<span class="'+c((r=t.CSS_CLASSES,r=null==r||r===!1?r:r.buttonClose,typeof r===p?r.apply(t):r))+'">close</span>\r\n			<div class="'+c((r=t.CSS_CLASSES,r=null==r||r===!1?r:r.overlayContent,typeof r===p?r.apply(t):r))+'">\r\n			</div>\r\n		</div>'}),this.bSynopsis.templates.previewItem=Handlebars.template(function(e,t,n,i,o){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),o=o||{};var a,r,s="",l="function",p=this.escapeExpression;return s+='<div class="'+p((a=t.cssClass,a=null==a||a===!1?a:a.preview,typeof a===l?a.apply(t):a))+" "+p((a=t.cssClass,a=null==a||a===!1?a:a.preview,typeof a===l?a.apply(t):a))+"_",(r=n.index)?r=r.call(t,{hash:{},data:o}):(r=t.index,r=typeof r===l?r.apply(t):r),s+=p(r)+'">\r\n        <div class="'+p((a=t.cssClass,a=null==a||a===!1?a:a.previewContent,typeof a===l?a.apply(t):a))+'">\r\n            TODO\r\n        </div>\r\n</div>'}),this.bSynopsis.templates.sortOptions=Handlebars.template(function(e,t,n,i,o){function a(e){var t="";return t+='\r\n				<li><a data-sort-value="'+d(typeof e===c?e.apply(e):e)+'" class="'+d(typeof e===c?e.apply(e):e)+'">'+d(typeof e===c?e.apply(e):e)+"</a></li>\r\n			"}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),o=o||{};var r,s,l,p="",c="function",d=this.escapeExpression,u=this,h=n.helperMissing;return p+='	<div class="'+d((r=t.CSS_CLASSES,r=null==r||r===!1?r:r.optionCombo,typeof r===c?r.apply(t):r))+" "+d((r=t.CSS_CLASSES,r=null==r||r===!1?r:r.sorter,typeof r===c?r.apply(t):r))+'">\r\n		<h2>Sort:</h2>\r\n		<ul class="'+d((r=t.CSS_CLASSES,r=null==r||r===!1?r:r.optionSet,typeof r===c?r.apply(t):r))+" "+d((r=t.CSS_CLASSES,r=null==r||r===!1?r:r.clearfix,typeof r===c?r.apply(t):r))+'" data-option-key="sortBy">\r\n			',l={hash:{},inverse:u.noop,fn:u.program(1,a,o),data:o},r=n.keysEach||t.keysEach,s=r?r.call(t,t.optionSet,l):h.call(t,"keysEach",t.optionSet,l),(s||0===s)&&(p+=s),p+="\r\n		</ul>\r\n	</div>"}),this.bSynopsis.templates.stdNode=Handlebars.template(function(e,t,n,i,o){function a(e,t){var i,o,a="";return a+='\r\n                    <div class="',o={hash:{},data:t},a+=S((i=n.toClass||e.toClass,i?i.call(e,e.type,o):f.call(e,"toClass",e.type,o)))+" ",o={hash:{},data:t},a+=S((i=n.toClass||e.toClass,i?i.call(e,e.id,o):f.call(e,"toClass",e.id,o)))+'">',o={hash:{},data:t},a+=S((i=n.tScaleWrap||e.tScaleWrap,i?i.call(e,(i=e.data,null==i||i===!1?i:i.value),o):f.call(e,"tScaleWrap",(i=e.data,null==i||i===!1?i:i.value),o)))+"</div>\r\n            "}function r(e,t){var i,o,a,r="";return r+="\r\n                ",a={hash:{},inverse:g.noop,fn:g.program(4,s,t),data:t},i=n.ifLang||e.ifLang,o=i?i.call(e,e,a):f.call(e,"ifLang",e,a),(o||0===o)&&(r+=o),r+="\r\n            "}function s(e,t){var i,o,a="";return a+='\r\n                        <div class="',o={hash:{},data:t},a+=S((i=n.toClass||e.toClass,i?i.call(e,e.type,o):f.call(e,"toClass",e.type,o)))+" ",o={hash:{},data:t},a+=S((i=n.toClass||e.toClass,i?i.call(e,e.id,o):f.call(e,"toClass",e.id,o)))+'" style="overflow-y: auto;">'+S((i=e.data,i=null==i||i===!1?i:i.value,typeof i===y?i.apply(e):i))+"</div>\r\n                "}function l(e,t,i){var o,a,r,s="";return s+='\r\n                    <div class="',r={hash:{},data:t},s+=S((o=n.toClass||e.toClass,o?o.call(e,e.id,r):f.call(e,"toClass",e.id,r)))+'">\r\n                        <img class="'+S((o=i.CSS_CLASSES,o=null==o||o===!1?o:o.tileClasses,o=null==o||o===!1?o:o.typeImage,typeof o===y?o.apply(e):o))+'" src="img/'+S((o=e.data,o=null==o||o===!1?o:o.type,typeof o===y?o.apply(e):o))+'.png">\r\n                        <div class="'+S((o=i.CSS_CLASSES,o=null==o||o===!1?o:o.tileClasses,o=null==o||o===!1?o:o.predicate,typeof o===y?o.apply(e):o))+'" style="visibility:hidden">',r={hash:{},data:t},s+=S((o=n.tScaleWrap||e.tScaleWrap,o?o.call(e,(o=e.data,null==o||o===!1?o:o.value),r):f.call(e,"tScaleWrap",(o=e.data,null==o||o===!1?o:o.value),r)))+"</div>\r\n                        ",r={hash:{},inverse:g.noop,fn:g.programWithDepth(7,p,t,i),data:t},o=n.predicateLabelRetriver||e.predicateLabelRetriver,a=o?o.call(e,e.data,r):f.call(e,"predicateLabelRetriver",e.data,r),(a||0===a)&&(s+=a),s+="\r\n                    </div>\r\n            "}function p(e,t,i){var o,a,r="";return r+='\r\n                            <div class="'+S((o=i.CSS_CLASSES,o=null==o||o===!1?o:o.tileClasses,o=null==o||o===!1?o:o.predicateLabel,typeof o===y?o.apply(e):o))+'">',a={hash:{},data:t},r+=S((o=n.tScaleWrap||e.tScaleWrap,o?o.call(e,(o=e.data,null==o||o===!1?o:o.label),a):f.call(e,"tScaleWrap",(o=e.data,null==o||o===!1?o:o.label),a)))+"</div>\r\n                        "}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),o=o||{};var c,d,u,h="",f=n.helperMissing,S=this.escapeExpression,y="function",g=this;return h+="            ",u={hash:{},inverse:g.noop,fn:g.program(1,a,o),data:o},c=n.compsEach||t.compsEach,d=c?c.call(t,t.node,"label",u):f.call(t,"compsEach",t.node,"label",u),(d||0===d)&&(h+=d),h+="\r\n            ",u={hash:{},inverse:g.noop,fn:g.program(3,r,o),data:o},c=n.compsEach||t.compsEach,d=c?c.call(t,t.node,"description",u):f.call(t,"compsEach",t.node,"description",u),(d||0===d)&&(h+=d),h+="\r\n            ",u={hash:{},inverse:g.noop,fn:g.programWithDepth(6,l,o,t),data:o},c=n.compsEach||t.compsEach,d=c?c.call(t,t.node,"predicate",u):f.call(t,"compsEach",t.node,"predicate",u),(d||0===d)&&(h+=d),h}),this.bSynopsis.templates.tileWrapper=Handlebars.template(function(e,t,n,i,o){function a(e,t){var i,o,a="";return o={hash:{},data:t},a+=h((i=n.toClass||e.toClass,i?i.call(e,e,o):u.call(e,"toClass",e,o)))+" "}function r(e,t){var i,o;return o={hash:{},data:t},h((i=n.toClass||e.toClass,i?i.call(e,(i=e.node,null==i||i===!1?i:i.token),o):u.call(e,"toClass",(i=e.node,null==i||i===!1?i:i.token),o)))}function s(e,t){var i,o,a="";return a+='\r\n			<h2 class="'+h((i=e.CSS_CLASSES,i=null==i||i===!1?i:i.tileClasses,i=null==i||i===!1?i:i.showURI,typeof i===f?i.apply(e):i))+'" style="display:none">',(o=n.data)?o=o.call(e,{hash:{},data:t}):(o=e.data,o=typeof o===f?o.apply(e):o),a+=h(o)+"</h2>\r\n		"}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),o=o||{};var l,p,c,d="",u=n.helperMissing,h=this.escapeExpression,f="function",S=this;return d+='	<div class="'+h((l=t.CSS_CLASSES,l=null==l||l===!1?l:l.tileClasses,l=null==l||l===!1?l:l.tile,typeof l===f?l.apply(t):l))+" ",p=n.each.call(t,(l=t.node,null==l||l===!1?l:l.filterables),{hash:{},inverse:S.noop,fn:S.program(1,a,o),data:o}),(p||0===p)&&(d+=p),p=n["if"].call(t,(l=t.node,null==l||l===!1?l:l.token),{hash:{},inverse:S.noop,fn:S.program(3,r,o),data:o}),(p||0===p)&&(d+=p),d+=" ",c={hash:{},data:o},d+=h((l=n.toClass||t.toClass,l?l.call(t,(l=t.node,null==l||l===!1?l:l.id),c):u.call(t,"toClass",(l=t.node,null==l||l===!1?l:l.id),c)))+'">\r\n		',c={hash:{},inverse:S.noop,fn:S.program(5,s,o),data:o},l=n.firstComp||t.firstComp,p=l?l.call(t,t.node,"uri",c):u.call(t,"firstComp",t.node,"uri",c),(p||0===p)&&(d+=p),d+='\r\n		<p class="'+h((l=t.CSS_CLASSES,l=null==l||l===!1?l:l.tileClasses,l=null==l||l===!1?l:l.number,typeof l===f?l.apply(t):l))+'" style="display:none">'+h((l=t.node,l=null==l||l===!1?l:l.index,typeof l===f?l.apply(t):l))+"</p>\r\n	</div>"}),this.bSynopsis.templates.timelineItem=Handlebars.template(function(e,t,n,i,o){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),o=o||{};var a,r="",s="function",l=this.escapeExpression;return r+="<li>\r\n    "+l((a=t.label,a=null==a||a===!1?a:a.value,typeof a===s?a.apply(t):a))+"\r\n</li>"}),this.bSynopsis.templates.timelineWrapper=Handlebars.template(function(e,t,n,i,o){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),o=o||{};var a,r="",s="function",l=this.escapeExpression;return r+='<div class="'+l((a=t.CSS_CLASSES,a=null==a||a===!1?a:a.timelineContainer,typeof a===s?a.apply(t):a))+'">\r\n    <ul class="'+l((a=t.CSS_CLASSES,a=null==a||a===!1?a:a.timeline,typeof a===s?a.apply(t):a))+'">\r\n    </ul>\r\n</div>'});