/*! bSynopsis 2014-07-25 */
(function(e,t,n,o){function i(t,n){e.each(n,function(e,o){"string"==typeof o?n[e]=t+o:i(t,o)})}function a(e){return e===o||null===e}function r(e,t){function n(){return e.apply(this,t)}return n.prototype=e.prototype,new n}function s(e){return e&&(e.CSS_CLASSES?console.log(S.MESSAGES.warn.cssAppend):e.CSS_CLASSES=S.CSS_CLASSES),e}function l(e,t){return e.replace(RegExp(S.DUMMY,"g"),t)}function p(t){var n=null,o=null;return t?e("BODY").hasClass("noscroll")?(n=f.width(),o=f.height()):(e("BODY").addClass("noscroll"),n=f.width(),o=f.height(),e("BODY").removeClass("noscroll")):(n=f.width(),o=f.height()),{width:n,height:o}}function c(e){var t;switch(e){case S.CSS_CLASSES.overlay:return t=p(!0),"rect(0px "+t.width+"px "+t.height+"px 0px)";case S.CSS_CLASSES.preview:return t=p(!1),"rect("+.25*t.height+"px "+.75*t.width+"px "+.75*t.height+"px "+.25*t.width+"px)";default:return console.log("No clip data found."),""}}function d(e){var t=f.scrollTop(),n=f.scrollLeft(),o=e.offset();return{left:o.left-n,top:o.top-t,width:e.outerWidth(),height:e.outerHeight()}}function u(){var e={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"};return e[Modernizr.prefixed("transition")]}function h(){return x++}function y(t,n){this._selfProxy=function(t){return e.proxy(t,this)},this.pluginID=h(),this._extendedLayers={},this._topLayer,this._$parent=e(t),this.$body=e("BODY"),T[this.pluginID]=new y.EventManager(this._$parent),this._$parent.addClass(w+"_"+this.pluginID),this._$parent.addClass(w),this.options=e.extend(!0,{},$,n),this._defaults=$,this._name=w,this._expandedOverlaysCount=0,this.init()}var f=e(t),S={FA_TAG:"synopsis_filter_",TOKEN_TAG:"synopsis_token_",NODE_TYPES:{stdNode:"stdNode",literal:"literal",blankNode:"blankNode",resNode:"resNode"},COMP_TYPES:{predicate:"predicate",label:"label",uri:"uri"},CSS_PREFIX:"synopsis_",CSS_CLASSES:{outerContainer:"outerContainer",viewContainer:"container",options:"options",optionCombo:"option-combo",optionSet:"option-set",optionButton:"option-button",groupLabel:"groupLabel",filter:"filter",clearfix:"clearfix",loader:"loading",preview:"preview",previewItem:"preview-item",previewContent:"previewContent",overlay:"overlay",overlayContent:"overlayContent",refresh:"refresh",innerScroll:"innerScroll",innerNoScroll:"innerNoScroll",buttonClose:"close",timelineContainer:"timelineContainer",timeline:"timeline",buttonTimeline:"btnTimeline",sorter:"sorter",textScale:"textScale",textScaleDone:"textScaleDone",tileClasses:{tile:"tile",content:"tileContent",label:"label",showURI:"showURI",predicate:"predicate",predicateLabel:"predicateLabel",typeImage:"typeImage",number:"number"},typeClasses:{incoming:"incoming",outgoing:"outgoing"},patternClasses:{uri:"uri",literal:"literal",blanknode:"blank"}},DUMMY:"#replaceMe#",EVENT_TYPES:{store:{insert:"dataInsert"},loading:{done:"loadingDone",start:"loadingStarted"},layout:{done:"layoutingDone"}},MESSAGES:{out:{selectAllFilters:"Select All"},error:{ajax:"Error on loading data.",remote:"Error on loading remote data.",template:"Error on loading template data.",tokenType:"Unknown token type of item.",compType:"Unknown component type of item."},warn:{cssAppend:"CSS classes already defined",fileTypeNotKnown:"Couldn't get filetype. Using: ",filterInput:"Filterinput is empty",filterName:"Filtername duplicate found"}}},g={toClass:function(e){return S.CSS_PREFIX+e},toToken:function(e){return S.TOKEN_TAG+e},toFilterable:function(e){return S.FA_TAG+e},toClassSelector:function(e){return"."+S.CSS_PREFIX+e},toSelector:function(e){return"."+e}};i(S.CSS_PREFIX,S.CSS_CLASSES),e.expr[":"]["class-prefix"]=function(t,n,o){var i=o[3];if(i){var a='[class^="'+i+'"], [class*=" '+i+'"]';return e(t).is(a)}return!0},e.expr[":"].regex=function(e,t,n){var o,i=n[3].split(","),a=/^(data|css):/,r={method:i[0].match(a)?i[0].split(":")[0]:"attr",property:i.shift().replace(a,"")},s="ig";try{o=RegExp(i.join("").replace(/^\s+|\s+$/g,""),s)}catch(l){return!1}return o.test(jQuery(e)[r.method](r.property))},function(e){e.fn.textfill=function(t,n,o){return t=parseInt(t,10),n=parseInt(n,10),this.each(function(i,a){var r=e(a),s=r.parent(),l=s.height(),p=s.width(),c=parseInt(r.css("fontSize"),10),d=p/r.width(),u=l/r.height(),h=u>d?d:u,y=c*(h-.1);t>0&&y>t&&(y=t),n>0&&n>y&&(y=n,o(s)),r.css("fontSize",y)})}}(jQuery);var v=console.log.bind(console),m=function(){var n=0;this._corsRequestSPARQL=function(i,a,r){var s=!1,l=n++;t["cbFunc"+l]=function(e){e&&e.results&&e.results.bindings?(s=!0,r(e.results.bindings,s)):(console.log("Nothing returned from getJSON."),r(null,s),t["cbFunc"+l]=o)};var p=a+"?default-graph-uri=http%3A%2F%2Fdbpedia.org&query="+encodeURI(i)+"&format=application%2Fsparql-results%2Bjson&timeout=300000";i||alert("No query was passed."),e.ajax({type:"post",dataType:"json",url:p,success:t["cbFunc"+l],error:function(e,n,o){console.log("Error on cors query."),console.log(o),t["cbFunc"+l]()}})},this._yqlRequestSPARQL=function(i,a,r){var s=!1,l=n++;t["cbFunc"+l]=function(e){e&&e.query&&e.query.results?(s=!0,r(e.query.results.sparql.result,s)):(console.log("Nothing returned from getJSON."),r(null,s),t["cbFunc"+l]=o)},i||alert("No query was passed.");var p="http://query.yahooapis.com/v1/public/yql?q="+encodeURIComponent('use "http://triplr.org/sparyql/sparql.xml" as sparql; select * from sparql where query="'+i+'" and service="'+a)+'"&format=json';e.ajax({type:"post",dataType:"json",url:p,success:t["cbFunc"+l],error:function(e,n,o){console.log("Error on yql query."),console.log(o),t["cbFunc"+l]()}})}};m.prototype.executeQuery=function(e,t,n){0===t.indexOf("yql:")?this._yqlRequestSPARQL(e,t.slice(4),n):this._corsRequestSPARQL(e,t,n)};var b=function(){this.values={}};b.prototype.add=function(e,t){this.values[e]=t},b.prototype.retrieve=function(e){return this.values[e]},b.prototype.contains=function(e){return e in this.values};var L,C,E,_=e.Deferred(),w="bSynopsis",T=[],I=new b,O=u(),A=Modernizr.csstransitions,D={rdf:"http://www.w3.org/1999/02/22-rdf-syntax-ns#",rdfs:"http://www.w3.org/2000/01/rdf-schema#",owl:"http://www.w3.org/2002/07/owl#",rif:"http://www.w3.org/2007/rif#",foaf:"http://xmlns.com/foaf/0.1/",dbpedia:"http://dbpedia.org/resource/","dbpedia-owl":"http://dbpedia.org/ontology/",dbpprop:"http://dbpedia.org/property/",geo:"http://www.w3.org/2003/01/geo/wgs84_pos#",dc:"http://purl.org/dc/terms/"},N={},x=0,R=0,j=0,k=2,F=0;y.Event=function(e){this._sender=e,this._listeners={},this._oneTimeListeners={}},y.Event.prototype={attach:function(e){this._listeners[e.id]=e},once:function(e){this._oneTimeListeners[e.id]=e},dettach:function(e){delete this._listeners[e.id]},notify:function(t){var n=this._sender,o=this;e.each(this._listeners,function(e,o){o.fn(n,t)}),e.each(this._oneTimeListeners,function(e,i){i.fn(n,t),delete o._oneTimeListeners[e]})}},y.Switch=function(e){this._sender=e,this._listeners={},this._triggered=!1},y.Switch.prototype={attach:function(e){this._triggered?e.fn(this._sender,this._args):this._listeners[e.id]=e},trigger:function(t){this._triggered=!0,this._args=t;var n=this;e.each(this._listeners,function(e,o){o.fn(n._sender,t),delete n._listeners[e]})}},y.Listener=function(e){this.id="listener"+F++,this.fn=e},y.EventManager=function(e){return e?(this.stdObject=e,this._evHandlerHistory={},o):(v("EventManager not created"),!1)},y.EventManager.prototype.addEventHandler=function(e,t,n,i){var a=this;n===o&&(n=a.stdObject),a._evHandlerHistory[e]===o&&(a._evHandlerHistory[e]=[]),a._evHandlerHistory[e].push({id:i,object:n,handler:t}),n.on(e,t)},y.EventManager.prototype.removeEventHandler=function(t,n,i){var a=this;e.each(a._evHandlerHistory[t],function(a,r){if(n===r.id)if(i!==o){if(e.data(r.object)===e.data(i))return r.object.off(t,r.handler),!1}else r.object.off(t,r.handler)})},y.EventManager.prototype.trigger=function(e,t,n){n?n.trigger(e,t):this.stdObject.trigger(e,t)},y.EventManager.prototype.destroy=function(){e.each(this._evHandlerHistory,function(t,n){e.each(n,function(e,n){n.object.off(t,n.handler)})})},y.RdfStore=function(t,n){var o=this;this._store=null,this._queryPrefixes="",this._generateQueryPrefix=function(e,t){o._queryPrefixes+="PREFIX "+e+": <"+t+"> "},e.each(D,function(e,t){o._generateQueryPrefix(e,t)}),new rdfstore.Store(t,function(e){o._store=e,n()})},y.RdfStore.prototype.insertData=function(t,n,o){var i=this;if("text/turtle"===n||"text/plain"===n||"text/n3"===n){var r=t.match(/.*@prefix.*>(\s)*./g);r&&e.each(r,function(e,t){var n=t.split(/>(\s)*./)[0].split(/:(\s)*</),o=n[0].replace(/@prefix(\s)*/,""),r=n[2];a(D[o])&&(D[o]=r,i._generateQueryPrefix(o,r))})}else if("application/ld+json"===n||"application/json"===n){var s=t["@context"];s&&e.each(s,function(e,t){a(D[t])&&(D[e]=t,i._generateQueryPrefix(e,t))})}this._store.load(n,t,function(){o()})},y.RdfStore.prototype.executeQuery=function(e,t){this._store.execute(this._queryPrefixes+e,function(n,o){n?t(o,n):(v("Error on executing: "+e),t(null,n))})},y.LayoutEngine=function(e,t){var n=this;this._options=t,this._container=e,this._funcQueue=[],this._occupied=!1,this._internDoneEvent=new y.Event(this),this.partialDoneEvent=new y.Event(this),this.doneEvent=new y.Event(this),this._internDoneEvent.attach(new y.Listener(function(){n._addNext()})),e.addClass("layoutEngine"),e.css({overflow:"hidden"})},y.LayoutEngine.prototype._addNext=function(){this._funcQueue.length>0?setTimeout(this._funcQueue.shift(),this._options.clusterWait):(this._occupied=!1,this.startTime&&(v("Unoccupy. All layouting done after "+((new Date).getTime()-this.startTime)+" ms"),this.doneEvent.notify(),this.startTime=o))},y.LayoutEngine.prototype._setStartTime=function(){this.startTime||(this.startTime=(new Date).getTime())},y.LayoutEngine.prototype.add=function(){},y.LayoutEngine.prototype.remove=function(){},y.LayoutEngine.prototype.removeAll=function(){},y.LayoutEngine.prototype.updateOptions=function(){},y.LayoutEngine.prototype.sort=function(){},y.LayoutEngine.prototype.filter=function(){},y.LayoutEngines={},y.LayoutEngines.Isotope=function(e,t){y.LayoutEngine.call(this,e,t);var n=this;this._container.isotope(t.isotope.options),this._container.isotope("on","layoutComplete",function(){n._internDoneEvent.notify()})},y.LayoutEngines.Isotope.prototype=Object.create(y.LayoutEngine.prototype),y.LayoutEngines.Isotope.prototype.constructor=y.LayoutEngines.Isotope,y.LayoutEngines.Isotope.prototype.add=function(e){var t=this;t._setStartTime();var n=function(){return function(){t._occupied=!0;var n=t._options.clusterSize;if(e.length>n&&n>0){var o=e;o=o.slice(n),e=e.slice(0,n),t.add(o)}var i=(new Date).getTime();t._container.isotope("once","layoutComplete",function(){v("Added items to layoutEngine in "+((new Date).getTime()-i)+" ms"),t.partialDoneEvent.notify(e)}),t._container.isotope("insert",e)}};e&&(this._occupied?this._funcQueue.push(n(e)):n(e)())},y.LayoutEngines.Isotope.prototype.reLayout=function(){this._container.isotope("reLayout")},y.LayoutEngines.Isotope.prototype.remove=function(e,t){this._container.isotope("remove",e,t)},y.LayoutEngines.Isotope.prototype.removeAll=function(){this._container.html("")},y.LayoutEngines.Isotope.prototype.updateOptions=function(e){this._container.isotope(e)},y.LayoutEngines.Isotope.prototype.sort=function(e,t){if(this.startTime=(new Date).getTime(),!this._options.isotope.options.getSortData.hasOwnProperty(e)){var n={};n[e]=t,v("adding tmpSD"),this.updateOptions({getSortData:n})}this.updateOptions({sortBy:e})},y.LayoutEngines.Isotope.prototype.filter=function(e){if(this.startTime=(new Date).getTime(),""!==e){if("*"!==e)if(this._options.supportRegExpFilter)try{e="div:regex(class, "+e+"), div > div:contains("+e+")"}catch(t){e="div > div:contains("+e+")"}else e="div > div:contains("+e+")"}else e="*";this.updateOptions({filter:e})},y.LayoutEngines.Shuffle=function(e,t){y.LayoutEngine.call(this,e,t);var n=this;this._container.shuffle(t.shuffle.options),this._container.on("layout.shuffle",function(){n._internDoneEvent.notify()})},y.LayoutEngines.Shuffle.prototype=Object.create(y.LayoutEngine.prototype),y.LayoutEngines.Shuffle.prototype.constructor=y.LayoutEngines.Shuffle,y.LayoutEngines.Shuffle.prototype.add=function(e){var t=this;t._setStartTime();var n=function(e){return function(){t._occupied=!0;var n=t._options.clusterSize;if(e.length>n&&n>0){var o=e;o=o.slice(n),e=e.slice(0,n),t.add(o)}var i=(new Date).getTime();t._container.one("layout.shuffle",function(){v("Added items to layoutEngine in "+((new Date).getTime()-i)+" ms"),t.partialDoneEvent.notify(e)}),t._container.append(e),t._container.shuffle("appended",e)}};e&&(this._occupied?this._funcQueue.push(n(e)):n(e)())},y.LayoutEngines.Shuffle.prototype.remove=function(e){this._container.shuffle("remove",e)},y.LayoutEngines.Shuffle.prototype.removeAll=function(){this._container.html("")},y.LayoutEngines.Shuffle.prototype.updateOptions=function(e){this._container.shuffle(e)},y.LayoutEngines.Shuffle.prototype.sort=function(e,t){this.startTime=(new Date).getTime(),this._container.shuffle("sort",{by:t})},y.LayoutEngines.Shuffle.prototype.filter=function(e,t,n){this.startTime=(new Date).getTime();var o;"function"==typeof n?o=n:this.options.shuffle.filterFns.hasOwnProperty(t)&&(o=this.options.shuffle.filterFns[t]),this._container.shuffle("shuffle",o)},y.LayoutEngineFactory={make:function(e,t){var n;switch(v(t),t.useEngine){case"isotope":n=new y.LayoutEngines.Isotope(e,t);break;case"shuffle":n=new y.LayoutEngines.Shuffle(e,t);break;default:alert("No layout engine defined.")}return n}},y.Node=function(e,t){this.id=e.index,this.type=S.NODE_TYPES.stdNode,this.useTemplateID=this.type,this.filterables=[],this.components={},this.style=t,e.predicate&&(this.filterables.push(g.toFilterable(e.predicate.type)),e.predicate.value=decodeURIComponent(e.predicate.value),this.addComponent("predicate",e.predicate)),e.description&&(e.description.value=decodeURIComponent(e.description.value),this.addComponent("description",e.description))},y.Node.prototype.addComponent=function(e,t,n){this.components[e]||(this.components[e]=[]);var o=e+this.components[e].length;this.components[e].push(y.ComponentFactory.makeComp(o,e,t,n))},y.Node.prototype.getFComponentOT=function(e){return this.components[e]?this.components[e][0]:!1},y.Node.prototype.hasComponentType=function(e){return this.components.hasOwnProperty(e)},y.Node.prototype.forEachComponentType=function(e,t){if(this.components[e])for(var n=0;this.components[e].length>n;n++)t(this.components[e][n])},y.Node.prototype.getType=function(){return this.type},y.Node.prototype.getTemplateIdentifier=function(){return this.useTemplateID},y.Node.prototype.setPredicateLabel=function(e,t){this.components.predicate[e].label=t},y.Node.prototype.generateTile=function(){var t=e(N.tileWrapper(s({node:this}))).append(e(N[this.useTemplateID](s({node:this}))));return t.data("node",this),t},y.Node.prototype.merge=function(t){var n=this,o=!1;return e.each(t.components,function(t,i){e.each(i,function(e,i){var a=!0;if(n.components[t])for(var r=0;n.components[t].length>r;r++)if(i.equals(n.components[t][r])){a=!1;break}a&&(n.addComponent(t,i.data),o=!0)})}),o},y.Node.Component=function(e,t,n,o){this.id=e,this.type=t,this.data=n,this.style=o},y.ComponentFactory={makeComp:function(e,t,n,o){var i;switch(i=o?new y.Node.Component(e,t,n,o):new y.Node.Component(e,t,n),t){case S.COMP_TYPES.predicate:i.equals=function(e){return this.type===e.type&&this.data.value===e.data.value};break;case S.COMP_TYPES.label:i.equals=function(e){return this.type===e.type&&this.data.value===e.data.value};break;case S.COMP_TYPES.uri:i.equals=function(e){return this.type===e.type&&this.data===e.data};break;default:i.equals=function(e){return this.type===e.type&&this.data.value===e.data.value},console.log(S.MESSAGES.error.compType+t)}return i}},y.Nodes={},y.Nodes.Res=function(e){y.Node.call(this,e);var t=this,n=function(){var e=t.components.uri[0].data;return t.forEachComponentType("predicate",function(t){e+="_"+t.data.value}),e};this.type=S.NODE_TYPES.resNode,this.addComponent("uri",e.subject.value,{display:"none"}),a(e.label)?this.addComponent("label",{value:decodeURIComponent(this.uri)}):(e.label.value=decodeURIComponent(e.label.value),this.addComponent("label",e.label)),this.id=n()},y.Nodes.Res.prototype=Object.create(y.Node.prototype),y.Nodes.Res.prototype.constructor=y.Nodes.Res,y.Nodes.Res.prototype.generateTile=function(){var e=y.Node.prototype.generateTile.call(this);return e},y.Nodes.Literal=function(e){var t=this;y.Node.call(this,e);var n=function(){var e=t.getFComponentOT("label").data.value;return t.forEachComponentType("predicate",function(t){e+="_"+t.data.value}),e};this.type=S.NODE_TYPES.literal,e.subject.value=decodeURIComponent(e.subject.value),this.addComponent("label",e.subject),this.id=n()},y.Nodes.Literal.prototype=Object.create(y.Node.prototype),y.Nodes.Literal.prototype.constructor=y.Nodes.Literal,y.Nodes.Literal.prototype.generateTile=function(){var e=y.Node.prototype.generateTile.call(this);return e},y.Nodes.Blank=function(e){y.Node.call(this,e);var t=function(){return"_"+Math.random().toString(36).substr(2,9)};this.type=S.NODE_TYPES.blankNode,this.addComponent("label",{value:"BlankNode - TODO"}),this.id=t()},y.Nodes.Blank.prototype=Object.create(y.Node.prototype),y.Nodes.Blank.prototype.constructor=y.Nodes.Blank,y.Nodes.Blank.prototype.generateTile=function(){var e=y.Node.prototype.generateTile.call(this);return e},y.NodeFactory={make:function(e){var t;switch(e.subject.token){case g.toToken(S.CSS_CLASSES.patternClasses.blanknode):t=new y.Nodes.Blank(e);break;case g.toToken(S.CSS_CLASSES.patternClasses.literal):t=new y.Nodes.Literal(e);break;case g.toToken(S.CSS_CLASSES.patternClasses.uri):!e.label||e.label.lang!==o&&"en"!==e.label.lang||(t=new y.Nodes.Res(e));break;default:console.log(S.MESSAGES.error.tokenType+e.subject.token)}return t}},y.TimeLine=function(t){this._$timelineContainer=e('<div class="'+S.CSS_CLASSES.timelineContainer+'">'),t.prepend(this._$timelineContainer),this._$timeline=e('<ul class="'+S.CSS_CLASSES.timeline+'"></ul>'),this._$timelineContainer.append(this._$timeline),this.timeLineNodes=[]},y.TimeLine.prototype.open=function(){this._$timelineContainer.data("isExpanded")?(this._$timelineContainer.data("isExpanded",!1),this._$timelineContainer.css({opacity:0,zIndex:-1})):(this._$timelineContainer.data("isExpanded",!0),this._$timelineContainer.css({"background-color":"grey",opacity:1,zIndex:k++}))},y.TimeLine.prototype.close=function(){this._$timelineContainer.data("isExpanded",!1),this._$timelineContainer.css({opacity:0,zIndex:-1})},y.TimeLine.prototype.addLayer=function(e){this.addNode(new y.TimeLine.Node(e))},y.TimeLine.prototype.addNode=function(e){var t=this;this.timeLineNodes.push(e),this._$timeline.prepend(e.getJQueryObj()),e.clickEvent.attach(new y.Listener(function(){t.close()}))},y.TimeLine.Node=function(t){var n=this;this.clickEvent=new y.Event(this),this.layer=t,this.$timelineNode=e(N.timelineItem({label:t.node&&t.node.hasComponentType("label")?t.node.getFComponentOT("label").data.value:t.id})),t.$tile&&this.$timelineNode.css({"background-color":t.$tile.css("background-color")}),this.$timelineNode.click(function(){n.clickEvent.notify(),n.layer.open(),n.layer.update()})},y.TimeLine.Node.prototype.getJQueryObj=function(){return this.$timelineNode},y.Layer=function(t,n,o){var i=this;this.initSwitch=new y.Switch(this),this.openEvent=new y.Event(this),this.closeEvent=new y.Event(this),this.filterEvent=new y.Event(this),this.id="layer"+R++,this.initDfd=e.Deferred(),this.$parent=t,this.options=n,this.openEvent.once(new y.Listener(function(){i.initSwitch.attach(new y.Listener(function(){i._initContent()}))})),e.when(i._addOverlay()).done(function(){e.when(i._addOverlayContent()).done(function(){i._initLayerData(o)})})},y.Layer.prototype._initLayerData=function(t){var n=this;this.model=new y.Layer.Model(t,this.options.modelOptions,E.label),this.view=new y.Layer.View(this.model,this.$content,this.options.viewOptions),this.model.itemsAdded.attach(new y.Listener(function(e,t){n.view.addTiles(n.getTilesToPaint(t.addedNodes,n.options.nodeFilters,n.options.tileFilters))})),this.model.modelCleared.attach(new y.Listener(function(){v("Clearing view."),n.view.layoutEngine.remove(e(g.toSelector(S.CSS_CLASSES.tileClasses.tile)))})),(this.options.generateSortOptions||this.options.generateFilterOptions)&&(this.view.addOptionsBox(),this.options.generateSortOptions&&this.view.addSorter(),this.options.generateFilterOptions&&this.view.appendFilterDiv(function(){n.view.addFilterLinkFn(),n.view.addFilterBoxFn()})),this._addCloseOnClick(),this._addRefreshOnClick(),this._addBackgroundColor(),this.initSwitch.trigger()},y.Layer.prototype._addBackgroundColor=function(){this.$overlay.css("background-color","grey")},y.Layer.prototype._addCloseOnClick=function(){var e=this,t=this.$overlay.find("> span"+g.toSelector(S.CSS_CLASSES.buttonClose));t.on("click",function(){e.close()})},y.Layer.prototype._addRefreshOnClick=function(){var e=this,t=this.$overlay.find(g.toSelector(S.CSS_CLASSES.refresh));t.on("click",function(){e.update()})},y.Layer.prototype.getTimeLineButton=function(){return this.$overlay.find(g.toSelector(S.CSS_CLASSES.buttonTimeline))},y.Layer.prototype._addOverlay=function(){var t=e.Deferred();return this.$overlay=e(N.overlayWrapper(s({id:this.id}))),this.$parent.append(this.$overlay),t.resolve(),t.promise()},y.Layer.prototype._addOverlayContent=function(){var t=e.Deferred();return this.$content=e("<div></div>"),this.$overlay.append(this.$content),t.resolve(),t.promise()},y.Layer.prototype._initContent=function(){var e=this;v("initContent"),e.options.remoteOptions.remoteDynamically?(e.options.remoteOptions.waitForRemote||e.update(),this.loadByRemote?this.loadByRemote():v("LoadByRemote currently not defined")):this.update()},y.Layer.prototype.getJQueryObj=function(){return this.$overlay},y.Layer.prototype.removeHtml=function(){return this.$overlay.remove()},y.Layer.prototype.update=function(){v("Layer "+this.id+" is updating."),this.model.update()},y.Layer.prototype.open=function(){this.$overlay.data("isExpanded",!0),this.show()},y.Layer.prototype.show=function(){this.zIndex=k++,this.$overlay.css({clip:c(S.CSS_CLASSES.overlay),opacity:1,zIndex:this.zIndex,pointerEvents:"auto"}),this.openEvent.notify()},y.Layer.prototype.close=function(){this.$overlay.data("isExpanded",!1),this.closeEvent.notify(),this.hide()},y.Layer.prototype.hide=function(){this.$overlay.css({opacity:0,zIndex:-1})},y.Layer.prototype.removeAllItems=function(){this.model.clearModel()},y.Layer.prototype.getTilesToPaint=function(e,t,n){return this.runTileFilters(this.generateTiles(this.runNodeFilters(e,t)),n)},y.Layer.prototype.runNodeFilters=function(t,n){var o=this;filters=n?n:this.options.nodeFilters;var i,a=(new Date).getTime(),r=a;return v("Start node filters:"),e.each(filters,function(n,a){i&&v("Filter "+i+" done in: "+((new Date).getTime()-r)+" milisec"),i=n,r=(new Date).getTime(),e.isEmptyObject(t)?console.log(S.MESSAGES.warn.filterInput):t=a.fn(t,a.config,o)}),v("Filter "+i+" done in: "+((new Date).getTime()-r)+" milisec"),v("All node filter done after: "+((new Date).getTime()-r)+" milisec"),t},y.Layer.prototype.generateTiles=function(t){var n=e("<div>");return e.each(t,function(t,o){n.append(e(o.generateTile()))}),n},y.Layer.prototype.runTileFilters=function(t,n){var o=this;filters=n?n:this.options.tileFilters,t=t.children();var i,a=(new Date).getTime(),r=a;return e.each(filters,function(e,n){i&&v("Filter "+i+" done in: "+((new Date).getTime()-r)+" milisec"),i=e,r=(new Date).getTime(),t=n.fn(t,n.config,o)}),v("Filter "+i+" done in: "+((new Date).getTime()-r)+" milisec"),v("All tile filters done after: "+((new Date).getTime()-a)+" milisec"),t},y.Layer.Model=function(t,n,o){var i=this;this.viewQueries=t,this.labelQuery=o,this.options=n,this._nodes={},this.nodesLength=0,this.itemsAdded=new y.Event(this),this.modelCleared=new y.Event(this),this.itemUpdated=new y.Event(this),this._checkItemsHelp=function(e,t){var n=e.slice(t);n.length>0&&i.checkItems(n)},this._fetchPredicateLabel=function(t){if(t.hasComponentType("predicate"))for(var n=0;t.components.predicate.length>n;n++){var o=t.components.predicate[n];if(I.contains(o.value))t.setPredicateLabel(n,I.retrieve(o.value));else{var a=l(i.labelQuery,o.value);L.executeQuery(a,function(n){n&&n[0]&&e.each(n,function(e,n){t.setPredicateLabel(e,n.label.value),I.add(o.value,n.label.value)})})}}return t}},y.Layer.Model.prototype.getNodes=function(){},y.Layer.Model.prototype.checkItems=function(t){var n=t.length,i=this,a=i.options.batchSize>n?n:i.options.batchSize,r=t.slice(0,a),s={};e.each(r,function(e,t){t.subject.token=g.toToken(g.toClass(t.subject.token)),t.index=i.nodesLength+1;var n=y.NodeFactory.make(t,i.options);if(n){switch(n.getType()){case S.NODE_TYPES.resNode:n.id in i._nodes?(v("resNodeUpdate, fix me"),i._nodes[n.id].merge(n)?(n=i._nodes[n.id],i.itemUpdated.notify(n)):n=o):(i._nodes[n.id]=n,i.nodesLength++);break;case S.NODE_TYPES.literal:n.id in i._nodes?(v("literalupdate"),i._nodes[n.id].merge(n)?(n=i._nodes[n.id],i.itemUpdated.notify(n)):n=o):(i._nodes[n.id]=n,i.nodesLength++);break;case S.NODE_TYPES.blankNode:n.id in i._nodes?(v("blankNodeupdate"),n=o):(i._nodes[n.id]=n,i.nodesLength++)}n&&(n=i._fetchPredicateLabel(n),s[n.id]=n)}}),v(s),this.itemsAdded.notify({addedNodes:s,allNodes:this.getNodes()}),i._checkItemsHelp(t,a)},y.Layer.Model.prototype.update=function(){v("START");var e=this;this.allResults=[];for(var t=0;this.viewQueries.length>t;t++)v(this.viewQueries[t].query),L.executeQuery(this.viewQueries[t].query,function(n){if(v(n),n&&0!==n.length)for(var o=0;n.length>o;o++)e.viewQueries[t].type&&(n[o].predicate.type=e.viewQueries[t].type),e.allResults.push(n[o])});this.allResults.length>0?e.checkItems(this.allResults):v("Nothing to add to View")},y.Layer.Model.prototype.clearModel=function(){this._nodes={},this.modelCleared.notify()},y.Layer.View=function(t,n,o){this.id="view"+j++,this.options=o,this._model=t,this.$outerContainer=e('<div class="'+S.CSS_CLASSES.outerContainer+'"></div>'),this.$outerContainer.css({"border-radius":"18px",padding:"5px 5px 5px 5px"}),this.$viewContainer=e('<div class="'+S.CSS_CLASSES.viewContainer+'"></div>'),n.append(this.$outerContainer),this.$outerContainer.append(this.$viewContainer),this.$viewContainer.css("width","100%"),this.layoutEngine=y.LayoutEngineFactory.make(this.$viewContainer,o.layoutEngineOptions),this._getCorrespondingTile=function(e){var t=this.$viewContainer.find(g.toClassSelector(e.id));return v("CorrespondingTile"),v(t),t}},y.Layer.View.prototype.clearView=function(e){this.layoutEngine.removeAll(e)},y.Layer.View.prototype.removeTiles=function(t){var n=this;e.each(t,function(t,o){var i=e(o);n.layoutEngine.remove(i)})},y.Layer.View.prototype.addTiles=function(e){this.layoutEngine.add(e)},y.Layer.View.prototype.addOptionsBox=function(){this.$optionsContainer=e('<section class="'+S.CSS_CLASSES.options+'" class="'+S.CSS_CLASSES.clearfix+'"></section>'),this.$outerContainer.prepend(this.$optionsContainer)},y.Layer.View.prototype.addSorter=function(){var t=this,n=e.extend({},this.options.sortFns),o=N.sortOptions(s({optionSet:n}));this.$optionsContainer.prepend(o),this.$optionsContainer.find(" > "+g.toSelector(S.CSS_CLASSES.sorter));var i=this.$optionsContainer.find("a");i.click(function(){var o=e(this).attr("data-sort-value");return t.$optionsContainer.find(g.toSelector(S.CSS_CLASSES.sorter)+" > > > .selected").removeClass("selected"),e(this).addClass("selected"),t.layoutEngine.sort(o,n[o]),!1})},y.Layer.View.prototype.appendFilterDiv=function(t){var n=N.filterOptions(s({filterOptions:this.options.filterBy}));this.$filter=e(n),this.$optionsContainer.append(this.$filter),this.$filterLinks=this.$filter.filter(g.toSelector(S.CSS_CLASSES.filter)).find("a"),this.$filterBox=this.$filter.find("#filterField"),t&&t()},y.Layer.View.prototype.addFilterBoxFn=function(){var t=this;this.$filterBox.keyup(function(){var n=e(this).val().toLowerCase();t.$filterLinks.removeClass("selected"),t.layoutEngine.filter(n,"contains")})},y.Layer.View.prototype.addFilterLinkFn=function(){var t=this;this.$filterLinks.click(function(){var n=e(this).attr("data-filter-value");return"*"!==n&&(n="."+S.FA_TAG+n),t.$filterLinks.removeClass("selected"),t.$filterBox.val("Enter search here."),e(this).addClass("selected"),t.layoutEngine.filter(n,"class"),!1})},y.Layers={},y.Layers.Res=function(e,t,n){this.$tile=n,this.node=n.data("node");var o=[],i=l(E.selectSubjectOf,this.node.getFComponentOT("uri").data),a=l(E.selectObjectOf,this.node.getFComponentOT("uri").data);o.push({query:i,type:S.CSS_CLASSES.typeClasses.outgoing}),o.push({query:a,type:S.CSS_CLASSES.typeClasses.incoming}),y.Layer.call(this,e,t,o)},y.Layers.Res.prototype=Object.create(y.Layer.prototype),y.Layers.Res.prototype.constructor=y.Layers.Res,y.Layers.Res.prototype._addOverlayContent=function(){var t=e.Deferred(),n=this.$overlay.find(g.toSelector(S.CSS_CLASSES.overlayContent));return n.append(e(N.overlayContent(s({node:this.node})))),this.$content=n.find(g.toSelector(S.CSS_CLASSES.innerScroll)),this.$content.css("width",f.width()-parseInt(this.$overlay.css("padding-left"))-parseInt(this.$overlay.css("padding-right"))+"px"),this.$content.css("height",f.height()-this.$overlay.find(g.toSelector(S.CSS_CLASSES.innerNoScroll)).height()+"px"),t.resolve(),t.promise()},y.Layers.Res.prototype._addBackgroundColor=function(){var t=new RGBColor(this.$tile.css("background-color"));this.$overlay.css("background-color",t.toRGB()),e.each(this.$content.children("div"+g.toSelector("innerScroll")),function(n,o){t.r-=10,t.b-=10,t.g-=10,e(o).css("background",t.toRGB())})},y.Layers.Res.prototype.loadByRemote=function(){var e=this,t=e.$overlay.find(g.toSelector(S.CSS_CLASSES.innerNoScroll));t.css({"background-image":"url('img/loader.gif')","background-repeat":"no-repeat","background-position":"center"});var n=l(E.remoteSubjectOf,e.node.getFComponentOT("uri").data)+" LIMIT "+e.options.remoteOptions.remoteLimit,o=l(E.remoteObjectOf,e.node.getFComponentOT("uri").data)+" LIMIT "+e.options.remoteOptions.remoteLimit,i=2*C.backends.length,a=0;C.loadingDone.attach(new y.Listener(function(r,s){(s===n||s===o)&&(a++,v("remoteDoneCount "+a),e.update(),a===i&&(t.css({"background-image":""}),C.loadingDone.dettach(this)))})),C.insertByQuery(n),C.insertByQuery(o)},y.Layers.Res.prototype.show=function(){var e=this;this.zIndex=k++;var t=c(S.CSS_CLASSES.preview),n=c(S.CSS_CLASSES.overlay);this.$overlay.css({clip:A?t:n,opacity:1,zIndex:this.zIndex,pointerEvents:"auto"}),A?e.$overlay.on(O,function(){e.$overlay.off(O),setTimeout(function(){e.$overlay.css("clip",n).on(O,function(){e.$overlay.off(O),e.openEvent.notify()})},25)}):e.openEvent.notify()},y.Layers.Res.prototype.hide=function(){var e=this,t=d(this.$tile),n="rect("+t.top+"px "+(t.left+t.width)+"px "+(t.top+t.height)+"px "+t.left+"px)";this.$overlay.css({clip:n,opacity:1,pointerEvents:"none"}),A?e.$overlay.on(O,function(){e.$overlay.off(O),setTimeout(function(){e.$overlay.css("opacity",0).on(O,function(){e.$overlay.off(O).css({clip:"auto",zIndex:-1}),e.$tile.data("isExpanded",!1)})},25)}):(e.$overlay.css({opacity:0,zIndex:-1}),e.$tile.data("isExpanded",!1))},y.Layers.InlayRes=function(e,t,n){this.uri=n;var o=[],i=l(E.selectSubjectOf,n),a=l(E.selectObjectOf,n);o.push({query:i,type:S.CSS_CLASSES.typeClasses.outgoing}),o.push({query:a,type:S.CSS_CLASSES.typeClasses.incoming}),y.Layer.call(this,e,t,o)},y.Layers.InlayRes.prototype=Object.create(y.Layer.prototype),y.Layers.InlayRes.prototype.constructor=y.Layers.Res,y.Layers.InlayRes.prototype.loadByRemote=function(){v("loadrem");var e=this,t=l(E.remoteSubjectOf,e.uri)+" LIMIT "+e.options.remoteOptions.remoteLimit,n=l(E.remoteObjectOf,e.uri)+" LIMIT "+e.options.remoteOptions.remoteLimit,o=2*C.backends.length,i=0;C.loadingDone.attach(new y.Listener(function(a,r){(r===t||r===n)&&(i++,v("remoteDoneCount "+i),e.update(),i===o&&C.loadingDone.dettach(this))
})),C.insertByQuery(t),C.insertByQuery(n)},y.Layers.InlayRes.prototype._addOverlay=function(){var t=e.Deferred();return this.$overlay=this.$parent,t.resolve(),t.promise()},y.Layers.InlayRes.prototype._addBackgroundColor=function(){},y.Layers.InlayRes.prototype._addOverlayContent=function(){var t=e.Deferred();return this.$content=e("<div class="+S.CSS_CLASSES.overlayContent+"></div>"),this.$overlay.append(this.$content),t.resolve(),t.promise()},y.Layers.InlayRes.prototype.open=function(){this.openEvent.notify()},y.Layers.InlayRes.prototype.show=function(){this.$overlay.css({position:"static",opacity:1,pointerEvents:"auto"})},y.Layers.InlayRes.prototype.hide=function(){this.$overlay.css({opacity:0})},y.Layers.Literal=function(e,t,n){this.$tile=n,this.node=n.data("node");var o=[],i=l(E.literalIsObjectOf,this.node.getFComponentOT("label").data.value);o.push({query:i,type:S.CSS_CLASSES.typeClasses.incoming}),y.Layer.call(this,e,t,o)},y.Layers.Literal.prototype=Object.create(y.Layer.prototype),y.Layers.Literal.prototype.constructor=y.Layers.Literal,y.Layers.Literal.prototype._addOverlayContent=function(){return y.Layers.Res.prototype._addOverlayContent.call(this)},y.Layers.Literal.prototype._addBackgroundColor=function(){y.Layers.Res.prototype._addBackgroundColor.call(this)},y.Layers.Literal.prototype.loadByRemote=function(){var e=this,t=l(E.remoteLiteralIsObjectOf,e.node.getFComponentOT("value"));C.insertByQuery(t+" LIMIT "+e.options.remoteOptions.remoteLimit)},y.Layers.Blank=function(){},y.Layers.Blank.prototype=Object.create(y.Layer.prototype),y.Layers.Blank.prototype.constructor=y.Layers.Blank,y.Layers.Inlay=function(e,t,n){y.Layer.call(this,e,t,n)},y.Layers.Inlay.prototype=Object.create(y.Layer.prototype),y.Layers.Inlay.prototype.constructor=y.Layers.Blank,y.Layers.Inlay.prototype._addOverlay=function(){var t=e.Deferred();return this.$overlay=this.$parent,t.resolve(),t.promise()},y.Layers.Inlay.prototype._addBackgroundColor=function(){},y.Layers.Inlay.prototype._addOverlayContent=function(){var t=e.Deferred();return this.$content=this.$overlay,t.resolve(),t.promise()},y.Layers.Inlay.prototype.show=function(){this.$overlay.css({position:"static",opacity:1,pointerEvents:"auto"})},y.Layers.Inlay.prototype.hide=function(){this.$overlay.css({opacity:0})},y.TemplatesLoader=function(e){this._templateInitDfd=e,this._neededTemps=["filterOptions","sortOptions","tileWrapper","stdNode","groupDropDown","overlayContent","overlayWrapper","previewItem","timelineWrapper","timelineItem"],this._methodsAreLoaded=function(){for(var e=0;arguments[0[e++]]!==o;)if("function"!=typeof N[arguments[e]])return!1;return!0}},y.TemplatesLoader.prototype._isLoaded=function(){return this._methodsAreLoaded(this._neededTemps)?(this._templateInitDfd.resolve(),!0):(console.log(S.MESSAGES.error.template),this._templateInitDfd.reject(),!1)},y.TemplatesLoader.prototype.getPrecompiledTemplates=function(){return N=t[w].templates,this._isLoaded()},y.RemoteDataLoader=function(e){this.backends=e,this.remoteEngine=new m,this.loadingStarted=new y.Event(this),this.loadingDone=new y.Event(this)},y.RemoteDataLoader.prototype.addBackend=function(e){this.backends.find(e)||this.backends.push(e)},y.RemoteDataLoader.prototype.removeBackend=function(e){var t=this.backends.indexOf(e);t>-1&&this.backends.splice(t,1)},y.RemoteDataLoader.prototype.generateTypeInsertionQuery=function(t){var n="INSERT DATA {";return e.each(t,function(e,t){t.res&&t.type&&(n+="<"+t.res.value+"> a "+"<"+t.type.value+">.")}),n+="}"},y.RemoteDataLoader.prototype.generateInsertionQuery=function(t){var n="INSERT DATA {";return e.each(t,function(e,t){t.subject===o?v("Resultset disfigured."):n+="uri"===t.subject.type?"<"+t.subject.value+"> ":"<"+t.subject.value+"> ",n+="<"+t.predicate.value+"> ","uri"===t.object.type?n+="<"+t.object.value+">. ":"literal"===t.object.type?n+='"'+encodeURIComponent(t.object.value)+'". ':"typed-literal"===t.object.type&&(n+='"'+encodeURIComponent(t.object.value)+'". '),t.labelSub&&(n+="<"+t.subject.value+'> rdfs:label "'+encodeURIComponent(t.labelSub.value)+'". '),t.labelObj&&(n+="<"+t.object.value+'> rdfs:label "'+encodeURIComponent(t.labelObj.value)+'". '),t.labelPred&&I.add(encodeURIComponent(t.predicate.value),encodeURIComponent(t.labelPred.value))}),n+="}"},y.RemoteDataLoader.prototype._loadRemoteAndInsert=function(e,t,n,i){this.remoteEngine.executeQuery(e,t,function(a,r){v("Remotequery: '"+e+"' was a success on "+t+"? \n"+r),a&&r?(a.subject!==o&&(a=[a]),v("Gives this results: "),v(a),L.executeQuery(n(a),function(){i&&i(r)})):i&&i(r)})},y.RemoteDataLoader.prototype.executeQuery=function(t,n,o){var i=this;this.loadingStarted.notify();var a=-1,r=[];e.each(n,function(e,n){a++,r[a]=!1,i._loadRemoteAndInsert(t,n,o,function(){r[a]=!0;for(var e=!0,n=0;r.length>n;n++)r[n]||(e=!1);e&&i.loadingDone.notify(t)})})},y.RemoteDataLoader.prototype.insertByResultset=function(e,t){var n=this;L.executeQuery(this.generateInsertionQuery(e),function(){n.loadingDone.notify(""),t&&t()})},y.RemoteDataLoader.prototype.insertByQuery=function(e,t){t?this.executeQuery(e,t,this.generateInsertionQuery):this.executeQuery(e,this.backends,this.generateInsertionQuery)},y.RemoteDataLoader.prototype.insertTypesByQuery=function(e,t){t?this.executeQuery(e,t,this.generateTypeInsertionQuery):this.executeQuery(e,this.backends,this.generateTypeInsertionQuery)};var $={pathToWorkers:"../../workers/",language:"en",data:o,dataLoc:o,dataFormat:o,sparqlData:o,generateTimeline:!0,initLayer:{name:"Inlay",args:[[{query:"SELECT ?subject ?label ?description ?type WHERE { ?subject rdfs:label ?label . OPTIONAL { ?subject rdfs:description ?description } . OPTIONAL { ?subject rdfs:comment ?description }. OPTIONAL {?subject rdfs:type ?type}}"}]]},openDetailOnInit:"",rdfstoreOptions:{persistence:!0,name:"",overwrite:!0,engine:"",engineData:{mongoDomain:"",mongoPort:"",mongoOptions:{}}},layerOptions:{nodeFilters:{blacklistPredURI:{fn:function(t,n){return e.each(t,function(o,i){i.hasComponentType("predicate")&&n&&e.each(n,function(e,n){for(var o=0;i.componentTypes.predicate>=o;o++){var a=RegExp(n).exec(i.components.predicate[o].value);null!==a&&delete t[o]}})}),t},config:[]},blacklistURI:{fn:function(t,n){return e.each(t,function(o,i){i.hasComponentType("uri")&&n&&e.each(n,function(e,n){var a=RegExp(n).exec(i.components.uri[0]);null!==a&&delete t[o]})}),t},config:[]},multiResNode:{fn:function(t){var n=[];return e.each(t,function(e,o){("resNode"===o.type||"multiResNode"===o.type)&&(o.components.uri[0].data in n?(n[o.components.uri[0].data].type="multiResNode",n[o.components.uri[0].data].merge(o),delete t[e]):n[o.components.uri[0].data]=o)}),t}},blankNode:{fn:function(t){return e.each(t,function(e,t){t.getType()==S.NODE_TYPES.blankNode&&v("TODO Blanknode")}),t},config:{}}},tileFilters:{scale:{fn:function(t,n){return e.each(t,function(t,o){var i,a=e(o),r=a.data("node");i=r.style?r.style:n.defaultStyles[r.getType()]?n.defaultStyles[r.getType()]:n.defaultStyles.stdNode,"number"!=typeof i.height?r.dynLayoutFn?r.dynLayoutFn(a,r,i,n):n.defaultDynLayoutFns[r.getType()]?n.defaultDynLayoutFns[r.getType()](a,r,i,n):n.defaultDynLayoutFns.stdNode(a,r,i,n):r.layoutFn?r.layoutFn(a,r,i,n):n.defaultLayoutFns[r.getType()]?n.defaultLayoutFns[r.getType()](a,r,i,n):n.defaultLayoutFns.stdNode(a,r,i,n)}),t},config:{multiplicator:1,defaultLayoutFns:{stdNode:function(t,n,o,i){var a=t.height()+o.topPadding,r=i.multiplicator;t.width(o.width*r);var s=o.height*r;t.height(s);var l=s-(o.topPadding+o.bottomPadding*r),p=0,c={};e.each(n.components,function(t,n){e.each(n,function(e,t){var n=t.id;c[n]=t.style?t.style:i.defaultContentStyles[t.type]?i.defaultContentStyles[t.type]:i.defaultContentStyles.stdComponent,!c[n]||c[n].display&&"none"==c[n].display||(p+=c[n].height)})}),e.each(n.components,function(r,s){e.each(s,function(e,r){var s=r.id;if(c[s]&&(!c[s].display||"none"!=c[s].display)){var d=c[s];a=r.layoutFn?r.layoutFn(t,n,o,r,d,i,a,l,p):i.defaultContentLayoutFns[r.type]?i.defaultContentLayoutFns[r.type](t,n,o,r,d,i,a,l,p):i.defaultContentLayoutFns.stdComponent(t,n,o,r,d,i,a,l,p)}})})}},defaultDynLayoutFns:{stdNode:function(t,n,o,i){var a=t.height(),r=i.multiplicator,s=a+o.topPadding*r;t.width(o.width*r),e.each(n.components,function(a,r){e.each(r,function(e,a){var r;r=a.style?a.style:i.defaultContentStyles[a.type]?i.defaultContentStyles[a.type]:i.defaultContentStyles.stdComponent,!r||r.display&&"none"==r.display||(s=a.dynLayoutFn?a.dynLayoutFn(t,n,o,a,r,i,s):i.defaultContentDynLayoutFns[a.type]?i.defaultContentDynLayoutFns[a.type](t,n,o,a,r,i,s):i.defaultContentDynLayoutFns.stdComponent(t,n,o,a,r,i,s))})}),t.height(s+o.bottomPadding*r-a)}},defaultContentLayoutFns:{predicate:function(e,t,n,o,i,a,r,s,l){var p=e.find(g.toClassSelector(o.id));v(g.toClassSelector(o.id)),console.log(p);var c=a.multiplicator,d=s*(i.height/l)-n.spacing*c,u=(n.width-n.leftPadding-n.rightPadding)*c;p.height(d),p.width(u),p.css("top",r),p.css("left",n.leftPadding),r+=d+n.spacing*c,p.children().height(d);var h=e.find(g.toSelector(S.CSS_CLASSES.tileClasses.typeImage)),y=e.find(g.toSelector(S.CSS_CLASSES.tileClasses.predicate)),f=e.find(g.toSelector(S.CSS_CLASSES.tileClasses.predicateLabel)),m=.2*u;return h.height("auto"),h.width(m),f.css("left",m),f.width(u-m),y.width(u),r},stdComponent:function(e,t,n,o,i,a,r,s,l){var p=e.find(g.toClassSelector(o.id)),c=a.multiplicator,d=s*(i.height/l)-n.spacing*c;return p.width((n.width-n.leftPadding-n.rightPadding)*c),p.height(d),p.css("top",r),p.css("left",n.leftPadding),r+=d+n.spacing*c}},defaultContentDynLayoutFns:{predicate:function(e,t,n,o,i,a,r){var s=e.find(g.toClassSelector(o.id)),l=a.multiplicator,p=i.height*l,c=(n.width-n.leftPadding-n.rightPadding)*l;s.height(p),s.width(c),s.css("top",r),s.css("left",n.leftPadding),r+=p+n.spacing*l,s.children().height(p);var d=e.find(g.toSelector(S.CSS_CLASSES.tileClasses.typeImage)),u=e.find(g.toSelector(S.CSS_CLASSES.tileClasses.predicate)),h=e.find(g.toSelector(S.CSS_CLASSES.tileClasses.predicateLabel)),y=.2*c;return d.height("auto"),d.width(y),h.css("left",y),h.width(c-y),u.width(c),r},stdComponent:function(e,t,n,o,i,a,r){var s=e.find(g.toClassSelector(o.id)),l=a.multiplicator;return s.width((n.width-n.leftPadding-n.rightPadding)*l),s.height(i.height*l),s.css("top",r),s.css("left",n.leftPadding),r+=(i.height+n.spacing)*l}},defaultStyles:{stdNode:{width:200,height:"dynamic",topPadding:10,leftPadding:10,rightPadding:10,bottomPadding:10,spacing:5}},defaultContentStyles:{predicate:{height:20},label:{height:60},stdComponent:{height:40}}}},textScale:{fn:function(t,n,o){return o.view.layoutEngine.partialDoneEvent.attach(new y.Listener(function(t,o){if(o=e(o)){var i=(new Date).getTime(),a=o.find(g.toSelector(S.CSS_CLASSES.textScale));a.textfill(n.maxFontPixels,n.minFontPixels,function(e){e.css({"overflow-y":"auto","word-wrap":"break-word"})}),a.removeClass(S.CSS_CLASSES.textScale),a.addClass(S.CSS_CLASSES.textScaleDone),v("Event textScaleEvent done after: "+((new Date).getTime()-i)+" milisec")}})),t},config:{maxFontPixels:80,minFontPixels:12}},backgroundColor:{fn:function(t,n){var o=function(t,n){var o,i;e.each(t,function(e,t){var n=t.type.value;if(-1!==n.indexOf(D.rdfs)||-1!==n.indexOf(D.owl)){if(!o)if(i){var a=chroma.scale([i.hex(),"#"+md5(n).substring(0,6)]).mode("lab");i=chroma(a(.5).hex())}else i=chroma("#"+md5(n).substring(0,6))}else if(o){var a=chroma.scale([o.hex(),"#"+md5(n).substring(0,6)]).mode("lab");o=chroma(a(.5).hex())}else o=chroma("#"+md5(n).substring(0,6))}),o?(o._rgb[0]>200&&o._rgb[1]>200&&o._rgb[2]>200&&(o._rgb[0]=o._rgb[0]-50,o._rgb[1]=o._rgb[1]-50,o._rgb[2]=o._rgb[2]-50),n.css("background-color",o)):i&&(i._rgb[0]>200&&i._rgb[1]>200&&i._rgb[2]>200&&(i._rgb[0]=i._rgb[0]-50,i._rgb[1]=i._rgb[1]-50,i._rgb[2]=i._rgb[2]-50),n.css("background-color",i))},i=0,a=[],r="SELECT DISTINCT ?res ?type WHERE { VALUES ?res {";return a.push({count:0,cbTiles:[],query:r}),e.each(t,function(t,o){var s=e(o),l=s.data("node");if(l.getType()===S.NODE_TYPES.resNode||"multiResNode"===l.getType()){var p=l.getFComponentOT("uri").data,c=a.length-1;a[c].count<n.batchSize?(a[c].count++,a[c].cbTiles.push(s),a[c].query+="<"+p+">"):(a[c].query+="} ?res a ?type}",c++,a.push({count:1,cbTiles:[],query:r}),a[c].cbTiles.push(s),a[c].query+="<"+p+">")}else{i++;var d,u;l.style&&l.style.bgColors?(d=l.style.bgColors,u=new RGBColor(d[i%d.length])):n.defaultStyles[l.getType()]&&(d=n.defaultStyles[l.getType()].bgColors,u=new RGBColor(d[i%d.length])),u&&s.css("background-color","rgba("+u.r+", "+u.g+", "+u.b+" ,1)")}}),a[a.length-1].query+="} ?res a ?type}",a[0].count>0&&e.each(a,function(t,n){C.insertTypesByQuery(n.query),C.loadingDone.attach(new y.Listener(function(t,i){i==n.query&&(C.loadingDone.dettach(this),e.each(n.cbTiles,function(t,n){var i=e(n),a=i.data("node"),r=a.getFComponentOT("uri").data,s=l(E.typeQuery,r);L.executeQuery(s,function(e){o(e,i)})}))}))}),t},config:{batchSize:100,defaultStyles:{literal:{bgColors:["#555555"]},blankNode:{bgColors:["#999999"]}}}},backgroundImg:{fn:function(e,t){return e},config:{opacity:.5}},predicateLabel:{fn:function(t){return e.each(t,function(t,n){var o=e(n),i=o.find(g.toSelector(S.CSS_CLASSES.tileClasses.predicate)),a=o.find(g.toSelector(S.CSS_CLASSES.tileClasses.typeImage)),r=o.find(g.toSelector(S.CSS_CLASSES.tileClasses.predicateLabel));o.get()[0].addEventListener("contextmenu",function(e){return e.preventDefault(),"visible"!==i.css("visibility")?(i.css("visibility","visible"),a.css("visibility","hidden"),r.css("visibility","hidden")):(i.css("visibility","hidden"),a.css("visibility","visible"),r.css("visibility","visible")),!1},!1)}),t}},browsablity:{fn:function(t,n,o){return e.each(t,function(t,i){var a,r,s,l=e(i),p=l.data("node"),c=p.getType();p.browsablity?(p.browsablity.layerGenFn&&(a=p.browsablity.layerGenFn),p.browsablity.layerOptionsFn&&(r=p.browsablity.layerOptionsFn),p.browsablity.onInitFn&&(r=p.browsablity.onInitFn)):c in n.types&&(n.types[c].layerGenFn&&(a=n.types[c].layerGenFn),n.types[c].layerOptionsFn&&(r=n.types[c].layerOptionsFn),n.types[c].onInitFn&&(r=n.types[c].onInitFn)),a||(a=n.defaultFns.layerGenFn),r||(r=n.defaultFns.layerOptionsFn),s||(s=n.defaultFns.onInitFn),l.click(function(){return function(){l.data("isExpanded",!0);var e=a(p,l,o.$parent,r(o.options));e&&e.initSwitch.attach(new y.Listener(function(){return function(e){s(e,o)}}(s,o)))}(a,r,s,o)})}),t},config:{types:{blankNode:{layerGenFn:function(){}},stdNode:{layerGenFn:function(e,t,n,o){return new y.Layers.Res(n,o,t)}},literal:{layerGenFn:function(e,t,n,o){return new y.Layers.Literal(n,o,t)}}},defaultFns:{layerOptionsFn:function(t){return e.extend(!0,{},t,{viewOptions:{filterBy:[{value:"*",label:"showAll"},{value:S.CSS_CLASSES.typeClasses.incoming,label:"in"},{value:S.CSS_CLASSES.typeClasses.outgoing,label:"out"}]}})},layerGenFn:function(e,t,n,o){return new y.Layers.Res(n,o,t)},onInitFn:function(e,t){t.closeEvent.attach(new y.Listener(function(e){e.filterEvent.notify({action:"removeLayer"})})),t.filterEvent.notify({action:"addLayer",args:e})}}}},weight:{fn:function(t,n){return e.each(t,function(t,o){var i=e(o),a=i.data("node");a.weight=0,e.each(n,function(e,t){a.weight=t.fn(a,t.data)}),i.data("node",a)}),t},config:{uriRule:{fn:function(t,n){var o=t.getFComponentOT("uri").data,i=t.weight;return o&&e.each(n,function(e,t){-1!==o.indexOf(e)&&(i+=t*Math.random())}),i},data:{"http://www.w3.org/2000/01/rdf-schema#":-1,"http://www.w3.org/2002/07/owl#":-1}},predicateRule:{fn:function(e,t){var n=e.weight;return e.forEachComponentType("predicate",function(){n+=t.val*Math.random()}),n},data:{val:.5}},templateRule:{fn:function(t,n){var o=t.useTemplateID,i=t.weight;return o&&e.each(n,function(e,t){o===e&&(i+=t*(Math.random()+.1))}),i},data:{maps:2,cityChart:1}}}}},generateSortOptions:!0,usePreviews:!1,previewAsOverlay:!0,generateFilterOptions:!0,modelOptions:{batchSize:2e3},remoteOptions:{defaultInitRemoteQuery:"SELECT ?subject ?predicate ?object { VALUES ?subject { <http://dbpedia.org/resource/Berlin> <http://dbpedia.org/resource/Passau> <http://dbpedia.org/resource/Munich> <http://dbpedia.org/resource/Frankfurt> } VALUES ?predicate { rdfs:label } ?subject ?predicate ?object. FILTER (lang(?object) = 'en') } LIMIT 150",remoteBackends:["http://dbpedia.org/sparql"],remoteLimit:1e3,remoteDynamically:!0,waitForRemote:!1,remoteLabelBackend:["http://zaire.dimis.fim.uni-passau.de:8080/bigdata/sparql","http://dbpedia.org/sparql"],remoteLabels:!0},viewOptions:{sortFns:{weight:function(t){var n=e(t),o=n.data("node"),i=o.weight;return a(i)?0:-1*i},alphabetical:function(t){var n=e(t),o=n.find(g.toSelector(S.CSS_CLASSES.tileClasses.label)),i=o.length?o:n;return i.text()}},filterBy:[{value:"*",label:"showAll"}],layoutEngineOptions:{supportRegExpFilter:!0,useEngine:"isotope",clusterSize:10,clusterWait:10,shuffle:{filterFns:{contains:function(t,n){if("all"!==n.group&&-1===e.inArray(n.group,t.data("groups")))return!1;var o=e.trim(t.text()).toLowerCase();return-1!==o.indexOf(selector)},"class":function(e){return e.hasClass(selector)}},options:{itemSelector:g.toSelector(S.CSS_CLASSES.tileClasses.tile),columnWidth:1,sequentialFadeDelay:0,supported:!1}},isotope:{options:{itemSelector:g.toSelector(S.CSS_CLASSES.tileClasses.tile),transitionDuration:0,layoutMode:"packery",sortBy:"weight",getSortData:{weight:function(t){var n=e(t),o=n.data("node"),i=o.weight;return a(i)?0:-1*i},alphabetical:function(t){var n=e(t),o=n.find(g.toSelector(S.CSS_CLASSES.tileClasses.label)),i=o.length?o:n;return i.text()}}}}}}}};y.prototype={_initRdfStore:function(){var t=this,n=e.Deferred();return v("Init RDFSTORE"),a(L)&&(L=new y.RdfStore(t.options.rdfstoreOptions,function(){n.resolve()})),n.promise()},_initRemoteDataLoader:function(){a(C)?C=new y.RemoteDataLoader(this.options.layerOptions.remoteOptions.remoteBackends):e.each(this.options.layerOptions.remoteOptions.remoteBackends,function(e,t){C.addBackend(t)})},_initTemplating:function(){var t=e.Deferred();Handlebars.registerHelper("toClass",function(e){return g.toClass(e)}),Handlebars.registerHelper("tScaleWrap",function(e){return e=Handlebars.Utils.escapeExpression(e),new Handlebars.SafeString("<span class='"+S.CSS_CLASSES.textScale+"' style='position:static'>"+e+"</span>")}),Handlebars.registerHelper("firstComp",function(e,t,n){var o="";return e.hasComponentType(t)&&(o+=n.fn(e.components[t][0])),o}),Handlebars.registerHelper("hasCompType",function(e,t,n){return e.hasComponentType(t)?n.fn(this):o}),Handlebars.registerHelper("compsEach",function(e,t,n){var o="";return e.forEachComponentType(t,function(e){o+=n.fn(e)}),o}),Handlebars.registerHelper("keysEach",function(e,t){var n="";for(var o in e)n+=t.fn(o);return n}),Handlebars.registerHelper("ifLang",function(e,t){return!e||e.lang!==o&&"en"!==e.lang?o:t.fn(this)}),Handlebars.registerHelper("predicateLabelRetriver",function(e,t){if(e&&!e.label){var n=e.value.split("#");1===n.length&&(n=n[0].split("/")),e.label=n[n.length-1]}return t.fn(this)});var n=new y.TemplatesLoader(t);return n.getPrecompiledTemplates(),t.promise()},_generateQueries:function(){var e=this;E={defaultInitRemoteQuery:this.options.layerOptions.remoteOptions.defaultInitRemoteQuery,remoteResByLabel:"SELECT DISTINCT ?subject ?predicate ?object WHERE { VALUES ?predicate {rdfs:label} VALUES ?object {'"+S.DUMMY+"'@"+e.options.language+"} ?subject ?predicate ?object}",remoteResByUri:"SELECT DISTINCT ?subject ?predicate ?object WHERE { VALUES ?subject {<"+S.DUMMY+">} VALUES ?predicate { rdfs:label } ?subject ?predicate ?object. FILTER(LANG(?object) = '' || LANGMATCHES(LANG(?object), '"+e.options.language+"'))}",remoteSubjectOf:" SELECT DISTINCT ?subject ?predicate ?object ?labelObj ?labelPred WHERE { VALUES ?subject {<"+S.DUMMY+">} ?subject ?predicate ?object. OPTIONAL { ?object rdfs:label ?labelObj }. OPTIONAL { ?predicate rdfs:label ?labelPred }. FILTER(isIRI(?object)  || (LANG(?object) = '' || LANGMATCHES(LANG(?object), '"+e.options.language+"'))). FILTER(LANG(?labelPred) = '' || LANGMATCHES(LANG(?labelPred), '"+e.options.language+"')). FILTER(LANG(?labelObj) = '' || LANGMATCHES(LANG(?labelObj), '"+e.options.language+"'))}",remoteObjectOf:" SELECT DISTINCT ?subject ?predicate ?object ?labelSub ?labelPred WHERE {VALUES ?object {<"+S.DUMMY+">} ?subject ?predicate ?object. OPTIONAL { ?subject rdfs:label ?labelSub }. OPTIONAL { ?predicate rdfs:label ?labelPred }. FILTER(isIRI(?subject)  || (LANG(?subject) = '' || LANGMATCHES(LANG(?subject), '"+e.options.language+"'))). FILTER(LANG(?labelPred) = '' || LANGMATCHES(LANG(?labelPred), '"+e.options.language+"')). FILTER(LANG(?labelSub) = '' || LANGMATCHES(LANG(?labelSub), '"+e.options.language+"'))}",remoteLiteralIsObjectOf:" SELECT DISTINCT ?subject ?predicate ?object ?labelSub ?labelPred WHERE {VALUES ?object {'"+S.DUMMY+"'} ?subject ?predicate ?object. OPTIONAL { ?subject rdfs:label ?labelSub }. OPTIONAL { ?predicate rdfs:label ?labelPred }}",selectSubjectOf:" SELECT DISTINCT ?subject ?predicate ?label ?description WHERE {<"+S.DUMMY+"> ?predicate ?subject. OPTIONAL { ?subject rdfs:label ?label}. OPTIONAL { ?subject rdfs:description ?description } . OPTIONAL { ?subject rdfs:comment ?description }}",selectObjectOf:" SELECT DISTINCT ?subject ?predicate ?label ?description WHERE {?subject ?predicate <"+S.DUMMY+">. OPTIONAL { ?subject rdfs:label ?label}. OPTIONAL { ?subject rdfs:description ?description } . OPTIONAL { ?subject rdfs:comment ?description }}",typeQuery:"SELECT DISTINCT ?type WHERE {<"+S.DUMMY+"> a ?type} ORDER BY ?type",getLabelOf:"SELECT DISTINCT ?label WHERE { <"+S.DUMMY+"> rdfs:label ?label } LIMIT 1",labelIsObjectOf:"SELECT DISTINCT ?subject ?label WHERE { ?subject rdfs:label ?label. FILTER (STR(?label)='"+S.DUMMY+"')}",literalIsObjectOf:"SELECT DISTINCT ?subject ?predicate ?type ?label ?description WHERE {?subject ?predicate ?oLiteral. FILTER (STR(?oLiteral)='"+S.DUMMY+"'). OPTIONAL { ?subject rdfs:label ?label}. OPTIONAL { ?subject rdfs:description ?description } . OPTIONAL { ?subject rdfs:comment ?description }}",previewQuery:" SELECT DISTINCT ?label ?description ?type WHERE { <"+S.DUMMY+"> rdfs:label ?label . OPTIONAL { <"+S.DUMMY+"> rdfs:description ?description } . OPTIONAL { <"+S.DUMMY+"> rdfs:comment ?description } . OPTIONAL { <"+S.DUMMY+"> rdfs:type ?type}}",label:"SELECT DISTINCT ?label WHERE { <"+S.DUMMY+"> rdfs:label ?label . FILTER(LANG(?label) = '' || LANGMATCHES(LANG(?label), '"+e.options.language+"'))}",blankNodeQuery:"SELECT DISTINCT ?object WHERE {<"+S.DUMMY+"> ?predicate ?object}"}},_checkInsertion:function(){var e=this,t=!1;return a(e.options.dataFormat)||(a(e.options.dataLoc)?a(e.options.data)||(t=!0,L.insertData(e.options.data,e.options.dataFormat,function(){T[e.pluginID].trigger(S.EVENT_TYPES.store.insert,e)})):(t=!0,e._ajaxLoadData(e.options.dataLoc,e.options.dataFormat,function(t,n){L.insertData(t,n,function(){T[e.pluginID].trigger(S.EVENT_TYPES.store.insert,e)})}))),t},_ajaxLoadData:function(t,n,o){var i=this;T[i.pluginID].trigger(S.EVENT_TYPES.loading.start,i),e.ajax({url:t,dataType:"text",success:function(e){o(e,n)}}).fail(function(){T[i.pluginID].trigger(S.EVENT_TYPES.loading.done,i),alert(S.MESSAGES.error.ajax)})},init:function(){var t=this;t._generateQueries(),t._initRemoteDataLoader(),T[this.pluginID].addEventHandler(S.EVENT_TYPES.store.insert,function(){e.each(t._layers,function(e){v("view "+e+" has to be updated updating")})}),T[this.pluginID].addEventHandler("throttledresize",function(){var e=t._$parent.children(g.toSelector(S.CSS_CLASSES.overlay));e.css("clip",c(S.CSS_CLASSES.overlay));var n=e.find(g.toSelector(S.CSS_CLASSES.innerScroll));n.css("width",f.width()-parseInt(e.css("padding-left"))-parseInt(e.css("padding-right"))+"px"),n.css("height",f.height()-e.find(g.toSelector(S.CSS_CLASSES.innerNoScroll)).height()+"px")},f),t.options.generateTimeline&&(this.timeLine=new y.TimeLine(this._$parent)),"pending"===_.state()&&(_=e.Deferred(),e.when(t._initRdfStore(),t._initTemplating()).done(function(){var n={};e.each(t.options.layerOptions.nodeFilters,function(e,t){t.template&&(N[e]?console.log("Template with identifier "+e+" already defined"):n[e]=Handlebars.compile(t.template))}),e.extend(!0,N,n),_.resolve()})),e.when(_.promise()).done(function(){t._layers={};var e=[];e.push(t._$parent),e.push(t.options.layerOptions),e=e.concat(t.options.initLayer.args);var n=r(y.Layers[t.options.initLayer.name],e);t.addLayer(n),t._topLayer=n.id,t._layers[n.id].initSwitch.attach(new y.Listener(function(){t.options.initLayer.hide&&t._$parent.find(g.toSelector(S.CSS_CLASSES.outerContainer)).css({opacity:0,visibility:"hidden"}),""!=t.options.openDetailOnInit&&n.view.layoutEngine.doneEvent.once(new y.Listener(function(){setTimeout(function(){n.view.layoutEngine._container.find("div:contains("+t.options.openDetailOnInit+")").click()},200)})),t._checkInsertion()||(t.options.sparqlData===o?n.update():C.insertByResultset(t.options.sparqlData,function(){n.update()}))}))})},addLayer:function(t){var n=this;this._layers[t.id]=t;var o=new y.Listener(function(e){n.timeLine&&(n.timeLine.addLayer(e),e.getTimeLineButton().on("click",function(){n.timeLine.open()}))});t.initSwitch.attach(o),t.openEvent.attach(new y.Listener(function(e){n._topLayer=e.id,n._extendedLayers[e.id]=e.zIndex,n.$body.addClass("noscroll")})),t.closeEvent.attach(new y.Listener(function(t){if(delete n._extendedLayers[t.id],e.isEmptyObject(n._extendedLayers)){n.$body.removeClass("noscroll");var o=0;e.each(n._extendedLayers,function(e,t){t>o&&(o=t,n._topLayer=e)})}else delete n._topLayer})),t.filterEvent.attach(new y.Listener(function(e,t){switch(t.action){case"addLayer":n.addLayer(t.args);break;case"removeLayer":n.removeLayer(e)}})),t.open()},removeLayer:function(e){delete this._layers[e.id]},updateTopLayer:function(){this._topLayer&&this._layers[this._topLayer].update()},insertData:function(t,n){var o=this;e.when(_.promise()).done(function(){L.insertData(t,n,function(){T[o.pluginID].trigger(S.EVENT_TYPES.store.insert,o),o.updateTopLayer()})})},insertDataPath:function(t,n){var o=this;e.when(_.promise()).done(function(){o._ajaxLoadData(t,n,o._selfProxy(o.insertData))})},insertDataFile:function(t){var n=this,o=new FileReader;o.onload=function(){var o=this.result,i="text/turtle";if(""===t.type){var a=t.name.split(".").pop();switch(a){case"ttl":i="text/turtle";break;case"turtle":i="text/turtle";break;case"n3":i="text/n3";break;case"json":i="application/json";break;case"jsld":i="application/ld+json";break;default:console.log(S.MESSAGES.warn.fileTypeNotKnown+i)}}else i=t.type;e.when(_.promise()).done(function(){n.insertData(o,i)})},o.readAsText(t)},insertRemoteByUri:function(t){e.when(_.promise()).done(function(){var e=l(E.remoteResByUri,t);C.insertByQuery(e)})},openViewByUri:function(e){var t=this,n=function(){alert("Didn't find an entry for "+e+".")},o=function(e){var n=new y.Nodes.Res(e),o=n.generateTile();o.css({"background-color":"#444444"});var i=t.options.layerOptions.tileFilters.backgroundColor.fn({0:o},t.options.layerOptions.tileFilters.backgroundColor.config,this._topLayer);C.loadingDone.once(new y.Listener(function(){var e=new y.Layers.Res(t._$parent,t.options.layerOptions,i[0]);t.addLayer(e)}))},i=l(E.getLabelOf,e);L.executeQuery(i,function(t){t&&t.length>0?(t[0].subject={},t[0].subject.token="uri",t[0].subject.value=e,o(t[0])):n()},n)},insertRemoteByLabel:function(t){e.when(_.promise()).done(function(){var e=l(E.remoteResByLabel,t);C.insertByQuery(e)})},openViewByLabel:function(t){var n=this,o=function(){alert("Didn't find an entry for "+t+".")},i=function(e){var t=new y.Nodes.Res(e),o=t.generateTile();o.css({"background-color":"#444444"});var i=n.options.layerOptions.tileFilters.backgroundColor.fn({0:o},n.options.layerOptions.tileFilters.backgroundColor.config,this._topLayer);C.loadingDone.once(new y.Listener(function(){var e=new y.Layers.Res(n._$parent,n.options.layerOptions,i[0]);n.addLayer(e)}))},a=l(E.labelIsObjectOf,t);L.executeQuery(a,function(t){if(t&&t.length>0)if(1===t.length)i(t[0]);else{for(var n=e("<div style='height: auto; width: auto; margin-right: auto; margin-left: auto; max-width: 500px; background-color: #111111'> What item should be viewed?<ul></ul></div>"),a=n.find("ul"),r=0;t.length>r;r++){var s=t[r],l=e("<li><a>"+s.subject.value+"</a></li>");l.click(function(t){return function(){i(t),e.magnificPopup.close()}}(s)),a.append(l)}e.magnificPopup.open({items:{src:n,type:"inline"}})}else o()},o)},insertRemoteAndOpenViewByUri:function(e){var t=this;t.insertRemoteByUri(e),C.loadingDone.once(new y.Listener(function(){t.openViewByUri(e)}))},insertRemoteAndOpenViewByLabel:function(e){var t=this;t.insertRemoteByLabel(e),C.loadingDone.once(new y.Listener(function(){t.openViewByLabel(e)}))},insertRemoteDataQuery:function(t,n){var i=this;e.when(_.promise()).done(function(){(n===o||""===n)&&(n=E.defaultInitRemoteQuery),C.insertByQuery(n,[t]),C.loadingDone.once(new y.Listener(function(){i.updateTopLayer()}))})},clearStore:function(){var t=this;L.executeQuery("CLEAR ALL",function(){v("store cleared"),e.each(t._layers,function(e,t){t.removeAllItems()})})},runQuery:function(e,t){L.executeQuery(e,function(e){t&&t(e)})},destroy:function(){var e=this;T[e.pluginID].destory(),T[e.pluginID]=o,e._$parent[w]=null}},e.fn[w]=function(t){return this.each(function(){e.data(this,"plugin_"+w)||e.data(this,"plugin_"+w,new y(this,t))})}})(jQuery,window,document),this.bSynopsis=this.bSynopsis||{},this.bSynopsis.templates=this.bSynopsis.templates||{},this.bSynopsis.templates.filterOptions=Handlebars.template(function(e,t,n,o,i){function a(e,t){var o,i="";return i+='\r\n                            <li><a data-filter-value="',(o=n.value)?o=o.call(e,{hash:{},data:t}):(o=e.value,o=typeof o===p?o.apply(e):o),i+=c(o)+'" class="',(o=n.value)?o=o.call(e,{hash:{},data:t}):(o=e.value,o=typeof o===p?o.apply(e):o),i+=c(o)+'">',(o=n.label)?o=o.call(e,{hash:{},data:t}):(o=e.label,o=typeof o===p?o.apply(e):o),i+=c(o)+"</a></li>\r\n                    "}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var r,s,l="",p="function",c=this.escapeExpression,d=this;return l+='    <div class="'+c((r=t.CSS_CLASSES,r=null==r||r===!1?r:r.optionCombo,typeof r===p?r.apply(t):r))+" "+c((r=t.CSS_CLASSES,r=null==r||r===!1?r:r.filter,typeof r===p?r.apply(t):r))+'">\r\n            <h2>Filter:</h2>\r\n            <ul class="'+c((r=t.CSS_CLASSES,r=null==r||r===!1?r:r.optionSet,typeof r===p?r.apply(t):r))+" "+c((r=t.CSS_CLASSES,r=null==r||r===!1?r:r.clearfix,typeof r===p?r.apply(t):r))+'" data-option-key="filter">\r\n                    ',s=n.each.call(t,t.filterOptions,{hash:{},inverse:d.noop,fn:d.program(1,a,i),data:i}),(s||0===s)&&(l+=s),l+='\r\n            </ul>\r\n            <input id="filterField" type="text" size="25" value="Enter search here.">\r\n    </div>\r\n    <div class="'+c((r=t.CSS_CLASSES,r=null==r||r===!1?r:r.optionCombo,typeof r===p?r.apply(t):r))+'">\r\n            <ul class="'+c((r=t.CSS_CLASSES,r=null==r||r===!1?r:r.optionButton,typeof r===p?r.apply(t):r))+" "+c((r=t.CSS_CLASSES,r=null==r||r===!1?r:r.clearfix,typeof r===p?r.apply(t):r))+'">\r\n                <li><a class="'+c((r=t.CSS_CLASSES,r=null==r||r===!1?r:r.refresh,typeof r===p?r.apply(t):r))+'">Refresh</a></li>\r\n            </ul>\r\n    </div>'}),this.bSynopsis.templates.groupDropDown=Handlebars.template(function(e,t,n,o,i){function a(e,t){var o,i="";return i+="\r\n            <option value=",(o=n.val)?o=o.call(e,{hash:{},data:t}):(o=e.val,o=typeof o===l?o.apply(e):o),i+=p(o)+">",(o=n.label)?o=o.call(e,{hash:{},data:t}):(o=e.label,o=typeof o===l?o.apply(e):o),i+=p(o)+"</option>\r\n            "}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var r,s="",l="function",p=this.escapeExpression,c=this;return s+='    <select id="GroupDropDown">\r\n            ',r=n.each.call(t,t,{hash:{},inverse:c.noop,fn:c.program(1,a,i),data:i}),(r||0===r)&&(s+=r),s+="\r\n    </select>"}),this.bSynopsis.templates.overlayContent=Handlebars.template(function(e,t,n,o,i){function a(e,t){var o,i,a,l="";return l+='\r\n            <div class="'+h((o=e.CSS_CLASSES,o=null==o||o===!1?o:o.innerNoScroll,typeof o===u?o.apply(e):o))+'">\r\n                <h2>\r\n                    ',a={hash:{},inverse:y.noop,fn:y.program(2,r,t),data:t},o=n.firstComp||e.firstComp,i=o?o.call(e,e.node,"label",a):f.call(e,"firstComp",e.node,"label",a),(i||0===i)&&(l+=i),l+="\r\n                    \r\n                </h2>\r\n                 ",a={hash:{},inverse:y.noop,fn:y.program(4,s,t),data:t},o=n.firstComp||e.firstComp,i=o?o.call(e,e.node,"uri",a):f.call(e,"firstComp",e.node,"uri",a),(i||0===i)&&(l+=i),l+='\r\n            </div>\r\n            <div class="'+h((o=e.CSS_CLASSES,o=null==o||o===!1?o:o.innerScroll,typeof o===u?o.apply(e):o))+'">\r\n            </div>\r\n    '
}function r(e){var t;return h((t=e.data,t=null==t||t===!1?t:t.value,typeof t===u?t.apply(e):t))}function s(e,t){var o;return(o=n.data)?o=o.call(e,{hash:{},data:t}):(o=e.data,o=typeof o===u?o.apply(e):o),h(o)}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var l,p,c,d="",u="function",h=this.escapeExpression,y=this,f=n.helperMissing;return d+="    ",c={hash:{},inverse:y.noop,fn:y.program(1,a,i),data:i},l=n.hasCompType||t.hasCompType,p=l?l.call(t,t.node,"label",c):f.call(t,"hasCompType",t.node,"label",c),(p||0===p)&&(d+=p),d}),this.bSynopsis.templates.overlayWrapper=Handlebars.template(function(e,t,n,o,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var a,r,s="",l="function",p=this.escapeExpression;return s+='		      \r\n		<div class="'+p((a=t.CSS_CLASSES,a=null==a||a===!1?a:a.overlay,typeof a===l?a.apply(t):a))+" ",(r=n.id)?r=r.call(t,{hash:{},data:i}):(r=t.id,r=typeof r===l?r.apply(t):r),s+=p(r)+'">\r\n            <span class="'+p((a=t.CSS_CLASSES,a=null==a||a===!1?a:a.buttonTimeline,typeof a===l?a.apply(t):a))+'">history</span>\r\n			<span class="'+p((a=t.CSS_CLASSES,a=null==a||a===!1?a:a.buttonClose,typeof a===l?a.apply(t):a))+'">close</span>\r\n			<div class="'+p((a=t.CSS_CLASSES,a=null==a||a===!1?a:a.overlayContent,typeof a===l?a.apply(t):a))+'">\r\n			</div>\r\n		</div>'}),this.bSynopsis.templates.previewItem=Handlebars.template(function(e,t,n,o,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var a,r,s="",l="function",p=this.escapeExpression;return s+='<div class="'+p((a=t.cssClass,a=null==a||a===!1?a:a.preview,typeof a===l?a.apply(t):a))+" "+p((a=t.cssClass,a=null==a||a===!1?a:a.preview,typeof a===l?a.apply(t):a))+"_",(r=n.index)?r=r.call(t,{hash:{},data:i}):(r=t.index,r=typeof r===l?r.apply(t):r),s+=p(r)+'">\r\n        <div class="'+p((a=t.cssClass,a=null==a||a===!1?a:a.previewContent,typeof a===l?a.apply(t):a))+'">\r\n            TODO\r\n        </div>\r\n</div>'}),this.bSynopsis.templates.sortOptions=Handlebars.template(function(e,t,n,o,i){function a(e){var t="";return t+='\r\n				<li><a data-sort-value="'+d(typeof e===c?e.apply(e):e)+'" class="'+d(typeof e===c?e.apply(e):e)+'">'+d(typeof e===c?e.apply(e):e)+"</a></li>\r\n			"}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var r,s,l,p="",c="function",d=this.escapeExpression,u=this,h=n.helperMissing;return p+='	<div class="'+d((r=t.CSS_CLASSES,r=null==r||r===!1?r:r.optionCombo,typeof r===c?r.apply(t):r))+" "+d((r=t.CSS_CLASSES,r=null==r||r===!1?r:r.sorter,typeof r===c?r.apply(t):r))+'">\r\n		<h2>Sort:</h2>\r\n		<ul class="'+d((r=t.CSS_CLASSES,r=null==r||r===!1?r:r.optionSet,typeof r===c?r.apply(t):r))+" "+d((r=t.CSS_CLASSES,r=null==r||r===!1?r:r.clearfix,typeof r===c?r.apply(t):r))+'" data-option-key="sortBy">\r\n			',l={hash:{},inverse:u.noop,fn:u.program(1,a,i),data:i},r=n.keysEach||t.keysEach,s=r?r.call(t,t.optionSet,l):h.call(t,"keysEach",t.optionSet,l),(s||0===s)&&(p+=s),p+="\r\n		</ul>\r\n	</div>"}),this.bSynopsis.templates.stdNode=Handlebars.template(function(e,t,n,o,i){function a(e,t){var o,i,a="";return a+='\r\n                    <div class="',i={hash:{},data:t},a+=f((o=n.toClass||e.toClass,o?o.call(e,e.type,i):y.call(e,"toClass",e.type,i)))+" ",i={hash:{},data:t},a+=f((o=n.toClass||e.toClass,o?o.call(e,e.id,i):y.call(e,"toClass",e.id,i)))+'">',i={hash:{},data:t},a+=f((o=n.tScaleWrap||e.tScaleWrap,o?o.call(e,(o=e.data,null==o||o===!1?o:o.value),i):y.call(e,"tScaleWrap",(o=e.data,null==o||o===!1?o:o.value),i)))+"</div>\r\n            "}function r(e,t){var o,i,a,r="";return r+="\r\n                ",a={hash:{},inverse:S.noop,fn:S.program(4,s,t),data:t},o=n.ifLang||e.ifLang,i=o?o.call(e,e,a):y.call(e,"ifLang",e,a),(i||0===i)&&(r+=i),r+="\r\n            "}function s(e,t){var o,i,a="";return a+='\r\n                        <div class="',i={hash:{},data:t},a+=f((o=n.toClass||e.toClass,o?o.call(e,e.type,i):y.call(e,"toClass",e.type,i)))+" ",i={hash:{},data:t},a+=f((o=n.toClass||e.toClass,o?o.call(e,e.id,i):y.call(e,"toClass",e.id,i)))+'">',i={hash:{},data:t},a+=f((o=n.tScaleWrap||e.tScaleWrap,o?o.call(e,(o=e.data,null==o||o===!1?o:o.value),i):y.call(e,"tScaleWrap",(o=e.data,null==o||o===!1?o:o.value),i)))+"</div>\r\n                "}function l(e,t,o){var i,a,r,s="";return s+='\r\n                    <div class="',r={hash:{},data:t},s+=f((i=n.toClass||e.toClass,i?i.call(e,e.id,r):y.call(e,"toClass",e.id,r)))+'">\r\n                        <img class="'+f((i=o.CSS_CLASSES,i=null==i||i===!1?i:i.tileClasses,i=null==i||i===!1?i:i.typeImage,typeof i===g?i.apply(e):i))+'" src="img/'+f((i=e.data,i=null==i||i===!1?i:i.type,typeof i===g?i.apply(e):i))+'.png">\r\n                        <div class="'+f((i=o.CSS_CLASSES,i=null==i||i===!1?i:i.tileClasses,i=null==i||i===!1?i:i.predicate,typeof i===g?i.apply(e):i))+'" style="visibility:hidden; overflow-y:auto; word-wrap:break-word">',r={hash:{},data:t},s+=f((i=n.tScaleWrap||e.tScaleWrap,i?i.call(e,(i=e.data,null==i||i===!1?i:i.value),r):y.call(e,"tScaleWrap",(i=e.data,null==i||i===!1?i:i.value),r)))+"</div>\r\n                        ",r={hash:{},inverse:S.noop,fn:S.programWithDepth(7,p,t,o),data:t},i=n.predicateLabelRetriver||e.predicateLabelRetriver,a=i?i.call(e,e.data,r):y.call(e,"predicateLabelRetriver",e.data,r),(a||0===a)&&(s+=a),s+="\r\n                    </div>\r\n            "}function p(e,t,o){var i,a,r="";return r+='\r\n                            <div class="'+f((i=o.CSS_CLASSES,i=null==i||i===!1?i:i.tileClasses,i=null==i||i===!1?i:i.predicateLabel,typeof i===g?i.apply(e):i))+'" style="overflow-y:auto; word-wrap:break-word">',a={hash:{},data:t},r+=f((i=n.tScaleWrap||e.tScaleWrap,i?i.call(e,(i=e.data,null==i||i===!1?i:i.label),a):y.call(e,"tScaleWrap",(i=e.data,null==i||i===!1?i:i.label),a)))+"</div>\r\n                        "}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var c,d,u,h="",y=n.helperMissing,f=this.escapeExpression,S=this,g="function";return h+="            ",u={hash:{},inverse:S.noop,fn:S.program(1,a,i),data:i},c=n.compsEach||t.compsEach,d=c?c.call(t,t.node,"label",u):y.call(t,"compsEach",t.node,"label",u),(d||0===d)&&(h+=d),h+="\r\n            ",u={hash:{},inverse:S.noop,fn:S.program(3,r,i),data:i},c=n.compsEach||t.compsEach,d=c?c.call(t,t.node,"description",u):y.call(t,"compsEach",t.node,"description",u),(d||0===d)&&(h+=d),h+="\r\n            ",u={hash:{},inverse:S.noop,fn:S.programWithDepth(6,l,i,t),data:i},c=n.compsEach||t.compsEach,d=c?c.call(t,t.node,"predicate",u):y.call(t,"compsEach",t.node,"predicate",u),(d||0===d)&&(h+=d),h}),this.bSynopsis.templates.tileWrapper=Handlebars.template(function(e,t,n,o,i){function a(e){return h(typeof e===u?e.apply(e):e)}function r(e,t){var o,i;return i={hash:{},data:t},h((o=n.toClass||e.toClass,o?o.call(e,(o=e.node,null==o||o===!1?o:o.token),i):y.call(e,"toClass",(o=e.node,null==o||o===!1?o:o.token),i)))}function s(e,t){var o,i,a="";return a+='\r\n			<h2 class="'+h((o=e.CSS_CLASSES,o=null==o||o===!1?o:o.tileClasses,o=null==o||o===!1?o:o.showURI,typeof o===u?o.apply(e):o))+'" style="display:none">',(i=n.data)?i=i.call(e,{hash:{},data:t}):(i=e.data,i=typeof i===u?i.apply(e):i),a+=h(i)+"</h2>\r\n		"}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var l,p,c,d="",u="function",h=this.escapeExpression,y=n.helperMissing,f=this;return d+='	<div class="'+h((l=t.CSS_CLASSES,l=null==l||l===!1?l:l.tileClasses,l=null==l||l===!1?l:l.tile,typeof l===u?l.apply(t):l))+" ",p=n.each.call(t,(l=t.node,null==l||l===!1?l:l.filterables),{hash:{},inverse:f.noop,fn:f.program(1,a,i),data:i}),(p||0===p)&&(d+=p),p=n["if"].call(t,(l=t.node,null==l||l===!1?l:l.token),{hash:{},inverse:f.noop,fn:f.program(3,r,i),data:i}),(p||0===p)&&(d+=p),d+=" ",c={hash:{},data:i},d+=h((l=n.toClass||t.toClass,l?l.call(t,(l=t.node,null==l||l===!1?l:l.id),c):y.call(t,"toClass",(l=t.node,null==l||l===!1?l:l.id),c)))+'">\r\n		',c={hash:{},inverse:f.noop,fn:f.program(5,s,i),data:i},l=n.firstComp||t.firstComp,p=l?l.call(t,t.node,"uri",c):y.call(t,"firstComp",t.node,"uri",c),(p||0===p)&&(d+=p),d+='\r\n		<p class="'+h((l=t.CSS_CLASSES,l=null==l||l===!1?l:l.tileClasses,l=null==l||l===!1?l:l.number,typeof l===u?l.apply(t):l))+'" style="display:none">'+h((l=t.node,l=null==l||l===!1?l:l.index,typeof l===u?l.apply(t):l))+"</p>\r\n	</div>"}),this.bSynopsis.templates.timelineItem=Handlebars.template(function(e,t,n,o,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var a,r="",s="function",l=this.escapeExpression;return r+="<li>\r\n    ",(a=n.label)?a=a.call(t,{hash:{},data:i}):(a=t.label,a=typeof a===s?a.apply(t):a),r+=l(a)+"\r\n</li>"}),this.bSynopsis.templates.timelineWrapper=Handlebars.template(function(e,t,n,o,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var a,r="",s="function",l=this.escapeExpression;return r+='<div class="'+l((a=t.CSS_CLASSES,a=null==a||a===!1?a:a.timelineContainer,typeof a===s?a.apply(t):a))+'">\r\n    <ul class="'+l((a=t.CSS_CLASSES,a=null==a||a===!1?a:a.timeline,typeof a===s?a.apply(t):a))+'">\r\n    </ul>\r\n</div>'});