/*! bSynopsis 2014-07-03 */
(function(e,t,n,o){function i(t,n){e.each(n,function(e,o){"string"==typeof o?n[e]=t+o:i(t,o)})}function a(e){return e===o||null===e}function r(e){return e&&(e.CSS_CLASSES?console.log(f.MESSAGES.warn.cssAppend):e.CSS_CLASSES=f.CSS_CLASSES),e}function s(e,t){return e.replace(RegExp(f.DUMMY,"g"),t)}function l(t){var n=null,o=null;return t?e("BODY").hasClass("noscroll")?(n=y.width(),o=y.height()):(e("BODY").addClass("noscroll"),n=y.width(),o=y.height(),e("BODY").removeClass("noscroll")):(n=y.width(),o=y.height()),{width:n,height:o}}function p(e){var t;switch(e){case f.CSS_CLASSES.overlay:return t=l(!0),"rect(0px "+t.width+"px "+t.height+"px 0px)";case f.CSS_CLASSES.preview:return t=l(!1),"rect("+.25*t.height+"px "+.75*t.width+"px "+.75*t.height+"px "+.25*t.width+"px)";default:return console.log("No clip data found."),""}}function c(e){var t=y.scrollTop(),n=y.scrollLeft(),o=e.offset();return{left:o.left-n,top:o.top-t,width:e.outerWidth(),height:e.outerHeight()}}function d(){var e={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"};return e[Modernizr.prefixed("transition")]}function u(){return x++}function h(t,n){this._selfProxy=function(t){return e.proxy(t,this)},this.pluginID=u(),this._extendedLayers={},this._topLayer,this._$parent=e(t),this.$body=e("BODY"),T[this.pluginID]=new h.EventManager(this._$parent),this._$parent.addClass(_+"_"+this.pluginID),this._$parent.addClass(_),this.options=e.extend(!0,{},j,n),this._defaults=j,this._name=_,this._expandedOverlaysCount=0,this.init()}var y=e(t),f={FA_TAG:"synopsis_filter_",TOKEN_TAG:"synopsis_token_",NODE_TYPES:{stdNode:"stdNode",literal:"literal",blankNode:"blankNode",resNode:"resNode"},COMP_TYPES:{predicate:"predicate",label:"label",uri:"uri"},CSS_PREFIX:"synopsis_",CSS_CLASSES:{outerContainer:"outerContainer",viewContainer:"container",options:"options",optionCombo:"option-combo",optionSet:"option-set",optionButton:"option-button",groupLabel:"groupLabel",filter:"filter",clearfix:"clearfix",loader:"loading",preview:"preview",previewItem:"preview-item",previewContent:"previewContent",overlay:"overlay",overlayContent:"overlayContent",refresh:"refresh",innerScroll:"innerScroll",innerNoScroll:"innerNoScroll",buttonClose:"close",timelineContainer:"timelineContainer",timeline:"timeline",buttonTimeline:"btnTimeline",sorter:"sorter",textScale:"textScale",textScaleDone:"textScaleDone",tileClasses:{tile:"tile",content:"tileContent",label:"label",showURI:"showURI",predicate:"predicate",predicateLabel:"predicateLabel",typeImage:"typeImage",number:"number"},typeClasses:{incoming:"incoming",outgoing:"outgoing"},patternClasses:{uri:"uri",literal:"literal",blanknode:"blank"}},DUMMY:"#replaceMe#",EVENT_TYPES:{store:{insert:"dataInsert"},loading:{done:"loadingDone",start:"loadingStarted"},layout:{done:"layoutingDone"}},MESSAGES:{out:{selectAllFilters:"Select All"},error:{ajax:"Error on loading data.",remote:"Error on loading remote data.",template:"Error on loading template data.",tokenType:"Unknown token type of item.",compType:"Unknown component type of item."},warn:{cssAppend:"CSS classes already defined",fileTypeNotKnown:"Couldn't get filetype. Using: ",filterInput:"Filterinput is empty",filterName:"Filtername duplicate found"}}},S={toClass:function(e){return f.CSS_PREFIX+e},toToken:function(e){return f.TOKEN_TAG+e},toFilterable:function(e){return f.FA_TAG+e},toClassSelector:function(e){return"."+f.CSS_PREFIX+e},toSelector:function(e){return"."+e}};i(f.CSS_PREFIX,f.CSS_CLASSES),e.expr[":"]["class-prefix"]=function(t,n,o){var i=o[3];if(i){var a='[class^="'+i+'"], [class*=" '+i+'"]';return e(t).is(a)}return!0},e.expr[":"].regex=function(e,t,n){var o,i=n[3].split(","),a=/^(data|css):/,r={method:i[0].match(a)?i[0].split(":")[0]:"attr",property:i.shift().replace(a,"")},s="ig";try{o=RegExp(i.join("").replace(/^\s+|\s+$/g,""),s)}catch(l){return!1}return o.test(jQuery(e)[r.method](r.property))},function(e){e.fn.textfill=function(t,n,o){return t=parseInt(t,10),n=parseInt(n,10),this.each(function(){var i=e("span",this),a=i.parent(),r=a.height(),s=a.width(),l=parseInt(i.css("fontSize"),10),p=s/i.width(),c=r/i.height(),d=c>p?p:c,u=l*(d-.1);t>0&&u>t&&(u=t),n>0&&n>u&&(u=n,o(a)),i.css("fontSize",u)})}}(jQuery);var v=console.log.bind(console),m=function(){var n=0;this._requestSPARQLCrossDomain=function(i,a,r){var s=!1,l=n++;t["cbFunc"+l]=function(e){e&&e.query&&e.query.results?(s=!0,r(e.query.results.sparql.result,s)):(console.log("Nothing returned from getJSON."),r(null,s),t["cbFunc"+l]=o)},i||alert("No query was passed.");var p="http://query.yahooapis.com/v1/public/yql?q="+encodeURIComponent('use "http://triplr.org/sparyql/sparql.xml" as sparql; select * from sparql where query="'+i+'" and service="'+a)+'"&format=json';e.ajax({dataType:"json",url:p,success:t["cbFunc"+l],error:function(e,n,o){console.log("Error on yql query."),console.log(o),t["cbFunc"+l]()}})}};m.prototype.executeQuery=function(e,t,n){this._requestSPARQLCrossDomain(e,t,n)};var g=function(){this.values={}};g.prototype.add=function(e,t){this.values[e]=t},g.prototype.retrieve=function(e){return this.values[e]},g.prototype.contains=function(e){return e in this.values};var C,b,L,E=e.Deferred(),_="bSynopsis",T=[],w=new g,O=d(),I=Modernizr.csstransitions,N={rdf:"http://www.w3.org/1999/02/22-rdf-syntax-ns#",rdfs:"http://www.w3.org/2000/01/rdf-schema#",owl:"http://www.w3.org/2002/07/owl#",rif:"http://www.w3.org/2007/rif#",foaf:"http://xmlns.com/foaf/0.1/",dbpedia:"http://dbpedia.org/resource/","dbpedia-owl":"http://dbpedia.org/ontology/",dbpprop:"http://dbpedia.org/property/",geo:"http://www.w3.org/2003/01/geo/wgs84_pos#",dc:"http://purl.org/dc/terms/"},A={},x=0,D=0,k=0,R=2,F=0;h.Event=function(e){this._sender=e,this._listeners={},this._oneTimeListeners={}},h.Event.prototype={attach:function(e){this._listeners[e.id]=e},once:function(e){this._oneTimeListeners[e.id]=e},dettach:function(e){delete this._listeners[e.id]},notify:function(t){var n=this._sender,o=this;e.each(this._listeners,function(e,o){o.fn(n,t)}),e.each(this._oneTimeListeners,function(e,i){i.fn(n,t),delete o._oneTimeListeners[e]})}},h.Switch=function(e){this._sender=e,this._listeners={},this._triggered=!1},h.Switch.prototype={attach:function(e){this._triggered?e.fn(this._sender,this._args):this._listeners[e.id]=e},trigger:function(t){this._triggered=!0,this._args=t;var n=this;e.each(this._listeners,function(e,o){o.fn(n._sender,t),delete n._listeners[e]})}},h.Listener=function(e){this.id="listener"+F++,this.fn=e},h.EventManager=function(e){return e?(this.stdObject=e,this._evHandlerHistory={},o):(v("EventManager not created"),!1)},h.EventManager.prototype.addEventHandler=function(e,t,n,i){var a=this;n===o&&(n=a.stdObject),a._evHandlerHistory[e]===o&&(a._evHandlerHistory[e]=[]),a._evHandlerHistory[e].push({id:i,object:n,handler:t}),n.on(e,t)},h.EventManager.prototype.removeEventHandler=function(t,n,i){var a=this;e.each(a._evHandlerHistory[t],function(a,r){if(n===r.id)if(i!==o){if(e.data(r.object)===e.data(i))return r.object.off(t,r.handler),!1}else r.object.off(t,r.handler)})},h.EventManager.prototype.trigger=function(e,t,n){n?n.trigger(e,t):this.stdObject.trigger(e,t)},h.EventManager.prototype.destroy=function(){e.each(this._evHandlerHistory,function(t,n){e.each(n,function(e,n){n.object.off(t,n.handler)})})},h.RdfStore=function(t,n){var o=this;this._store=null,this._queryPrefixes="",this._generateQueryPrefix=function(e,t){o._queryPrefixes+="PREFIX "+e+": <"+t+"> "},e.each(N,function(e,t){o._generateQueryPrefix(e,t)}),new rdfstore.Store(t,function(e){o._store=e,n()})},h.RdfStore.prototype.insertData=function(t,n,o){var i=this;if("text/turtle"===n||"text/plain"===n||"text/n3"===n){var r=t.match(/.*@prefix.*>(\s)*./g);r&&e.each(r,function(e,t){var n=t.split(/>(\s)*./)[0].split(/:(\s)*</),o=n[0].replace(/@prefix(\s)*/,""),r=n[2];a(N[o])&&(N[o]=r,i._generateQueryPrefix(o,r))})}else if("application/ld+json"===n||"application/json"===n){var s=t["@context"];s&&e.each(s,function(e,t){a(N[t])&&(N[e]=t,i._generateQueryPrefix(e,t))})}this._store.load(n,t,function(){o()})},h.RdfStore.prototype.executeQuery=function(e,t){this._store.execute(this._queryPrefixes+e,function(n,o){n?t(o,n):(v("Error on executing: "+e),t(null,n))})},h.LayoutEngine=function(e,t){var n=this;this._container=e,this._funcQueue=[],this._occupied=!1,this._internDoneEvent=new h.Event(this),this._internDoneEvent.attach(new h.Listener(function(){n._addNext()})),e.addClass("isotope"),e.css({overflow:"hidden"}),e.isotope(t),e.isotope("on","layoutComplete",function(){n._container.trigger(f.EVENT_TYPES.layout.done),n._internDoneEvent.notify()})},h.LayoutEngine.prototype._addNext=function(){this._funcQueue.length>0?setTimeout(this._funcQueue.shift(),100):(this._occupied=!1,v("unoccupy"))},h.LayoutEngine.prototype.add=function(e){var t=this,n=function(n){return function(){t._container.isotope("insert",e)}};e&&(this._occupied?this._funcQueue.push(n(e)):(this._occupied=!0,this._container.isotope("insert",e)))},h.LayoutEngine.prototype.reLayout=function(){this._container.isotope("reLayout")},h.LayoutEngine.prototype.remove=function(e,t){this._container.isotope("remove",e,t)},h.LayoutEngine.prototype.removeAll=function(){this._container.html("")},h.LayoutEngine.prototype.updateSortData=function(e){this._container.isotope("updateSortData",e)},h.LayoutEngine.prototype.updateOptions=function(e){this._container.isotope(e)},h.DataTransformer={res:function(e){return e},literal:function(){},blank:function(){}},h.Node=function(e,t){this.id=e.index,this.type=f.NODE_TYPES.stdNode,this.useTemplateID=this.type,this.filterables=[],this.components={},this.style=t,e.predicate&&(this.filterables.push(S.toFilterable(e.predicate.type)),e.predicate.value=decodeURIComponent(e.predicate.value),this.addComponent("predicate",e.predicate)),e.description&&(e.description.value=decodeURIComponent(e.description.value),this.addComponent("description",e.description))},h.Node.prototype.addComponent=function(e,t,n){this.components[e]||(this.components[e]=[]);var o=e+this.components[e].length;this.components[e].push(h.ComponentFactory.makeComp(o,e,t,n))},h.Node.prototype.getFComponentOT=function(e){return this.components[e]?this.components[e][0]:!1},h.Node.prototype.hasComponentType=function(e){return this.components.hasOwnProperty(e)},h.Node.prototype.forEachComponentType=function(e,t){if(this.components[e])for(var n=0;this.components[e].length>n;n++)t(this.components[e][n])},h.Node.prototype.getType=function(){return this.type},h.Node.prototype.getTemplateIdentifier=function(){return this.useTemplateID},h.Node.prototype.setPredicateLabel=function(e,t){this.components.predicate[e].label=t},h.Node.prototype.generateTile=function(){var t=e(A.tileWrapper(r({node:this}))).append(e(A[this.useTemplateID](r({node:this}))));return t.data("node",this),t},h.Node.prototype.merge=function(t){var n=this,o=!1;return e.each(t.components,function(t,i){e.each(i,function(e,i){var a=!0;if(n.components[t])for(var r=0;n.components[t].length>r;r++)if(i.equals(n.components[t][r])){a=!1;break}a&&(n.addComponent(t,i.data),o=!0)})}),o},h.Node.Component=function(e,t,n,o){this.id=e,this.type=t,this.data=n,this.style=o},h.ComponentFactory={makeComp:function(e,t,n,o){var i;switch(i=o?new h.Node.Component(e,t,n,o):new h.Node.Component(e,t,n),t){case f.COMP_TYPES.predicate:i.equals=function(e){return this.type===e.type&&this.data.value===e.data.value};break;case f.COMP_TYPES.label:i.equals=function(e){return this.type===e.type&&this.data.value===e.data.value};break;case f.COMP_TYPES.uri:i.equals=function(e){return this.type===e.type&&this.data===e.data};break;default:i.equals=function(e){return this.type===e.type&&this.data.value===e.data.value},console.log(f.MESSAGES.error.compType+t)}return i}},h.Nodes={},h.Nodes.Res=function(e){h.Node.call(this,e);var t=this,n=function(){var e=t.components.uri[0].data;return t.forEachComponentType("predicate",function(t){e+="_"+t.data.value}),e};this.type=f.NODE_TYPES.resNode,this.addComponent("uri",e.subject.value,{display:"none"}),a(e.label)?this.addComponent("label",{value:decodeURIComponent(this.uri)}):(e.label.value=decodeURIComponent(e.label.value),this.addComponent("label",e.label)),this.id=n()},h.Nodes.Res.prototype=Object.create(h.Node.prototype),h.Nodes.Res.prototype.constructor=h.Nodes.Res,h.Nodes.Res.prototype.generateTile=function(){var e=h.Node.prototype.generateTile.call(this);return e},h.Nodes.Literal=function(e){var t=this;h.Node.call(this,e);var n=function(){var e=t.getFComponentOT("label").data.value;return t.forEachComponentType("predicate",function(t){e+="_"+t.data.value}),e};this.type=f.NODE_TYPES.literal,e.subject.value=decodeURIComponent(e.subject.value),this.addComponent("label",e.subject),this.id=n()},h.Nodes.Literal.prototype=Object.create(h.Node.prototype),h.Nodes.Literal.prototype.constructor=h.Nodes.Literal,h.Nodes.Literal.prototype.generateTile=function(){var e=h.Node.prototype.generateTile.call(this);return e},h.Nodes.Blank=function(e){h.Node.call(this,e);var t=function(){return"_"+Math.random().toString(36).substr(2,9)};this.type=f.NODE_TYPES.blankNode,this.addComponent("label",{value:"BlankNode - TODO"}),this.id=t()},h.Nodes.Blank.prototype=Object.create(h.Node.prototype),h.Nodes.Blank.prototype.constructor=h.Nodes.Blank,h.Nodes.Blank.prototype.generateTile=function(){var e=h.Node.prototype.generateTile.call(this);return e},h.NodeFactory={makeNode:function(e,t){var n;switch(e.subject.token){case S.toToken(f.CSS_CLASSES.patternClasses.blanknode):n=new h.Nodes.Blank(e);break;case S.toToken(f.CSS_CLASSES.patternClasses.literal):n=new h.Nodes.Literal(e,t.literalStyle);break;case S.toToken(f.CSS_CLASSES.patternClasses.uri):!e.label||e.label.lang!==o&&"en"!==e.label.lang||(n=new h.Nodes.Res(e,t.itemStyle));break;default:console.log(f.MESSAGES.error.tokenType+e.subject.token)}return n}},h.TimeLine=function(t){this._$timelineContainer=e('<div class="'+f.CSS_CLASSES.timelineContainer+'">'),t.prepend(this._$timelineContainer),this._$timeline=e('<ul class="'+f.CSS_CLASSES.timeline+'"></ul>'),this._$timelineContainer.append(this._$timeline),this.timeLineNodes=[]},h.TimeLine.prototype.open=function(){this._$timelineContainer.data("isExpanded")?(this._$timelineContainer.data("isExpanded",!1),this._$timelineContainer.css({opacity:0,zIndex:-1})):(this._$timelineContainer.data("isExpanded",!0),this._$timelineContainer.css({"background-color":"grey",opacity:1,zIndex:R++}))},h.TimeLine.prototype.close=function(){this._$timelineContainer.data("isExpanded",!1),this._$timelineContainer.css({opacity:0,zIndex:-1})},h.TimeLine.prototype.addLayer=function(e){this.addNode(new h.TimeLine.Node(e))},h.TimeLine.prototype.addNode=function(e){var t=this;this.timeLineNodes.push(e),this._$timeline.prepend(e.getJQueryObj()),e.clickEvent.attach(new h.Listener(function(){t.close()}))},h.TimeLine.Node=function(t){var n=this;this.clickEvent=new h.Event(this),this.layer=t,this.$timelineNode=e(A.timelineItem({label:t.node&&t.node.hasComponentType("label")?t.node.getFComponentOT("label").data.value:t.id})),t.$tile&&this.$timelineNode.css({"background-color":t.$tile.css("background-color")}),this.$timelineNode.click(function(){n.clickEvent.notify(),n.layer.open(),n.layer.update()})},h.TimeLine.Node.prototype.getJQueryObj=function(){return this.$timelineNode},h.Layer=function(t,n,o){var i=this;this.initSwitch=new h.Switch(this),this.openEvent=new h.Event(this),this.closeEvent=new h.Event(this),this.filterEvent=new h.Event(this),this.id="layer"+D++,this.initDfd=e.Deferred(),this.$parent=t,this.options=n,e.when(i._addOverlay()).done(function(){e.when(i._addOverlayContent()).done(function(){i._initLayerData(o)})})},h.Layer.prototype._initLayerData=function(t){var n=this;this.model=new h.Layer.Model(t,this.options.modelOptions,L.label),this.view=new h.Layer.View(this.model,this.$content,this.options.viewOptions),this.model.itemsAdded.attach(new h.Listener(function(e,t){n.view.addTiles(n.getTilesToPaint(t.addedNodes,n.options.nodeFilters,n.options.tileFilters))})),this.model.modelCleared.attach(new h.Listener(function(){v("Clearing view."),n.view.layoutEngine.remove(e(S.toSelector(f.CSS_CLASSES.tileClasses.tile)))})),(this.options.generateSortOptions||this.options.generateFilterOptions)&&(this.view.addOptionsBox(),this.options.generateSortOptions&&this.view.addSorter(),this.options.generateFilterOptions&&this.view.addIsotopeFilter()),this._addCloseOnClick(),this._addRefreshOnClick(),this._addBackgroundColor(),this._initContent(),this.initSwitch.trigger()},h.Layer.prototype._addBackgroundColor=function(){this.$overlay.css("background-color","grey")},h.Layer.prototype._addFilterSelection=function(){var e=this;this.$overlay.find("#filterSelect").multiSelect({selectAllText:f.MESSAGES.out.selectAllFilters},function(t){e.switchFilterState(t.val())})},h.Layer.prototype._addCloseOnClick=function(){var e=this,t=this.$overlay.find("> span"+S.toSelector(f.CSS_CLASSES.buttonClose));t.on("click",function(){e.close()})},h.Layer.prototype._addRefreshOnClick=function(){var e=this,t=this.$overlay.find(S.toSelector(f.CSS_CLASSES.refresh));t.on("click",function(){e.update()})},h.Layer.prototype.getTimeLineButton=function(){return this.$overlay.find(S.toSelector(f.CSS_CLASSES.buttonTimeline))},h.Layer.prototype._addOverlay=function(){var t=e.Deferred();return this.$overlay=e(A.overlayWrapper(r({id:this.id}))),this.$parent.append(this.$overlay),t.resolve(),t.promise()},h.Layer.prototype._addOverlayContent=function(){var t=e.Deferred();return this.$content=e("<div></div>"),this.$overlay.append(this.$content),t.resolve(),t.promise()},h.Layer.prototype._initContent=function(){this.options.remoteOptions.remoteDynamically?(this.options.remoteOptions.waitForRemote||this.update(),this.loadByRemote?this.loadByRemote():v("LoadByRemote currently not defined")):this.update()},h.Layer.prototype.getJQueryObj=function(){return this.$overlay},h.Layer.prototype.removeHtml=function(){return this.$overlay.remove()},h.Layer.prototype.update=function(){v("Layer "+this.id+" is updating."),v("Caller is "+(""+arguments.callee.caller)),this.model.update()},h.Layer.prototype.open=function(){this.$overlay.data("isExpanded",!0),this.show()},h.Layer.prototype.show=function(){this.zIndex=R++,this.$overlay.css({clip:p(f.CSS_CLASSES.overlay),opacity:1,zIndex:this.zIndex,pointerEvents:"auto"}),this.openEvent.notify()},h.Layer.prototype.close=function(){this.$overlay.data("isExpanded",!1),this.closeEvent.notify(),this.hide()},h.Layer.prototype.hide=function(){this.$overlay.css({opacity:0,zIndex:-1})},h.Layer.prototype.removeAllItems=function(){this.model.clearModel()},h.Layer.prototype.getTilesToPaint=function(e,t,n){return this.runTileFilters(this.generateTiles(this.runNodeFilters(e,t)),n)},h.Layer.prototype.runNodeFilters=function(t,n){var o=this;filters=n?n:this.options.nodeFilters;var i=(new Date).getTime();return e.each(filters,function(n,a){e.isEmptyObject(t)?console.log(f.MESSAGES.warn.filterInput):t=a.fn(t,a.config,o),v("Filter "+n+" done at: "+((new Date).getTime()-i)+" milisec")}),t},h.Layer.prototype.generateTiles=function(t){var n=e("<div>");return e.each(t,function(t,o){n.append(e(o.generateTile()))}),n},h.Layer.prototype.runTileFilters=function(t,n){var o=this,i=(new Date).getTime();return filters=n?n:this.options.tileFilters,t=t.children(),v("Start tile filters at: "+((new Date).getTime()-i)+" milisec"),e.each(filters,function(e,n){t=n.fn(t,n.config,o),v("Filter "+e+" done at: "+((new Date).getTime()-i)+" milisec")}),t},h.Layer.Model=function(t,n,o){var i=this;this.viewQueries=t,this.labelQuery=o,this.options=n,this._nodes={},this.nodesLength=0,this.itemsAdded=new h.Event(this),this.modelCleared=new h.Event(this),this.itemUpdated=new h.Event(this),this._checkItemsHelp=function(e,t){var n=e.slice(t);n.length>0&&i.checkItems(n)},this._fetchPredicateLabel=function(t){if(t.hasComponentType("predicate"))for(var n=0;t.components.predicate.length>n;n++){var o=t.components.predicate[n];if(w.contains(o.value))t.setPredicateLabel(n,w.retrieve(o.value));else{var a=s(i.labelQuery,o.value);C.executeQuery(a,function(n){n&&n[0]&&e.each(n,function(e,n){t.setPredicateLabel(e,n.label.value),w.add(o.value,n.label.value)})})}}return t}},h.Layer.Model.prototype.getNodes=function(){return this._nodes},h.Layer.Model.prototype.checkItems=function(t){var n=t.length,i=this,a=i.options.batchSize>n?n:i.options.batchSize,r=t.slice(0,a),s={};e.each(r,function(e,t){t.subject.token=S.toToken(S.toClass(t.subject.token)),t.index=i.nodesLength+1;var n=h.NodeFactory.makeNode(t,i.options);if(n){switch(n.getType()){case f.NODE_TYPES.resNode:n.id in i._nodes?(v("resNodeUpdate, fix me"),i._nodes[n.id].merge(n)?(n=i._nodes[n.id],i.itemUpdated.notify(n)):n=o):(i._nodes[n.id]=n,i.nodesLength++);break;case f.NODE_TYPES.literal:n.id in i._nodes?(v("literalupdate"),i._nodes[n.id].merge(n)?(n=i._nodes[n.id],i.itemUpdated.notify(n)):n=o):(i._nodes[n.id]=n,i.nodesLength++);break;case f.NODE_TYPES.blankNode:n.id in i._nodes?(v("blankNodeupdate"),n=o):(i._nodes[n.id]=n,i.nodesLength++)}n&&(n=i._fetchPredicateLabel(n),s[n.id]=n)}}),v(s),this.itemsAdded.notify({addedNodes:s,allNodes:this.getNodes()}),i._checkItemsHelp(t,a)},h.Layer.Model.prototype.update=function(){v("START");var e=this;this.allResults=[];for(var t=0;this.viewQueries.length>t;t++)v(this.viewQueries[t].query),C.executeQuery(this.viewQueries[t].query,function(n){if(v(n),n&&0!==n.length)for(var o=0;n.length>o;o++)e.viewQueries[t].type&&(n[o].predicate.type=e.viewQueries[t].type),e.allResults.push(n[o])});this.allResults.length>0?e.checkItems(this.allResults):v("Nothing to add to View")},h.Layer.Model.prototype.clearModel=function(){this._nodes={},this.modelCleared.notify()},h.Layer.View=function(t,n,o){this.id="view"+k++,this.options=o,this._model=t,this.$outerContainer=e('<div class="'+f.CSS_CLASSES.outerContainer+'"></div>'),this.$outerContainer.css({"border-radius":"18px",padding:"5px 5px 5px 5px"}),this.$viewContainer=e('<div class="'+f.CSS_CLASSES.viewContainer+'"></div>'),n.append(this.$outerContainer),this.$outerContainer.append(this.$viewContainer),this.$viewContainer.css("width","100%"),this.layoutEngine=new h.LayoutEngine(this.$viewContainer,o.layoutEngine),this._getCorrespondingTile=function(e){var t=this.$viewContainer.find(S.toClassSelector(e.id));return v("CorrespondingTile"),v(t),t}},h.Layer.View.prototype.clearView=function(e){this.layoutEngine.removeAll(e)},h.Layer.View.prototype.removeTiles=function(t){var n=this;e.each(t,function(t,o){var i=e(o);n.layoutEngine.remove(i)})},h.Layer.View.prototype.addTiles=function(e){this.layoutEngine.add(e)},h.Layer.View.prototype.addOptionsBox=function(){this.$optionsContainer=e('<section class="'+f.CSS_CLASSES.options+'" class="'+f.CSS_CLASSES.clearfix+'"></section>'),this.$outerContainer.prepend(this.$optionsContainer)},h.Layer.View.prototype.addSorter=function(){var t=this,n=e.extend({},this.options.layoutEngine.getSortData);delete n.group;var o=A.sortOptions(r({optionSet:n}));this.$optionsContainer.prepend(o);var i=this.$optionsContainer.find(" > "+S.toSelector(f.CSS_CLASSES.sorter));i.find("."+this.options.layoutEngine.sortBy).addClass("selected");var a=this.$optionsContainer.find("a");a.click(function(){var n=e(this).attr("data-sort-value");return t.$optionsContainer.find(S.toSelector(f.CSS_CLASSES.sorter)+" > > > .selected").removeClass("selected"),e(this).addClass("selected"),t.layoutEngine.updateOptions({layoutMode:"masonry",sortBy:n}),!1})},h.Layer.View.prototype.addIsotopeFilter=function(){var t=this,n=A.filterOptions(r({filterOptions:t.options.filterBy}));this.$optionsContainer.append(n);var o=this.$optionsContainer.find(" > "+S.toSelector(f.CSS_CLASSES.filter)),i=o.find("a");i.click(function(){var n=e(this).attr("data-filter-value");return"*"!==n&&(n="."+f.FA_TAG+n),t.$outerContainer.find(S.toSelector(f.CSS_CLASSES.filter)+" > > > .selected").removeClass("selected"),e(this).addClass("selected"),t.layoutEngine.updateOptions({filter:n}),!1}),o.append('<input id="filterField" type="text" size="25" value="Enter search here.">');var a=o.find("#filterField");a.keyup(function(n){if(13==n.keyCode){var o=e(this).val();if(""!==o){if("*"!==o)if(t.options.supportRegExpFilter)try{o="div:regex(class, "+o+"), div > div:contains("+o+")"}catch(n){o="div > div:contains("+o+")"}else o="div > div:contains("+o+")"}else o="*";t.$outerContainer.find(S.toSelector(f.CSS_CLASSES.filter)+" > > > .selected").removeClass("selected"),t.layoutEngine.updateOptions({filter:o})}})},h.Layers={},h.Layers.Res=function(e,t,n){this.$tile=n,this.node=n.data("node");var o=[],i=s(L.selectSubjectOf,this.node.getFComponentOT("uri").data),a=s(L.selectObjectOf,this.node.getFComponentOT("uri").data);o.push({query:i,type:f.CSS_CLASSES.typeClasses.outgoing}),o.push({query:a,type:f.CSS_CLASSES.typeClasses.incoming}),h.Layer.call(this,e,t,o)},h.Layers.Res.prototype=Object.create(h.Layer.prototype),h.Layers.Res.prototype.constructor=h.Layers.Res,h.Layers.Res.prototype._addOverlayContent=function(){var t=e.Deferred(),n=this.$overlay.find(S.toSelector(f.CSS_CLASSES.overlayContent));return n.append(e(A.overlayContent(r({node:this.node})))),this.$content=n.find(S.toSelector(f.CSS_CLASSES.innerScroll)),this.$content.css("width",y.width()-parseInt(this.$overlay.css("padding-left"))-parseInt(this.$overlay.css("padding-right"))+"px"),this.$content.css("height",y.height()-this.$overlay.find(S.toSelector(f.CSS_CLASSES.innerNoScroll)).height()+"px"),t.resolve(),t.promise()},h.Layers.Res.prototype._addBackgroundColor=function(){var t=new RGBColor(this.$tile.css("background-color"));this.$overlay.css("background-color",t.toRGB()),e.each(this.$content.children("div"+S.toSelector("innerScroll")),function(n,o){t.r-=10,t.b-=10,t.g-=10,e(o).css("background",t.toRGB())})},h.Layers.Res.prototype.loadByRemote=function(){var e=this,t=e.$overlay.find(S.toSelector(f.CSS_CLASSES.innerNoScroll));t.css({"background-image":"url('img/loader.gif')","background-repeat":"no-repeat","background-position":"center"});var n=s(L.remoteSubjectOf,e.node.getFComponentOT("uri").data),o=s(L.remoteObjectOf,e.node.getFComponentOT("uri").data);b.insertByQuery(n+" LIMIT "+e.options.remoteOptions.remoteLimit),b.insertByQuery(o+" LIMIT "+e.options.remoteOptions.remoteLimit);var i=0;b.loadingDone.attach(new h.Listener(function(){i++,v("remoteDoneCount "+i),2===i&&(e.update(),t.css({"background-image":""}),b.loadingDone.dettach(this))}))},h.Layers.Res.prototype.show=function(){var e=this;this.zIndex=R++;var t=p(f.CSS_CLASSES.preview),n=p(f.CSS_CLASSES.overlay);this.$overlay.css({clip:I?t:n,opacity:1,zIndex:this.zIndex,pointerEvents:"auto"}),I?e.$overlay.on(O,function(){e.$overlay.off(O),setTimeout(function(){e.$overlay.css("clip",n).on(O,function(){e.$overlay.off(O),e.openEvent.notify()})},25)}):e.openEvent.notify()},h.Layers.Res.prototype.hide=function(){var e=this,t=c(this.$tile),n="rect("+t.top+"px "+(t.left+t.width)+"px "+(t.top+t.height)+"px "+t.left+"px)";this.$overlay.css({clip:n,opacity:1,pointerEvents:"none"}),I?e.$overlay.on(O,function(){e.$overlay.off(O),setTimeout(function(){e.$overlay.css("opacity",0).on(O,function(){e.$overlay.off(O).css({clip:"auto",zIndex:-1}),e.$tile.data("isExpanded",!1)})},25)}):(e.$overlay.css({opacity:0,zIndex:-1}),e.$tile.data("isExpanded",!1))},h.Layers.Literal=function(e,t,n){this.$tile=n,this.node=n.data("node");var o=[],i=s(L.literalIsObjectOf,this.node.getFComponentOT("label").data.value);o.push({query:i,type:f.CSS_CLASSES.typeClasses.incoming}),h.Layer.call(this,e,t,o)},h.Layers.Literal.prototype=Object.create(h.Layer.prototype),h.Layers.Literal.prototype.constructor=h.Layers.Literal,h.Layers.Literal.prototype._addOverlayContent=function(){return h.Layers.Res.prototype._addOverlayContent.call(this)},h.Layers.Literal.prototype._addBackgroundColor=function(){h.Layers.Res.prototype._addBackgroundColor.call(this)},h.Layers.Literal.prototype.loadByRemote=function(){var e=this,t=s(L.remoteLiteralIsObjectOf,e.node.getFComponentOT("value"));b.insertByQuery(t+" LIMIT "+e.options.remoteOptions.remoteLimit)},h.Layers.Blank=function(){},h.Layers.Blank.prototype=Object.create(h.Layer.prototype),h.Layers.Blank.prototype.constructor=h.Layers.Blank,h.Layers.Inlay=function(e,t,n){h.Layer.call(this,e,t,n)},h.Layers.Inlay.prototype=Object.create(h.Layer.prototype),h.Layers.Inlay.prototype.constructor=h.Layers.Blank,h.Layers.Inlay.prototype._addOverlay=function(){var t=e.Deferred();return this.$overlay=this.$parent,t.resolve(),t.promise()},h.Layers.Inlay.prototype._addBackgroundColor=function(){},h.Layers.Inlay.prototype._addOverlayContent=function(){var t=e.Deferred();return this.$content=this.$overlay,t.resolve(),t.promise()},h.Layers.Inlay.prototype.show=function(){this.$overlay.css({position:"static",opacity:1,pointerEvents:"auto"})},h.Layers.Inlay.prototype.hide=function(){this.$overlay.css({opacity:0})},h.TemplatesLoader=function(e){this._templateInitDfd=e,this._neededTemps=["filterOptions","sortOptions","tileWrapper","stdNode","groupDropDown","overlayContent","overlayWrapper","previewItem","timelineWrapper","timelineItem"],this._methodsAreLoaded=function(){for(var e=0;arguments[0[e++]]!==o;)if("function"!=typeof A[arguments[e]])return!1;return!0}},h.TemplatesLoader.prototype._isLoaded=function(){return this._methodsAreLoaded(this._neededTemps)?(this._templateInitDfd.resolve(),!0):(console.log(f.MESSAGES.error.template),this._templateInitDfd.reject(),!1)},h.TemplatesLoader.prototype.extractByFile=function(t){var n=this;e.get(t,function(t){var o=e("<div>");o.append(t),o.children().each(function(t,n){var o=-1!==n.id.indexOf("par_");o&&(n.id=n.id.slice(4)),A[n.id]=Handlebars.compile(e(n).html()),o&&Handlebars.registerPartial(n.id,e(n).html())}),n._isLoaded()},"html")},h.TemplatesLoader.prototype.getPrecompiledTemplates=function(){return A=t[_].templates,this._isLoaded()},h.RemoteDataLoader=function(e){this.backends=e,this.remoteEngine=new m,this.loadingStarted=new h.Event(this),this.loadingDone=new h.Event(this)},h.RemoteDataLoader.prototype.addBackend=function(e){this.backends.find(e)||this.backends.push(e)},h.RemoteDataLoader.prototype.removeBackend=function(e){var t=this.backends.indexOf(e);t>-1&&this.backends.splice(t,1)},h.RemoteDataLoader.prototype.generateTypeInsertionQuery=function(t){var n="INSERT DATA {";return e.each(t,function(e,t){t.res&&t.type&&(n+="<"+t.res.value+"> a "+"<"+t.type.value+">.")}),n+="}"},h.RemoteDataLoader.prototype.generateInsertionQuery=function(t){var n="INSERT DATA {";return e.each(t,function(e,t){t.subject===o?v("Resultset disfigured."):n+="uri"===t.subject.type?"<"+t.subject.value+"> ":"<"+t.subject.value+"> ",n+="<"+t.predicate.value+"> ","uri"===t.object.type?n+="<"+t.object.value+">. ":"literal"===t.object.type&&(n+='"'+encodeURIComponent(t.object.value)+'". '),t.labelSub&&(n+="<"+t.subject.value+'> rdfs:label "'+encodeURIComponent(t.labelSub.value)+'". '),t.labelObj&&(n+="<"+t.object.value+'> rdfs:label "'+encodeURIComponent(t.labelObj.value)+'". '),t.labelPred&&w.add(encodeURIComponent(t.predicate.value),encodeURIComponent(t.labelPred.value))}),n+="}"},h.RemoteDataLoader.prototype._loadRemoteAndInsert=function(e,t,n,i){this.remoteEngine.executeQuery(e,t,function(e,t){e&&t?(e.subject!==o&&(e=[e]),C.executeQuery(n(e),function(){i&&i(t)})):i&&i(t)})},h.RemoteDataLoader.prototype.executeQuery=function(t,n,o){var i=this;this.loadingStarted.notify();var a=-1,r=[];e.each(n,function(e,n){a++,r[a]=!1,i._loadRemoteAndInsert(t,n,o,function(){r[a]=!0;for(var e=!0,n=0;r.length>n;n++)r[n]||(e=!1);e&&i.loadingDone.notify(t)})})},h.RemoteDataLoader.prototype.insertByQuery=function(e,t){t?this.executeQuery(e,t,this.generateInsertionQuery):this.executeQuery(e,this.backends,this.generateInsertionQuery)},h.RemoteDataLoader.prototype.insertTypesByQuery=function(e,t){t?this.executeQuery(e,t,this.generateTypeInsertionQuery):this.executeQuery(e,this.backends,this.generateTypeInsertionQuery)
};var j={pathToWorkers:"../../workers/",language:"en",data:o,dataLoc:o,dataFormat:o,templatesPrecompiled:!0,templatesPath:"templates_wrapped/templates.html",sparqlData:o,generateTimeline:!0,initQueries:[{query:"SELECT ?subject ?label ?description ?type WHERE { ?subject rdfs:label ?label . OPTIONAL { ?subject rdfs:description ?description } . OPTIONAL { ?subject rdfs:comment ?description }. OPTIONAL {?subject rdfs:type ?type}}"}],rdfstoreOptions:{persistence:!0,name:"",overwrite:!0,engine:"",engineData:{mongoDomain:"",mongoPort:"",mongoOptions:{}}},layerOptions:{nodeFilters:{blacklistPredURI:{fn:function(t,n){return e.each(t,function(o,i){i.hasComponentType("predicate")&&n&&e.each(n,function(e,n){for(var o=0;i.componentTypes.predicate>=o;o++){var a=RegExp(n).exec(i.components.predicate[o].value);null!==a&&delete t[o]}})}),t},config:[]},blacklistURI:{fn:function(t,n){return e.each(t,function(o,i){i.hasComponentType("uri")&&n&&e.each(n,function(e,n){var a=RegExp(n).exec(i.components.uri[0]);null!==a&&delete t[o]})}),t},config:[]},multiResNode:{fn:function(t){var n=[];return e.each(t,function(e,o){("resNode"===o.type||"multiResNode"===o.type)&&(o.components.uri[0].data in n?(n[o.components.uri[0].data].type="multiResNode",n[o.components.uri[0].data].merge(o),delete t[e]):n[o.components.uri[0].data]=o)}),t}},blankNode:{fn:function(t){return e.each(t,function(e,t){t.getType()==f.NODE_TYPES.blankNode&&v("TODO Blanknode")}),t},config:{}}},tileFilters:{scale:{fn:function(t,n){return e.each(t,function(t,o){var i,a=e(o),r=a.data("node");i=r.style?r.style:n.defaultStyles[r.getType()]?n.defaultStyles[r.getType()]:n.defaultStyles.stdNode,"number"!=typeof i.height?r.dynLayoutFn?r.dynLayoutFn(a,r,i,n):n.defaultDynLayoutFns[r.getType()]?n.defaultDynLayoutFns[r.getType()](a,r,i,n):n.defaultDynLayoutFns.stdNode(a,r,i,n):r.layoutFn?r.layoutFn(a,r,i,n):n.defaultLayoutFns[r.getType()]?n.defaultLayoutFns[r.getType()](a,r,i,n):n.defaultLayoutFns.stdNode(a,r,i,n)}),t},config:{multiplicator:1,defaultLayoutFns:{stdNode:function(t,n,o,i){var a=t.height()+o.topPadding,r=i.multiplicator;t.width(o.width*r);var s=o.height*r;t.height(s);var l=s-(o.topPadding+o.bottomPadding*r),p=0,c={};e.each(n.components,function(t,n){e.each(n,function(e,t){var n=t.id;c[n]=t.style?t.style:i.defaultContentStyles[t.type]?i.defaultContentStyles[t.type]:i.defaultContentStyles.stdComponent,!c[n]||c[n].display&&"none"==c[n].display||(p+=c[n].height)})}),e.each(n.components,function(r,s){e.each(s,function(e,r){var s=r.id;if(c[s]&&(!c[s].display||"none"!=c[s].display)){var d=c[s];a=r.layoutFn?r.layoutFn(t,n,o,r,d,i,a,l,p):i.defaultContentLayoutFns[r.type]?i.defaultContentLayoutFns[r.type](t,n,o,r,d,i,a,l,p):i.defaultContentLayoutFns.stdComponent(t,n,o,r,d,i,a,l,p)}})})}},defaultDynLayoutFns:{stdNode:function(t,n,o,i){var a=t.height(),r=i.multiplicator,s=a+o.topPadding*r;t.width(o.width*r),e.each(n.components,function(a,r){e.each(r,function(e,a){var r;r=a.style?a.style:i.defaultContentStyles[a.type]?i.defaultContentStyles[a.type]:i.defaultContentStyles.stdComponent,!r||r.display&&"none"==r.display||(s=a.dynLayoutFn?a.dynLayoutFn(t,n,o,a,r,i,s):i.defaultContentDynLayoutFns[a.type]?i.defaultContentDynLayoutFns[a.type](t,n,o,a,r,i,s):i.defaultContentDynLayoutFns.stdComponent(t,n,o,a,r,i,s))})}),t.height(s+o.bottomPadding*r-a)}},defaultContentLayoutFns:{predicate:function(e,t,n,o,i,a,r,s,l){var p=e.find(S.toClassSelector(o.id));v(S.toClassSelector(o.id)),console.log(p);var c=a.multiplicator,d=s*(i.height/l)-n.spacing*c,u=(n.width-n.leftPadding-n.rightPadding)*c;p.height(d),p.width(u),p.css("top",r),p.css("left",n.leftPadding),r+=d+n.spacing*c,p.children().height(d);var h=e.find(S.toSelector(f.CSS_CLASSES.tileClasses.typeImage)),y=e.find(S.toSelector(f.CSS_CLASSES.tileClasses.predicate)),m=e.find(S.toSelector(f.CSS_CLASSES.tileClasses.predicateLabel)),g=.2*u;return h.height("auto"),h.width(g),m.css("left",g),m.width(u-g),y.width(u),r},stdComponent:function(e,t,n,o,i,a,r,s,l){var p=e.find(S.toClassSelector(o.id)),c=a.multiplicator,d=s*(i.height/l)-n.spacing*c;return p.width((n.width-n.leftPadding-n.rightPadding)*c),p.height(d),p.css("top",r),p.css("left",n.leftPadding),r+=d+n.spacing*c}},defaultContentDynLayoutFns:{predicate:function(e,t,n,o,i,a,r){var s=e.find(S.toClassSelector(o.id)),l=a.multiplicator,p=i.height*l,c=(n.width-n.leftPadding-n.rightPadding)*l;s.height(p),s.width(c),s.css("top",r),s.css("left",n.leftPadding),r+=p+n.spacing*l,s.children().height(p);var d=e.find(S.toSelector(f.CSS_CLASSES.tileClasses.typeImage)),u=e.find(S.toSelector(f.CSS_CLASSES.tileClasses.predicate)),h=e.find(S.toSelector(f.CSS_CLASSES.tileClasses.predicateLabel)),y=.2*c;return d.height("auto"),d.width(y),h.css("left",y),h.width(c-y),u.width(c),r},stdComponent:function(e,t,n,o,i,a,r){var s=e.find(S.toClassSelector(o.id)),l=a.multiplicator;return s.width((n.width-n.leftPadding-n.rightPadding)*l),s.height(i.height*l),s.css("top",r),s.css("left",n.leftPadding),r+=(i.height+n.spacing)*l}},defaultStyles:{stdNode:{width:200,height:"dynamic",topPadding:10,leftPadding:10,rightPadding:10,bottomPadding:10,spacing:5}},defaultContentStyles:{predicate:{height:20},label:{height:60},stdComponent:{height:40}}}},textScale:{fn:function(e,t,n){return n.view.$viewContainer.on(f.EVENT_TYPES.layout.done,function(n){if(n){var o=(new Date).getTime(),i=e.find(S.toSelector(f.CSS_CLASSES.textScale));i.parent().textfill(t.maxFontPixels,t.minFontPixels,function(e){e.css({"overflow-y":"auto","word-wrap":"break-word"})}),i.removeClass(f.CSS_CLASSES.textScale),i.addClass(f.CSS_CLASSES.textScaleDone),v("Event textScaleEvent done after: "+((new Date).getTime()-o)+" milisec")}}),e},config:{maxFontPixels:80,minFontPixels:12}},backgroundColor:{fn:function(t,n){var o=0;return e.each(t,function(t,i){var a=e(i),r=a.data("node");if(r.getType()===f.NODE_TYPES.resNode||"multiResNode"===r.getType()){var l=r.getFComponentOT("uri").data,p="SELECT DISTINCT ?res ?type WHERE { VALUES ?res {<"+l+">} ?res a ?type}";b.insertTypesByQuery(p),b.loadingDone.attach(new h.Listener(function(){return function(t,n){if(n===p){b.loadingDone.dettach(this);var o=s(L.typeQuery,l);C.executeQuery(o,function(t){var n,o;e.each(t,function(e,t){var i=t.type.value;if(-1!==i.indexOf(N.rdfs)||-1!==i.indexOf(N.owl)){if(!n)if(o){var a=chroma.scale([o.hex(),"#"+md5(i).substring(0,6)]).mode("lab");o=chroma(a(.5).hex())}else o=chroma("#"+md5(i).substring(0,6))}else if(n){var a=chroma.scale([n.hex(),chroma("#"+md5(i).substring(0,6))]);n=chroma(a(.5).hex())}else n=chroma("#"+md5(i).substring(0,6))}),n?a.css("background-color",n):o&&a.css("background-color",o)})}}}(l)))}else{o++;var c,d;r.style&&r.style.bgColors?(c=r.style.bgColors,d=new RGBColor(c[o%c.length])):n.defaultStyles[r.getType()]&&(c=n.defaultStyles[r.getType()].bgColors,d=new RGBColor(c[o%c.length])),d&&a.css("background-color","rgba("+d.r+", "+d.g+", "+d.b+" ,1)")}}),t},config:{defaultStyles:{literal:{bgColors:["#555555"]},blankNode:{bgColors:["#999999"]}}}},backgroundImg:{fn:function(t,n){return e.each(t,function(t,o){var i=e(o),a=i.data("node"),r="";switch(a.getType()){case f.NODE_TYPES.resNode:r=a.getFComponentOT("uri").data;break;case f.NODE_TYPES.literal:r=a.getFComponentOT("label").data.value}var s=r.replace(">","").split(".");switch(r.replace("<",""),s[s.length-1]){case"png":case"jpeg":case"svg":case"jpg":if(r){var l=e('<img src="en.wikipedia.org/wiki/File:'+r+'">');l.load(function(){var e=l.width(),t=l.height(),o=e/t,a=i.width(),r=i.height(),s=a/r,p=0;s>o?(p=a/o,l.width(a/o),l.height(r)):(l.width(p),l.height(a*o)),l.css({left:(a-p)/2,opacity:n.opacity,position:"absolute"})}),i.prepend(l)}}}),t},config:{opacity:.5}},predicateLabel:{fn:function(t){return e.each(t,function(t,n){var o=e(n),i=o.find(S.toSelector(f.CSS_CLASSES.tileClasses.predicate)),a=o.find(S.toSelector(f.CSS_CLASSES.tileClasses.typeImage)),r=o.find(S.toSelector(f.CSS_CLASSES.tileClasses.predicateLabel));o.get()[0].addEventListener("contextmenu",function(e){return e.preventDefault(),"visible"!==i.css("visibility")?(i.css("visibility","visible"),a.css("visibility","hidden"),r.css("visibility","hidden")):(i.css("visibility","hidden"),a.css("visibility","visible"),r.css("visibility","visible")),!1},!1)}),t}},browsablity:{fn:function(t,n,o){return e.each(t,function(t,i){var a,r,s,l=e(i),p=l.data("node"),c=p.getType();p.browsablity?(p.browsablity.layerGenFn&&(a=p.browsablity.layerGenFn),p.browsablity.layerOptionsFn&&(r=p.browsablity.layerOptionsFn),p.browsablity.onInitFn&&(r=p.browsablity.onInitFn)):c in n.types&&(n.types[c].layerGenFn&&(a=n.types[c].layerGenFn),n.types[c].layerOptionsFn&&(r=n.types[c].layerOptionsFn),n.types[c].onInitFn&&(r=n.types[c].onInitFn)),a||(a=n.defaultFns.layerGenFn),r||(r=n.defaultFns.layerOptionsFn),s||(s=n.defaultFns.onInitFn),l.click(function(){return function(){l.data("isExpanded",!0);var e=a(p,l,o.$parent,r(o.options));e&&e.initSwitch.attach(new h.Listener(function(){return function(e){s(e,o)}}(s,o)))}(a,r,s,o)})}),t},config:{types:{blankNode:{layerGenFn:function(){}},stdNode:{layerGenFn:function(e,t,n,o){return new h.Layers.Res(n,o,t)}},literal:{layerGenFn:function(e,t,n,o){return new h.Layers.Literal(n,o,t)}}},defaultFns:{layerOptionsFn:function(t){return e.extend(!0,{},t,{layoutEngine:{itemSelector:S.toSelector(f.CSS_CLASSES.tileClasses.tile),getSortData:{type:function(e){var t=e.attr("class");return t},group:function(e){for(var t=e.attr("class"),n=RegExp("(s)*[a-zA-Z0-9]*"+f.TOKEN_TAG+"[a-zA-Z0-9]*(s)*","g"),o=t.match(n),i="",a=0;o.length>a;a++)i+=o[a]+" ";return i}}},viewOptions:{filterBy:[{value:"*",label:"showAll"},{value:f.CSS_CLASSES.typeClasses.incoming,label:"in"},{value:f.CSS_CLASSES.typeClasses.outgoing,label:"out"}]}})},layerGenFn:function(e,t,n,o){return new h.Layers.Res(n,o,t)},onInitFn:function(e,t){t.closeEvent.attach(new h.Listener(function(e){e.filterEvent.notify({action:"removeLayer"})})),t.filterEvent.notify({action:"addLayer",args:e})}}}},weight:{fn:function(t,n){return e.each(t,function(t,o){var i=e(o),a=i.data("node");a.weight=0,e.each(n,function(e,t){a.weight=t.fn(a,t.data)}),i.data("node",a)}),t},config:{uriRule:{fn:function(t,n){var o=t.getFComponentOT("uri").data,i=t.weight;return o&&e.each(n,function(e,t){-1!==o.indexOf(e)&&(i+=t*Math.random())}),i},data:{"http://www.w3.org/2000/01/rdf-schema#":-1,"http://www.w3.org/2002/07/owl#":-1}},predicateRule:{fn:function(e,t){var n=e.weight;return e.forEachComponentType("predicate",function(){n+=t.val*Math.random()}),n},data:{val:.5}},templateRule:{fn:function(t,n){var o=t.useTemplateID,i=t.weight;return o&&e.each(n,function(e,t){o===e&&(i+=t*(Math.random()+.1))}),i},data:{maps:2,cityChart:1}}}}},generateSortOptions:!0,usePreviews:!1,previewAsOverlay:!0,generateFilterOptions:!0,modelOptions:{batchSize:2e3},remoteOptions:{defaultInitRemoteQuery:"SELECT ?subject ?predicate ?object { VALUES ?subject { <http://dbpedia.org/resource/Berlin> <http://dbpedia.org/resource/Passau> <http://dbpedia.org/resource/Munich> <http://dbpedia.org/resource/Frankfurt> } VALUES ?predicate { rdfs:label } ?subject ?predicate ?object. FILTER (lang(?object) = 'en') } LIMIT 150",remoteBackends:["http://dbpedia.org/sparql"],remoteLimit:1e3,remoteDynamically:!0,waitForRemote:!1,remoteLabelBackend:["http://zaire.dimis.fim.uni-passau.de:8080/bigdata/sparql","http://dbpedia.org/sparql"],remoteLabels:!0},viewOptions:{supportRegExpFilter:!0,filterBy:[{value:"*",label:"showAll"}],layoutEngine:{masonry:{columnWidth:1},sortBy:"weight",getSortData:{weight:function(t){var n=e(t),o=n.data("node"),i=o.weight;return a(i)?0:-1*i},alphabetical:function(t){var n=e(t),o=n.find(S.toSelector(f.CSS_CLASSES.tileClasses.label)),i=o.length?o:n;return i.text()}}}}}};h.prototype={_initRdfStore:function(){var t=this,n=e.Deferred();return v("Init RDFSTORE"),a(C)&&(C=new h.RdfStore(t.options.rdfstoreOptions,function(){n.resolve()})),n.promise()},_initRemoteDataLoader:function(){a(b)?b=new h.RemoteDataLoader(this.options.layerOptions.remoteOptions.remoteBackends):e.each(this.options.layerOptions.remoteOptions.remoteBackends,function(e,t){b.addBackend(t)})},_initTemplating:function(){var t=this,n=e.Deferred();Handlebars.registerHelper("toClass",function(e){return S.toClass(e)}),Handlebars.registerHelper("tScaleWrap",function(e){return e=Handlebars.Utils.escapeExpression(e),new Handlebars.SafeString("<span class='"+f.CSS_CLASSES.textScale+"' style='position:static'>"+e+"</span>")}),Handlebars.registerHelper("firstComp",function(e,t,n){var o="";return e.hasComponentType(t)&&(o+=n.fn(e.components[t][0])),o}),Handlebars.registerHelper("hasCompType",function(e,t,n){return e.hasComponentType(t)?n.fn(this):o}),Handlebars.registerHelper("compsEach",function(e,t,n){var o="";return e.forEachComponentType(t,function(e){o+=n.fn(e)}),o}),Handlebars.registerHelper("keysEach",function(e,t){var n="";for(var o in e)n+=t.fn(o);return n}),Handlebars.registerHelper("ifLang",function(e,t){return!e||e.lang!==o&&"en"!==e.lang?o:t.fn(this)}),Handlebars.registerHelper("predicateLabelRetriver",function(e,t){if(e&&!e.label){var n=e.value.split("#");1===n.length&&(n=n[0].split("/")),e.label=n[n.length-1]}return t.fn(this)});var i=new h.TemplatesLoader(n);return t.options.templatesPrecompiled?i.getPrecompiledTemplates():i.extractByFile(t.options.templatesPath),n.promise()},_generateQueries:function(){var e=this;L={initQueries:this.options.initQueries,defaultInitRemoteQuery:this.options.layerOptions.remoteOptions.defaultInitRemoteQuery,remoteSubjectOf:" SELECT DISTINCT ?subject ?predicate ?object ?labelObj ?labelPred WHERE { VALUES ?subject {<"+f.DUMMY+">} ?subject ?predicate ?object. OPTIONAL { ?object rdfs:label ?labelObj }. OPTIONAL { ?predicate rdfs:label ?labelPred }. FILTER(isIRI(?object)  || (LANG(?object) = '' || LANGMATCHES(LANG(?object), '"+e.options.language+"'))). FILTER(LANG(?labelPred) = '' || LANGMATCHES(LANG(?labelPred), '"+e.options.language+"')). FILTER(LANG(?labelObj) = '' || LANGMATCHES(LANG(?labelObj), '"+e.options.language+"'))}",remoteObjectOf:" SELECT DISTINCT ?subject ?predicate ?object ?labelSub ?labelPred WHERE {VALUES ?object {<"+f.DUMMY+">} ?subject ?predicate ?object. OPTIONAL { ?subject rdfs:label ?labelSub }. OPTIONAL { ?predicate rdfs:label ?labelPred }. FILTER(isIRI(?subject)  || (LANG(?subject) = '' || LANGMATCHES(LANG(?subject), '"+e.options.language+"'))). FILTER(LANG(?labelPred) = '' || LANGMATCHES(LANG(?labelPred), '"+e.options.language+"')). FILTER(LANG(?labelSub) = '' || LANGMATCHES(LANG(?labelSub), '"+e.options.language+"'))}",remoteLiteralIsObjectOf:" SELECT DISTINCT ?subject ?predicate ?object ?labelSub ?labelPred WHERE {VALUES ?object {'"+f.DUMMY+"'} ?subject ?predicate ?object. OPTIONAL { ?subject rdfs:label ?labelSub }. OPTIONAL { ?predicate rdfs:label ?labelPred }}",selectSubjectOf:" SELECT DISTINCT ?subject ?predicate ?label ?description WHERE {<"+f.DUMMY+"> ?predicate ?subject. OPTIONAL { ?subject rdfs:label ?label}. OPTIONAL { ?subject rdfs:description ?description } . OPTIONAL { ?subject rdfs:comment ?description }}",selectObjectOf:" SELECT DISTINCT ?subject ?predicate ?label ?description WHERE {?subject ?predicate <"+f.DUMMY+">. OPTIONAL { ?subject rdfs:label ?label}. OPTIONAL { ?subject rdfs:description ?description } . OPTIONAL { ?subject rdfs:comment ?description }}",typeQuery:"SELECT DISTINCT ?type WHERE {<"+f.DUMMY+"> a ?type} ORDER BY ?type",literalIsObjectOf:"SELECT DISTINCT ?subject ?predicate ?type ?label ?description WHERE {?subject ?predicate ?oLiteral. FILTER (STR(?oLiteral)='"+f.DUMMY+"'). OPTIONAL { ?subject rdfs:label ?label}. OPTIONAL { ?subject rdfs:description ?description } . OPTIONAL { ?subject rdfs:comment ?description }}",previewQuery:" SELECT DISTINCT ?label ?description ?type WHERE { <"+f.DUMMY+"> rdfs:label ?label . OPTIONAL { <"+f.DUMMY+"> rdfs:description ?description } . OPTIONAL { <"+f.DUMMY+"> rdfs:comment ?description } . OPTIONAL { <"+f.DUMMY+"> rdfs:type ?type}}",label:"SELECT DISTINCT ?label WHERE { <"+f.DUMMY+"> rdfs:label ?label . FILTER(LANG(?label) = '' || LANGMATCHES(LANG(?label), '"+e.options.language+"'))}",blankNodeQuery:"SELECT DISTINCT ?object WHERE {<"+f.DUMMY+"> ?predicate ?object}"}},_checkInsertion:function(){var e=this,t=!1;return a(e.options.dataFormat)||(a(e.options.dataLoc)?a(e.options.data)||(t=!0,C.insertData(e.options.data,e.options.dataFormat,function(){T[e.pluginID].trigger(f.EVENT_TYPES.store.insert,e)})):(t=!0,e._ajaxLoadData(e.options.dataLoc,e.options.dataFormat,function(t,n){C.insertData(t,n,function(){T[e.pluginID].trigger(f.EVENT_TYPES.store.insert,e)})}))),t},_ajaxLoadData:function(t,n,o){var i=this;T[i.pluginID].trigger(f.EVENT_TYPES.loading.start,i),e.ajax({url:t,dataType:"text",success:function(e){o(e,n)}}).fail(function(){T[i.pluginID].trigger(f.EVENT_TYPES.loading.done,i),alert(f.MESSAGES.error.ajax)})},init:function(){var t=this;t._generateQueries(),t._initRemoteDataLoader(),T[this.pluginID].addEventHandler(f.EVENT_TYPES.store.insert,function(){e.each(t._layers,function(e){v("view "+e+" has to be updated updating")})}),T[this.pluginID].addEventHandler("throttledresize",function(){var e=t._$parent.children(S.toSelector(f.CSS_CLASSES.overlay));e.css("clip",p(f.CSS_CLASSES.overlay));var n=e.find(S.toSelector(f.CSS_CLASSES.innerScroll));n.css("width",y.width()-parseInt(e.css("padding-left"))-parseInt(e.css("padding-right"))+"px"),n.css("height",y.height()-e.find(S.toSelector(f.CSS_CLASSES.innerNoScroll)).height()+"px")},y),t.options.generateTimeline&&(this.timeLine=new h.TimeLine(this._$parent)),"pending"===E.state()&&(E=e.Deferred(),e.when(t._initRdfStore(),t._initTemplating()).done(function(){var n={};e.each(t.options.layerOptions.nodeFilters,function(e,t){t.template&&(A[e]?console.log("Template with identifier "+e+" already defined"):n[e]=Handlebars.compile(t.template))}),e.extend(!0,A,n),E.resolve()})),e.when(E.promise()).done(function(){t._layers={};var e=new h.Layers.Inlay(t._$parent,t.options.layerOptions,t.options.initQueries);t.addLayer(e),t._topLayer=e.id,t._layers[e.id].initSwitch.attach(new h.Listener(function(e){t._checkInsertion()||(t.options.sparqlData===o?e.update():e.addItems(t.options.sparqlData))}))})},addLayer:function(t){var n=this;this._layers[t.id]=t;var o=new h.Listener(function(e){n.timeLine&&(n.timeLine.addLayer(e),e.getTimeLineButton().on("click",function(){n.timeLine.open()}))});t.initSwitch.attach(o),t.openEvent.attach(new h.Listener(function(e){n._topLayer=e.id,n._extendedLayers[e.id]=e.zIndex,n.$body.addClass("noscroll")})),t.closeEvent.attach(new h.Listener(function(t){if(delete n._extendedLayers[t.id],e.isEmptyObject(n._extendedLayers)){n.$body.removeClass("noscroll");var o=0;e.each(n._extendedLayers,function(e,t){t>o&&(o=t,n._topLayer=e)})}else delete n._topLayer})),t.filterEvent.attach(new h.Listener(function(e,t){switch(t.action){case"addLayer":n.addLayer(t.args);break;case"removeLayer":n.removeLayer(e)}})),t.open()},removeLayer:function(e){delete this._layers[e.id]},updateTopLayer:function(){this._topLayer&&this._layers[this._topLayer].update()},insertData:function(t,n){var o=this;e.when(E.promise()).done(function(){C.insertData(t,n,function(){T[o.pluginID].trigger(f.EVENT_TYPES.store.insert,o),o.updateTopLayer()})})},insertDataPath:function(t,n){var o=this;e.when(E.promise()).done(function(){o._ajaxLoadData(t,n,o._selfProxy(o.insertData))})},insertDataFile:function(t){var n=this,o=new FileReader;o.onload=function(){var o=this.result,i="text/turtle";if(""===t.type){var a=t.name.split(".").pop();switch(a){case"ttl":i="text/turtle";break;case"turtle":i="text/turtle";break;case"n3":i="text/n3";break;case"json":i="application/json";break;case"jsld":i="application/ld+json";break;default:console.log(f.MESSAGES.warn.fileTypeNotKnown+i)}}else i=t.type;e.when(E.promise()).done(function(){n.insertData(o,i)})},o.readAsText(t)},insertRemoteDataQuery:function(t,n){var i=this;e.when(E.promise()).done(function(){(n===o||""===n)&&(n=L.defaultInitRemoteQuery),b.insertByQuery(n,[t]),b.loadingDone.once(new h.Listener(function(){i.updateTopLayer()}))})},clearStore:function(){var t=this;C.executeQuery("CLEAR ALL",function(){v("store cleared"),e.each(t._layers,function(e,t){t.removeAllItems()})})},runQuery:function(e,t){C.executeQuery(e,function(e){t&&t(e)})},destroy:function(){var e=this;T[e.pluginID].destory(),T[e.pluginID]=o,e._$parent[_]=null}},e.fn[_]=function(t){return this.each(function(){e.data(this,"plugin_"+_)||e.data(this,"plugin_"+_,new h(this,t))})}})(jQuery,window,document),this.bSynopsis=this.bSynopsis||{},this.bSynopsis.templates=this.bSynopsis.templates||{},this.bSynopsis.templates.filterOptions=Handlebars.template(function(e,t,n,o,i){function a(e,t){var o,i="";return i+='\r\n                            <li><a data-filter-value="',(o=n.value)?o=o.call(e,{hash:{},data:t}):(o=e.value,o=typeof o===p?o.apply(e):o),i+=c(o)+'" class="',(o=n.value)?o=o.call(e,{hash:{},data:t}):(o=e.value,o=typeof o===p?o.apply(e):o),i+=c(o)+'">',(o=n.label)?o=o.call(e,{hash:{},data:t}):(o=e.label,o=typeof o===p?o.apply(e):o),i+=c(o)+"</a></li>\r\n                    "}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var r,s,l="",p="function",c=this.escapeExpression,d=this;return l+='    <div class="'+c((r=t.CSS_CLASSES,r=null==r||r===!1?r:r.optionCombo,typeof r===p?r.apply(t):r))+" "+c((r=t.CSS_CLASSES,r=null==r||r===!1?r:r.filter,typeof r===p?r.apply(t):r))+'">\r\n            <h2>Filter:</h2>\r\n            <ul class="'+c((r=t.CSS_CLASSES,r=null==r||r===!1?r:r.optionSet,typeof r===p?r.apply(t):r))+" "+c((r=t.CSS_CLASSES,r=null==r||r===!1?r:r.clearfix,typeof r===p?r.apply(t):r))+'" data-option-key="filter">\r\n                    ',s=n.each.call(t,t.filterOptions,{hash:{},inverse:d.noop,fn:d.program(1,a,i),data:i}),(s||0===s)&&(l+=s),l+='\r\n            </ul>\r\n    </div>\r\n    <div class="'+c((r=t.CSS_CLASSES,r=null==r||r===!1?r:r.optionCombo,typeof r===p?r.apply(t):r))+'">\r\n            <ul class="'+c((r=t.CSS_CLASSES,r=null==r||r===!1?r:r.optionButton,typeof r===p?r.apply(t):r))+" "+c((r=t.CSS_CLASSES,r=null==r||r===!1?r:r.clearfix,typeof r===p?r.apply(t):r))+'">\r\n                <li><a class="'+c((r=t.CSS_CLASSES,r=null==r||r===!1?r:r.refresh,typeof r===p?r.apply(t):r))+'">Refresh</a></li>\r\n            </ul>\r\n    </div>'}),this.bSynopsis.templates.groupDropDown=Handlebars.template(function(e,t,n,o,i){function a(e,t){var o,i="";return i+="\r\n            <option value=",(o=n.val)?o=o.call(e,{hash:{},data:t}):(o=e.val,o=typeof o===l?o.apply(e):o),i+=p(o)+">",(o=n.label)?o=o.call(e,{hash:{},data:t}):(o=e.label,o=typeof o===l?o.apply(e):o),i+=p(o)+"</option>\r\n            "}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var r,s="",l="function",p=this.escapeExpression,c=this;return s+='    <select id="GroupDropDown">\r\n            ',r=n.each.call(t,t,{hash:{},inverse:c.noop,fn:c.program(1,a,i),data:i}),(r||0===r)&&(s+=r),s+="\r\n    </select>"}),this.bSynopsis.templates.overlayContent=Handlebars.template(function(e,t,n,o,i){function a(e,t){var o,i,a,l="";return l+='\r\n            <div class="'+h((o=e.CSS_CLASSES,o=null==o||o===!1?o:o.innerNoScroll,typeof o===u?o.apply(e):o))+'">\r\n                <h2>\r\n                    ',a={hash:{},inverse:y.noop,fn:y.program(2,r,t),data:t},o=n.firstComp||e.firstComp,i=o?o.call(e,e.node,"label",a):f.call(e,"firstComp",e.node,"label",a),(i||0===i)&&(l+=i),l+="\r\n                    \r\n                </h2>\r\n                 ",a={hash:{},inverse:y.noop,fn:y.program(4,s,t),data:t},o=n.firstComp||e.firstComp,i=o?o.call(e,e.node,"uri",a):f.call(e,"firstComp",e.node,"uri",a),(i||0===i)&&(l+=i),l+='\r\n            </div>\r\n            <div class="'+h((o=e.CSS_CLASSES,o=null==o||o===!1?o:o.innerScroll,typeof o===u?o.apply(e):o))+'">\r\n            </div>\r\n    '}function r(e){var t;return h((t=e.data,t=null==t||t===!1?t:t.value,typeof t===u?t.apply(e):t))}function s(e,t){var o;return(o=n.data)?o=o.call(e,{hash:{},data:t}):(o=e.data,o=typeof o===u?o.apply(e):o),h(o)}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var l,p,c,d="",u="function",h=this.escapeExpression,y=this,f=n.helperMissing;return d+="    ",c={hash:{},inverse:y.noop,fn:y.program(1,a,i),data:i},l=n.hasCompType||t.hasCompType,p=l?l.call(t,t.node,"label",c):f.call(t,"hasCompType",t.node,"label",c),(p||0===p)&&(d+=p),d}),this.bSynopsis.templates.overlayWrapper=Handlebars.template(function(e,t,n,o,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var a,r,s="",l="function",p=this.escapeExpression;return s+='		      \r\n		<div class="'+p((a=t.CSS_CLASSES,a=null==a||a===!1?a:a.overlay,typeof a===l?a.apply(t):a))+" ",(r=n.id)?r=r.call(t,{hash:{},data:i}):(r=t.id,r=typeof r===l?r.apply(t):r),s+=p(r)+'">\r\n            <span class="'+p((a=t.CSS_CLASSES,a=null==a||a===!1?a:a.buttonTimeline,typeof a===l?a.apply(t):a))+'">history</span>\r\n			<span class="'+p((a=t.CSS_CLASSES,a=null==a||a===!1?a:a.buttonClose,typeof a===l?a.apply(t):a))+'">close</span>\r\n			<div class="'+p((a=t.CSS_CLASSES,a=null==a||a===!1?a:a.overlayContent,typeof a===l?a.apply(t):a))+'">\r\n			</div>\r\n		</div>'}),this.bSynopsis.templates.previewItem=Handlebars.template(function(e,t,n,o,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var a,r,s="",l="function",p=this.escapeExpression;return s+='<div class="'+p((a=t.cssClass,a=null==a||a===!1?a:a.preview,typeof a===l?a.apply(t):a))+" "+p((a=t.cssClass,a=null==a||a===!1?a:a.preview,typeof a===l?a.apply(t):a))+"_",(r=n.index)?r=r.call(t,{hash:{},data:i}):(r=t.index,r=typeof r===l?r.apply(t):r),s+=p(r)+'">\r\n        <div class="'+p((a=t.cssClass,a=null==a||a===!1?a:a.previewContent,typeof a===l?a.apply(t):a))+'">\r\n            TODO\r\n        </div>\r\n</div>'}),this.bSynopsis.templates.sortOptions=Handlebars.template(function(e,t,n,o,i){function a(e){var t="";return t+='\r\n				<li><a data-sort-value="'+d(typeof e===c?e.apply(e):e)+'" class="'+d(typeof e===c?e.apply(e):e)+'">'+d(typeof e===c?e.apply(e):e)+"</a></li>\r\n			"}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var r,s,l,p="",c="function",d=this.escapeExpression,u=this,h=n.helperMissing;return p+='	<div class="'+d((r=t.CSS_CLASSES,r=null==r||r===!1?r:r.optionCombo,typeof r===c?r.apply(t):r))+" "+d((r=t.CSS_CLASSES,r=null==r||r===!1?r:r.sorter,typeof r===c?r.apply(t):r))+'">\r\n		<h2>Sort:</h2>\r\n		<ul class="'+d((r=t.CSS_CLASSES,r=null==r||r===!1?r:r.optionSet,typeof r===c?r.apply(t):r))+" "+d((r=t.CSS_CLASSES,r=null==r||r===!1?r:r.clearfix,typeof r===c?r.apply(t):r))+'" data-option-key="sortBy">\r\n			',l={hash:{},inverse:u.noop,fn:u.program(1,a,i),data:i},r=n.keysEach||t.keysEach,s=r?r.call(t,t.optionSet,l):h.call(t,"keysEach",t.optionSet,l),(s||0===s)&&(p+=s),p+="\r\n		</ul>\r\n	</div>"}),this.bSynopsis.templates.stdNode=Handlebars.template(function(e,t,n,o,i){function a(e,t){var o,i,a="";return a+='\r\n                    <div class="',i={hash:{},data:t},a+=f((o=n.toClass||e.toClass,o?o.call(e,e.type,i):y.call(e,"toClass",e.type,i)))+" ",i={hash:{},data:t},a+=f((o=n.toClass||e.toClass,o?o.call(e,e.id,i):y.call(e,"toClass",e.id,i)))+'">',i={hash:{},data:t},a+=f((o=n.tScaleWrap||e.tScaleWrap,o?o.call(e,(o=e.data,null==o||o===!1?o:o.value),i):y.call(e,"tScaleWrap",(o=e.data,null==o||o===!1?o:o.value),i)))+"</div>\r\n            "}function r(e,t){var o,i,a,r="";return r+="\r\n                ",a={hash:{},inverse:S.noop,fn:S.program(4,s,t),data:t},o=n.ifLang||e.ifLang,i=o?o.call(e,e,a):y.call(e,"ifLang",e,a),(i||0===i)&&(r+=i),r+="\r\n            "}function s(e,t){var o,i,a="";return a+='\r\n                        <div class="',i={hash:{},data:t},a+=f((o=n.toClass||e.toClass,o?o.call(e,e.type,i):y.call(e,"toClass",e.type,i)))+" ",i={hash:{},data:t},a+=f((o=n.toClass||e.toClass,o?o.call(e,e.id,i):y.call(e,"toClass",e.id,i)))+'">',i={hash:{},data:t},a+=f((o=n.tScaleWrap||e.tScaleWrap,o?o.call(e,(o=e.data,null==o||o===!1?o:o.value),i):y.call(e,"tScaleWrap",(o=e.data,null==o||o===!1?o:o.value),i)))+"</div>\r\n                "}function l(e,t,o){var i,a,r,s="";return s+='\r\n                    <div class="',r={hash:{},data:t},s+=f((i=n.toClass||e.toClass,i?i.call(e,e.id,r):y.call(e,"toClass",e.id,r)))+'">\r\n                        <img class="'+f((i=o.CSS_CLASSES,i=null==i||i===!1?i:i.tileClasses,i=null==i||i===!1?i:i.typeImage,typeof i===v?i.apply(e):i))+'" src="img/'+f((i=e.data,i=null==i||i===!1?i:i.type,typeof i===v?i.apply(e):i))+'.png">\r\n                        <div class="'+f((i=o.CSS_CLASSES,i=null==i||i===!1?i:i.tileClasses,i=null==i||i===!1?i:i.predicate,typeof i===v?i.apply(e):i))+'" style="visibility:hidden; overflow-y:auto; word-wrap:break-word">',r={hash:{},data:t},s+=f((i=n.tScaleWrap||e.tScaleWrap,i?i.call(e,(i=e.data,null==i||i===!1?i:i.value),r):y.call(e,"tScaleWrap",(i=e.data,null==i||i===!1?i:i.value),r)))+"</div>\r\n                        ",r={hash:{},inverse:S.noop,fn:S.programWithDepth(7,p,t,o),data:t},i=n.predicateLabelRetriver||e.predicateLabelRetriver,a=i?i.call(e,e.data,r):y.call(e,"predicateLabelRetriver",e.data,r),(a||0===a)&&(s+=a),s+="\r\n                    </div>\r\n            "}function p(e,t,o){var i,a,r="";return r+='\r\n                            <div class="'+f((i=o.CSS_CLASSES,i=null==i||i===!1?i:i.tileClasses,i=null==i||i===!1?i:i.predicateLabel,typeof i===v?i.apply(e):i))+'" style="overflow-y:auto; word-wrap:break-word">',a={hash:{},data:t},r+=f((i=n.tScaleWrap||e.tScaleWrap,i?i.call(e,(i=e.data,null==i||i===!1?i:i.label),a):y.call(e,"tScaleWrap",(i=e.data,null==i||i===!1?i:i.label),a)))+"</div>\r\n                        "}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var c,d,u,h="",y=n.helperMissing,f=this.escapeExpression,S=this,v="function";return h+="            ",u={hash:{},inverse:S.noop,fn:S.program(1,a,i),data:i},c=n.compsEach||t.compsEach,d=c?c.call(t,t.node,"label",u):y.call(t,"compsEach",t.node,"label",u),(d||0===d)&&(h+=d),h+="\r\n            ",u={hash:{},inverse:S.noop,fn:S.program(3,r,i),data:i},c=n.compsEach||t.compsEach,d=c?c.call(t,t.node,"description",u):y.call(t,"compsEach",t.node,"description",u),(d||0===d)&&(h+=d),h+="\r\n            ",u={hash:{},inverse:S.noop,fn:S.programWithDepth(6,l,i,t),data:i},c=n.compsEach||t.compsEach,d=c?c.call(t,t.node,"predicate",u):y.call(t,"compsEach",t.node,"predicate",u),(d||0===d)&&(h+=d),h}),this.bSynopsis.templates.tileWrapper=Handlebars.template(function(e,t,n,o,i){function a(e){return h(typeof e===u?e.apply(e):e)}function r(e,t){var o,i;return i={hash:{},data:t},h((o=n.toClass||e.toClass,o?o.call(e,(o=e.node,null==o||o===!1?o:o.token),i):y.call(e,"toClass",(o=e.node,null==o||o===!1?o:o.token),i)))}function s(e,t){var o,i,a="";return a+='\r\n			<h2 class="'+h((o=e.CSS_CLASSES,o=null==o||o===!1?o:o.tileClasses,o=null==o||o===!1?o:o.showURI,typeof o===u?o.apply(e):o))+'" style="display:none">',(i=n.data)?i=i.call(e,{hash:{},data:t}):(i=e.data,i=typeof i===u?i.apply(e):i),a+=h(i)+"</h2>\r\n		"}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var l,p,c,d="",u="function",h=this.escapeExpression,y=n.helperMissing,f=this;return d+='	<div class="'+h((l=t.CSS_CLASSES,l=null==l||l===!1?l:l.tileClasses,l=null==l||l===!1?l:l.tile,typeof l===u?l.apply(t):l))+" ",p=n.each.call(t,(l=t.node,null==l||l===!1?l:l.filterables),{hash:{},inverse:f.noop,fn:f.program(1,a,i),data:i}),(p||0===p)&&(d+=p),p=n["if"].call(t,(l=t.node,null==l||l===!1?l:l.token),{hash:{},inverse:f.noop,fn:f.program(3,r,i),data:i}),(p||0===p)&&(d+=p),d+=" ",c={hash:{},data:i},d+=h((l=n.toClass||t.toClass,l?l.call(t,(l=t.node,null==l||l===!1?l:l.id),c):y.call(t,"toClass",(l=t.node,null==l||l===!1?l:l.id),c)))+'">\r\n		',c={hash:{},inverse:f.noop,fn:f.program(5,s,i),data:i},l=n.firstComp||t.firstComp,p=l?l.call(t,t.node,"uri",c):y.call(t,"firstComp",t.node,"uri",c),(p||0===p)&&(d+=p),d+='\r\n		<p class="'+h((l=t.CSS_CLASSES,l=null==l||l===!1?l:l.tileClasses,l=null==l||l===!1?l:l.number,typeof l===u?l.apply(t):l))+'" style="display:none">'+h((l=t.node,l=null==l||l===!1?l:l.index,typeof l===u?l.apply(t):l))+"</p>\r\n	</div>"
}),this.bSynopsis.templates.timelineItem=Handlebars.template(function(e,t,n,o,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var a,r="",s="function",l=this.escapeExpression;return r+="<li>\r\n    ",(a=n.label)?a=a.call(t,{hash:{},data:i}):(a=t.label,a=typeof a===s?a.apply(t):a),r+=l(a)+"\r\n</li>"}),this.bSynopsis.templates.timelineWrapper=Handlebars.template(function(e,t,n,o,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var a,r="",s="function",l=this.escapeExpression;return r+='<div class="'+l((a=t.CSS_CLASSES,a=null==a||a===!1?a:a.timelineContainer,typeof a===s?a.apply(t):a))+'">\r\n    <ul class="'+l((a=t.CSS_CLASSES,a=null==a||a===!1?a:a.timeline,typeof a===s?a.apply(t):a))+'">\r\n    </ul>\r\n</div>'});